const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sessionValidator-CHh5e7zs.js","assets/data-query-DIoVICGX.js","assets/react-router-qpxRsT6p.js","assets/react-core-B2bfBmQ1.js","assets/data-api-Bj79fh9f.js","assets/ui-icons-kyIJ9IOi.js","assets/ui-utils-CaKPsBzZ.js","assets/quickSessionCheck-CDz9td7h.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,a=(e,t)=>{for(var r in t||(t={}))n.call(t,r)&&i(e,r,t[r]);if(s)for(var r of s(t))o.call(t,r)&&i(e,r,t[r]);return e},l=(e,s)=>t(e,r(s)),c=(e,t,r)=>i(e,"symbol"!=typeof t?t+"":t,r),u=(e,t,r)=>new Promise((s,n)=>{var o=e=>{try{a(r.next(e))}catch(t){n(t)}},i=e=>{try{a(r.throw(e))}catch(t){n(t)}},a=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,i);a((r=r.apply(e,t)).next())});import{j as d,h,d as p,Q as g,I as m,t as f,a as y}from"./data-query-DIoVICGX.js";import{r as v,N as x,u as b,a as S,R as w,L as k,b as _,m as N,B as C,c as j,d as I}from"./react-router-qpxRsT6p.js";import{a as A,g as R}from"./react-core-B2bfBmQ1.js";import{_ as P}from"./data-api-Bj79fh9f.js";import{P as E,a as O,X as T,U as L,L as D,b as $,R as M,A as q,W as F,c as U,S as z,K as V,d as H,M as B,e as J,f as W,g as K,C as G,h as Y,i as Q,j as X,k as Z,l as ee,I as te,B as re,m as se,n as ne,o as oe,p as ie,q as ae,r as le,s as ce,t as ue,u as de,v as he,E as pe,w as ge,x as me,V as fe}from"./ui-icons-kyIJ9IOi.js";import{n as ye,F as ve}from"./ui-utils-CaKPsBzZ.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var xe,be={},Se=function(){if(xe)return be;xe=1;var e=A();return be.createRoot=e.createRoot,be.hydrateRoot=e.hydrateRoot,be}();const we=new class{constructor(){c(this,"subscribers",[]),c(this,"session",null),c(this,"storageKey","base360-auth-token"),this.loadSession()}getApiUrl(){return"http://localhost:8000"}notifySubscribers(e,t){console.log(`üì£ [LocalAuth] Notifying ${this.subscribers.length} subscribers of event: ${e}`),this.subscribers.forEach(r=>{try{r(e,t)}catch(s){console.error("üì£ [LocalAuth] Error in subscriber callback:",s)}})}saveSession(e){this.session=e,e?(localStorage.setItem(this.storageKey,JSON.stringify(e)),this.notifySubscribers("SIGNED_IN",e)):(localStorage.removeItem(this.storageKey),this.notifySubscribers("SIGNED_OUT",null))}loadSession(){try{const e=localStorage.getItem(this.storageKey);e&&(this.session=JSON.parse(e))}catch(e){console.warn("[LocalAuth] Failed to load session from storage:",e),localStorage.removeItem(this.storageKey)}}signInWithPassword(e){return u(this,null,function*(){try{const t=yield fetch(`${this.getApiUrl()}/api/v1/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=yield t.json();if(!t.ok)throw new Error(r.detail||r.error||`HTTP ${t.status}`);if(r.error)throw new Error(r.error);const s={access_token:r.access_token,token_type:r.token_type||"bearer",user:r.user};return this.saveSession(s),{user:r.user,session:s,error:null}}catch(t){return console.error("[LocalAuth] Sign in failed:",t),{user:null,session:null,error:t}}})}signOut(){return u(this,null,function*(){var e;try{if(null==(e=this.session)?void 0:e.access_token)try{yield fetch(`${this.getApiUrl()}/api/v1/auth/logout`,{method:"POST",headers:{Authorization:`Bearer ${this.session.access_token}`}})}catch(t){console.warn("[LocalAuth] Backend logout failed (continuing):",t)}return this.saveSession(null),{error:null}}catch(r){return console.error("[LocalAuth] Sign out failed:",r),{error:r}}})}getSession(){return u(this,null,function*(){var e;if(null==(e=this.session)?void 0:e.access_token)try{if((yield fetch(`${this.getApiUrl()}/api/v1/auth/me`,{headers:{Authorization:`Bearer ${this.session.access_token}`}})).ok)return{data:{session:this.session}};this.saveSession(null)}catch(t){console.warn("[LocalAuth] Session validation failed:",t),this.saveSession(null)}return{data:{session:null}}})}getUser(e){return u(this,null,function*(){var t;const r=e||(null==(t=this.session)?void 0:t.access_token);if(!r)return{user:null};try{const e=yield fetch(`${this.getApiUrl()}/api/v1/auth/me`,{headers:{Authorization:`Bearer ${r}`}});return e.ok?{user:yield e.json()}:{user:null}}catch(s){return console.error("[LocalAuth] Get user failed:",s),{user:null}}})}setSession(e){return u(this,null,function*(){try{return this.saveSession(e),{error:null}}catch(t){return{error:t}}})}onAuthStateChange(e){return this.subscribers.push(e),e("INITIAL_SESSION",this.session),{data:{subscription:{unsubscribe:()=>{this.subscribers=this.subscribers.filter(t=>t!==e)}}}}}get auth(){return{admin:{getUser:this.getUser.bind(this),getUserById:e=>this.getUser(),listUsers:()=>Promise.resolve([])},signInWithPassword:this.signInWithPassword.bind(this),signOut:this.signOut.bind(this),getSession:this.getSession.bind(this),getUser:this.getUser.bind(this),setSession:this.setSession.bind(this),onAuthStateChange:this.onAuthStateChange.bind(this)}}};console.log("‚úÖ Using local authentication client instead of Supabase");const ke=we;"undefined"!=typeof window&&ke.auth.getSession().then(({data:{session:e}})=>{e?console.log("‚úÖ Session found on page load:",e.user.email):console.log("‚ÑπÔ∏è No session found on page load")});const _e="session_metadata",Ne="storage_health",Ce="corruption_detected",je="2.0.0",Ie=class e{constructor(){c(this,"currentContext",{}),c(this,"healthCheckInterval",null),c(this,"NAMESPACE_SEPARATOR","::"),c(this,"MAX_STORAGE_SIZE",5242880),this.initializeHealthMonitoring()}static getInstance(){return e.instance||(e.instance=new e),e.instance}setContext(e){console.log("[StorageManager] Setting context:",{tenant_id:e.tenant_id,user_id:e.user_id,email:e.email}),this.currentContext=a({},e),this.updateStorageHealth()}clearContext(){console.log("[StorageManager] Clearing context"),this.currentContext={}}getNamespacedKey(e,t){const r=a(a({},this.currentContext),t);return r.tenant_id&&r.user_id?`${r.tenant_id}${this.NAMESPACE_SEPARATOR}${r.user_id}${this.NAMESPACE_SEPARATOR}${e}`:r.user_id?`${r.user_id}${this.NAMESPACE_SEPARATOR}${e}`:e}generateIntegrityHash(e){const t=JSON.stringify(e);let r=0;for(let s=0;s<t.length;s++)r=(r<<5)-r+t.charCodeAt(s),r&=r;return r.toString(36)}validateIntegrity(e){if(!e.integrity_hash)return!0;const t=this.generateIntegrityHash(e.data),r=t===e.integrity_hash;return r||console.warn("[StorageManager] Integrity check failed for item:",{expected:t,actual:e.integrity_hash}),r}set(e,t,r){try{const s=this.getNamespacedKey(e,null==r?void 0:r.context),n={data:t,timestamp:Date.now(),version:je,tenant_id:this.currentContext.tenant_id,user_id:this.currentContext.user_id};(null==r?void 0:r.skipIntegrityCheck)||(n.integrity_hash=this.generateIntegrityHash(t)),(null==r?void 0:r.ttl)&&(n.expires_at=Date.now()+r.ttl);const o=JSON.stringify(n);return o.length>this.MAX_STORAGE_SIZE?(console.warn("[StorageManager] Item too large for storage:",{key:s,size:o.length,limit:this.MAX_STORAGE_SIZE}),!1):(localStorage.setItem(s,o),console.log("[StorageManager] Set item:",{originalKey:e,namespacedKey:s,hasIntegrity:!!n.integrity_hash,size:o.length}),!0)}catch(s){return console.error("[StorageManager] Failed to set item:",{key:e,error:s instanceof Error?s.message:String(s)}),this.markCorruption(s),!1}}get(e,t){try{const r=this.getNamespacedKey(e,null==t?void 0:t.context),s=localStorage.getItem(r);if(!s)return(null==t?void 0:t.defaultValue)||null;const n=JSON.parse(s);return n.expires_at&&Date.now()>n.expires_at?(console.log("[StorageManager] Item expired, removing:",r),this.remove(e,t),(null==t?void 0:t.defaultValue)||null):(null==t?void 0:t.skipIntegrityCheck)||this.validateIntegrity(n)?(console.log("[StorageManager] Retrieved item:",{originalKey:e,namespacedKey:r,timestamp:new Date(n.timestamp).toISOString(),hasIntegrity:!!n.integrity_hash}),n.data):(console.warn("[StorageManager] Integrity validation failed, removing corrupted item:",r),this.remove(e,t),this.markCorruption("integrity_validation_failed"),(null==t?void 0:t.defaultValue)||null)}catch(r){return console.error("[StorageManager] Failed to get item:",{key:e,error:r instanceof Error?r.message:String(r)}),this.remove(e,t),this.markCorruption(r),(null==t?void 0:t.defaultValue)||null}}remove(e,t){try{const r=this.getNamespacedKey(e,null==t?void 0:t.context);return localStorage.removeItem(r),console.log("[StorageManager] Removed item:",{originalKey:e,namespacedKey:r}),!0}catch(r){return console.error("[StorageManager] Failed to remove item:",{key:e,error:r instanceof Error?r.message:String(r)}),!1}}clearUserData(e){const t=a(a({},this.currentContext),e);if(!t.user_id)return console.warn("[StorageManager] No user context to clear"),0;let r=0;const s=[];for(let n=0;n<localStorage.length;n++){const e=localStorage.key(n);if(!e)continue;const r=e.split(this.NAMESPACE_SEPARATOR);if(r.length>=2){const n=r[0],o=r[1];t.tenant_id&&t.user_id?n===t.tenant_id&&o===t.user_id&&s.push(e):t.user_id&&(o!==t.user_id&&n!==t.user_id||s.push(e))}}return s.forEach(e=>{localStorage.removeItem(e),r++}),console.log("[StorageManager] Cleared user data:",{context:t,clearedCount:r,keys:s}),r}clearAll(){const e=localStorage.length;localStorage.clear(),console.log("[StorageManager] Nuclear clear completed:",{clearedItems:e}),this.updateStorageHealth()}markCorruption(e){try{const t={timestamp:Date.now(),error:e instanceof Error?e.message:String(e),context:this.currentContext,user_agent:navigator.userAgent};localStorage.setItem(Ce,JSON.stringify(t)),console.warn("[StorageManager] Storage corruption marked:",t)}catch(t){console.error("[StorageManager] Failed to mark corruption:",t)}}isCorrupted(){try{return null!==localStorage.getItem(Ce)}catch(e){return!0}}updateStorageHealth(){try{const e={timestamp:Date.now(),version:je,context:this.currentContext,storage_size:this.getStorageSize(),item_count:localStorage.length};localStorage.setItem(Ne,JSON.stringify(e))}catch(e){console.error("[StorageManager] Failed to update health:",e)}}getStorageSize(){let e=0;for(let t=0;t<localStorage.length;t++){const r=localStorage.key(t),s=r?localStorage.getItem(r):null;r&&s&&(e+=r.length+s.length)}return e}initializeHealthMonitoring(){this.healthCheckInterval=setInterval(()=>{this.updateStorageHealth(),this.cleanupExpiredItems()},3e5),this.updateStorageHealth()}cleanupExpiredItems(){const e=Date.now(),t=[];for(let s=0;s<localStorage.length;s++){const n=localStorage.key(s);if(n)try{const r=localStorage.getItem(n);if(!r)continue;const s=JSON.parse(r);s.expires_at&&e>s.expires_at&&t.push(n)}catch(r){t.push(n)}}t.length>0&&(t.forEach(e=>localStorage.removeItem(e)),console.log("[StorageManager] Cleaned up expired items:",t.length))}getDiagnostics(){const e=this.getStorageSize(),t=localStorage.length,r=this.isCorrupted();return{version:je,context:this.currentContext,total_size:e,total_size_mb:(e/1048576).toFixed(2),item_count:t,is_corrupted:r,max_size:this.MAX_STORAGE_SIZE,usage_percentage:(e/this.MAX_STORAGE_SIZE*100).toFixed(1)}}destroy(){this.healthCheckInterval&&(clearInterval(this.healthCheckInterval),this.healthCheckInterval=null)}};c(Ie,"instance");const Ae=Ie.getInstance();"undefined"!=typeof window&&(window.storageManager=Ae,window.getStorageDiagnostics=()=>Ae.getDiagnostics());const Re=class e{constructor(){c(this,"lastHealthCheck",0),c(this,"healthCheckInterval",null),c(this,"HEALTH_CHECK_INTERVAL",6e5),c(this,"MAX_ITEM_AGE_HOURS",24),c(this,"MAX_ORPHANED_AGE_HOURS",1),this.startHealthMonitoring()}static getInstance(){return e.instance||(e.instance=new e),e.instance}performHealthCheck(e){return u(this,null,function*(){const t=Date.now();console.log("[StorageHealthChecker] Starting comprehensive health check...");const r=[];let s=!1;try{const n=this.checkForCorruption();r.push(...n);const o=yield this.checkForOrphanedData();r.push(...o);const i=this.checkVersionMismatches();r.push(...i);const a=yield this.checkSessionConflicts();r.push(...a);const l=this.checkStorageSize();r.push(...l),(null==e?void 0:e.autoFix)&&(s=yield this.autoFixIssues(r));const c=this.generateDiagnostics(),u=this.determineOverallHealth(r),d={overall_health:u,issues:r,diagnostics:c,recommendations:this.generateRecommendations(r,c),auto_fix_applied:s,timestamp:Date.now()};Ae.set(Ne,d,{skipIntegrityCheck:!0,ttl:864e5});const h=Date.now()-t;return console.log("[StorageHealthChecker] Health check completed:",{duration_ms:h,overall_health:u,issues_found:r.length,auto_fix_applied:s}),this.lastHealthCheck=Date.now(),d}catch(n){return console.error("[StorageHealthChecker] Health check failed:",n),{overall_health:"critical",issues:[{type:"corruption",severity:"critical",description:`Health check system failure: ${n instanceof Error?n.message:String(n)}`,affected_keys:[],auto_fixable:!1}],diagnostics:this.generateDiagnostics(),recommendations:["Perform manual storage cleanup","Contact technical support"],auto_fix_applied:!1,timestamp:Date.now()}}})}checkForCorruption(){const e=[],t=[];for(let s=0;s<localStorage.length;s++){const e=localStorage.key(s);if(e)try{const r=localStorage.getItem(e);if(!r)continue;const s=JSON.parse(r);if("object"==typeof s&&null!==s){if(void 0===s.data||void 0===s.timestamp)continue;("number"!=typeof s.timestamp||s.timestamp>Date.now())&&t.push(e),s.version&&"string"!=typeof s.version&&t.push(e)}}catch(r){t.push(e)}}return t.length>0&&e.push({type:"corruption",severity:t.length>10?"critical":t.length>5?"high":"medium",description:`Found ${t.length} corrupted storage items`,affected_keys:t,auto_fixable:!0}),e}checkForOrphanedData(){return u(this,null,function*(){var e,t,r;const s=[],n=[];let o=null,i=null;try{const{data:{session:s}}=yield ke.auth.getSession();o=(null==(e=null==s?void 0:s.user)?void 0:e.id)||null,i=(null==(r=null==(t=null==s?void 0:s.user)?void 0:t.app_metadata)?void 0:r.tenant_id)||null}catch(l){console.warn("[StorageHealthChecker] Could not get current session for orphan check:",l)}const a=Date.now();for(let u=0;u<localStorage.length;u++){const e=localStorage.key(u);if(e)try{const t=e.split("::");if(t.length>=3){const r=t[0],s=t[1];if(o&&i&&(s!==o||r!==i)){const t=localStorage.getItem(e);if(t)try{(a-JSON.parse(t).timestamp)/36e5>this.MAX_ORPHANED_AGE_HOURS&&n.push(e)}catch(c){n.push(e)}}}}catch(l){console.warn("[StorageHealthChecker] Error checking orphaned data:",l)}}return n.length>0&&s.push({type:"orphaned_data",severity:n.length>20?"high":"medium",description:`Found ${n.length} orphaned storage items from previous sessions`,affected_keys:n,auto_fixable:!0}),s})}checkVersionMismatches(){const e=[],t=[];for(let s=0;s<localStorage.length;s++){const e=localStorage.key(s);if(e)try{const r=localStorage.getItem(e);if(!r)continue;const s=JSON.parse(r);"object"==typeof s&&null!==s&&s.version&&"2.0.0"!==s.version&&t.push(e)}catch(r){}}return t.length>0&&e.push({type:"version_mismatch",severity:"medium",description:`Found ${t.length} items with outdated storage format`,affected_keys:t,auto_fixable:!0}),e}checkSessionConflicts(){return u(this,null,function*(){const e=[];try{const t=[],r=[];for(let e=0;e<localStorage.length;e++){const s=localStorage.key(e);s&&(s.includes("auth")||s.includes("session")||s.includes("supabase"))&&(s.includes("auth_session")||s.includes("session_backup")?t.push(s):s.includes("auth")&&r.push(s))}t.length>3&&e.push({type:"session_conflict",severity:"high",description:`Multiple active session detected (${t.length} session keys found)`,affected_keys:t,auto_fixable:!0}),r.length>10&&e.push({type:"session_conflict",severity:"medium",description:`Excessive authentication data accumulation (${r.length} auth keys)`,affected_keys:r,auto_fixable:!0})}catch(t){console.warn("[StorageHealthChecker] Error checking session conflicts:",t)}return e})}checkStorageSize(){const e=[],t=Ae.getDiagnostics(),r=parseFloat(t.usage_percentage);return r>90?e.push({type:"size_overflow",severity:"critical",description:`Storage usage at ${r}% - approaching browser limits`,affected_keys:[],auto_fixable:!0}):r>75&&e.push({type:"size_overflow",severity:"high",description:`Storage usage at ${r}% - cleanup recommended`,affected_keys:[],auto_fixable:!0}),e}autoFixIssues(e){return u(this,null,function*(){let t=!1;for(const s of e)if(s.auto_fixable)try{switch(s.type){case"corruption":this.fixCorruptedItems(s.affected_keys),t=!0;break;case"orphaned_data":this.fixOrphanedItems(s.affected_keys),t=!0;break;case"version_mismatch":this.fixVersionMismatches(s.affected_keys),t=!0;break;case"session_conflict":yield this.fixSessionConflicts(s.affected_keys),t=!0;break;case"size_overflow":this.fixSizeOverflow(),t=!0}}catch(r){console.error(`[StorageHealthChecker] Failed to auto-fix ${s.type}:`,r)}return t&&console.log("[StorageHealthChecker] Auto-fix applied for detected issues"),t})}fixCorruptedItems(e){e.forEach(e=>{try{localStorage.removeItem(e)}catch(t){console.warn(`[StorageHealthChecker] Failed to remove corrupted key ${e}:`,t)}}),console.log(`[StorageHealthChecker] Removed ${e.length} corrupted items`)}fixOrphanedItems(e){e.forEach(e=>{try{localStorage.removeItem(e)}catch(t){console.warn(`[StorageHealthChecker] Failed to remove orphaned key ${e}:`,t)}}),console.log(`[StorageHealthChecker] Removed ${e.length} orphaned items`)}fixVersionMismatches(e){e.forEach(e=>{try{localStorage.removeItem(e)}catch(t){console.warn(`[StorageHealthChecker] Failed to fix version mismatch for ${e}:`,t)}}),console.log(`[StorageHealthChecker] Fixed ${e.length} version mismatches`)}fixSessionConflicts(e){return u(this,null,function*(){var t,r,s;const n=null==(s=null==(r=null==(t=(yield ke.auth.getSession()).data)?void 0:t.session)?void 0:r.user)?void 0:s.id;n?e.forEach(e=>{if(!e.includes(n))try{localStorage.removeItem(e)}catch(t){console.warn(`[StorageHealthChecker] Failed to remove conflicting session key ${e}:`,t)}}):e.forEach(e=>{try{localStorage.removeItem(e)}catch(t){console.warn(`[StorageHealthChecker] Failed to remove conflicting session key ${e}:`,t)}}),console.log("[StorageHealthChecker] Resolved session conflicts")})}fixSizeOverflow(){const e=Date.now(),t=[];for(let s=0;s<localStorage.length;s++){const n=localStorage.key(s);if(n)try{const r=localStorage.getItem(n);if(!r)continue;const s=JSON.parse(r);s.expires_at&&e>s.expires_at&&t.push(n)}catch(r){}}t.forEach(e=>localStorage.removeItem(e)),console.log(`[StorageHealthChecker] Removed ${t.length} expired items to free space`)}generateDiagnostics(){let e=0,t=0,r=0,s=0,n={key:"",size:0},o={key:"",age_hours:0};const i=Date.now();for(let l=0;l<localStorage.length;l++){const c=localStorage.key(l);if(!c)continue;const u=localStorage.getItem(c);if(!u)continue;const d=c.length+u.length;e+=d,d>n.size&&(n={key:c,size:d});try{const e=JSON.parse(u);if(e.timestamp){const t=(i-e.timestamp)/36e5;t>o.age_hours&&(o={key:c,age_hours:t}),e.expires_at&&i>e.expires_at&&r++}e.version&&"2.0.0"!==e.version&&s++}catch(a){t++}}return{total_size:e,total_items:localStorage.length,corrupted_items:t,orphaned_items:0,expired_items:r,version_mismatches:s,session_conflicts:0,largest_item:n,oldest_item:o,storage_efficiency:e>0?(e-1e3*(t+r))/e*100:100}}determineOverallHealth(e){const t=e.filter(e=>"critical"===e.severity).length,r=e.filter(e=>"high"===e.severity).length,s=e.filter(e=>"medium"===e.severity).length;return t>0?"critical":r>2||r>0&&s>3?"corrupted":r>0||s>2?"degraded":"healthy"}generateRecommendations(e,t){const r=[];return e.filter(e=>"critical"===e.severity).length>0&&(r.push("Immediate action required: Perform emergency storage cleanup"),r.push("Consider using incognito mode temporarily")),t.total_size>4194304&&r.push("Clear old cached data to free up storage space"),t.corrupted_items>5&&r.push("Run storage integrity check and auto-fix"),e.filter(e=>"session_conflict"===e.type).length>0&&r.push("Clear conflicting session data and re-login"),t.expired_items>10&&r.push("Enable automatic cleanup of expired items"),0===r.length&&r.push("Storage is healthy - no action required"),r}startHealthMonitoring(){setTimeout(()=>{this.performHealthCheck({autoFix:!0})},5e3),this.healthCheckInterval=setInterval(()=>{this.performHealthCheck({autoFix:!0})},this.HEALTH_CHECK_INTERVAL)}stopHealthMonitoring(){this.healthCheckInterval&&(clearInterval(this.healthCheckInterval),this.healthCheckInterval=null)}getLastHealthCheck(){return this.lastHealthCheck}};c(Re,"instance");const Pe=Re.getInstance();"undefined"!=typeof window&&(window.storageHealthChecker=Pe,window.runStorageHealthCheck=()=>Pe.performHealthCheck({autoFix:!0,detailed:!0}));const Ee=class e{constructor(){c(this,"sessionValidationPromise",null),c(this,"lastValidationTime",0),c(this,"VALIDATION_CACHE_DURATION",3e5),c(this,"MAX_RETRY_ATTEMPTS",5),c(this,"RETRY_DELAY_BASE",1e3),c(this,"isRefreshing",!1),c(this,"refreshPromise",null),c(this,"currentContext",null),c(this,"sessionChangeListeners",new Set),c(this,"sessionMonitorInterval",null),c(this,"SESSION_TIMEOUT",864e5),c(this,"ACTIVITY_CHECK_INTERVAL",3e5),c(this,"isCleanupInProgress",!1),this.initializeSessionMonitoring(),this.setupSupabaseAuthListener()}static getInstance(){return e.instance||(e.instance=new e),e.instance}validateSession(){return u(this,null,function*(){return this.sessionValidationPromise&&Date.now()-this.lastValidationTime<this.VALIDATION_CACHE_DURATION?(console.log("[SessionManager] Using cached session validation"),this.sessionValidationPromise):(this.lastValidationTime=Date.now(),this.sessionValidationPromise=this.performValidation(),this.sessionValidationPromise)})}performValidation(){return u(this,null,function*(){let e=null;for(let r=1;r<=this.MAX_RETRY_ATTEMPTS;r++)try{console.log(`[SessionManager] Validating session (attempt ${r}/${this.MAX_RETRY_ATTEMPTS})`);const{data:{session:e},error:t}=yield ke.auth.getSession();if(t)throw t;if(!e)return console.log("[SessionManager] No session found"),{isValid:!1,session:null,error:"No session found"};const s=e.expires_at;if(s&&1e3*s-Date.now()<6e4){console.log("[SessionManager] Token expired or expiring soon, refreshing...");const e=yield this.refreshSession();return e?{isValid:!0,session:e}:{isValid:!1,session:null,error:"Failed to refresh expired token"}}const{data:{user:n},error:o}=yield ke.auth.getUser(e.access_token);if(o||!n){console.log("[SessionManager] Session validation failed, attempting refresh");const e=yield this.refreshSession();return e?{isValid:!0,session:e}:{isValid:!1,session:null,error:(null==o?void 0:o.message)||"User validation failed"}}return console.log("[SessionManager] Session validated successfully"),{isValid:!0,session:e}}catch(t){if(e=t,console.error(`[SessionManager] Validation attempt ${r} failed:`,t),r<this.MAX_RETRY_ATTEMPTS){const e=this.RETRY_DELAY_BASE*Math.pow(2,r-1);console.log(`[SessionManager] Retrying in ${e}ms...`),yield new Promise(t=>setTimeout(t,e))}}return console.error("[SessionManager] All validation attempts failed"),{isValid:!1,session:null,error:(null==e?void 0:e.message)||"Session validation failed after all retries"}})}refreshSession(){return u(this,null,function*(){if(this.isRefreshing&&this.refreshPromise)return console.log("[SessionManager] Refresh already in progress, waiting..."),this.refreshPromise;this.isRefreshing=!0,this.refreshPromise=this.performRefresh();try{return yield this.refreshPromise}finally{this.isRefreshing=!1,this.refreshPromise=null}})}performRefresh(){return u(this,null,function*(){var e;try{console.log("[SessionManager] Refreshing session token...");const{data:{session:s},error:n}=yield ke.auth.refreshSession();if(n){console.error("[SessionManager] Token refresh failed:",n);const r=`sb-${(void 0).split("//")[1].split(".")[0]}-auth-token`,s=localStorage.getItem(r);if(s)try{const t=JSON.parse(s);if(null==(e=null==t?void 0:t.currentSession)?void 0:e.refresh_token){console.log("[SessionManager] Attempting refresh with stored refresh token");const{data:{session:e},error:r}=yield ke.auth.refreshSession({refresh_token:t.currentSession.refresh_token});if(!r&&e)return console.log("[SessionManager] Session refreshed with stored token"),yield ke.auth.setSession({access_token:e.access_token,refresh_token:e.refresh_token}),e}}catch(t){console.error("[SessionManager] Failed to use stored refresh token:",t)}return null}if(s){console.log("[SessionManager] Session refreshed successfully");try{yield ke.auth.setSession({access_token:s.access_token,refresh_token:s.refresh_token}),console.log("[SessionManager] Refreshed session persisted to storage")}catch(r){console.error("[SessionManager] Failed to persist refreshed session:",r)}this.sessionValidationPromise=null,this.lastValidationTime=0}return s}catch(s){return console.error("[SessionManager] Unexpected error during refresh:",s),null}})}ensureValidSession(){return u(this,null,function*(){const e=yield this.validateSession();if(!e.isValid){console.log("[SessionManager] Session invalid, attempting to recover...");return(yield this.refreshSession())||(console.log("[SessionManager] Unable to recover session, clearing auth state"),yield this.clearAuthState(),null)}return e.session})}initializeSession(){return u(this,null,function*(){console.log("[SessionManager] Initializing session with isolation checks...");try{if(yield this.detectSessionCorruption())return console.warn("[SessionManager] Session corruption detected, performing cleanup"),yield this.performEmergencyCleanup(),null;const{data:{session:e}}=yield ke.auth.getSession();if(!e||!e.user)return console.log("[SessionManager] No active session found"),yield this.clearSessionComplete(),null;const t=yield this.createSessionContext(e),r=this.currentContext;return r&&r.user_id!==t.user_id?(console.log("[SessionManager] User change detected, cleaning previous session"),yield this.handleUserChange(r,t)):r&&r.tenant_id!==t.tenant_id?(console.log("[SessionManager] Tenant change detected, cleaning previous session"),yield this.handleTenantChange(r,t)):yield this.setSessionContext(t),this.currentContext}catch(e){return console.error("[SessionManager] Failed to initialize session:",e),yield this.performEmergencyCleanup(),null}})}setSessionContext(e){return u(this,null,function*(){console.log("[SessionManager] Setting session context:",{user_id:e.user_id,tenant_id:e.tenant_id,email:e.email,session_id:e.session_id});const t=this.currentContext;this.currentContext=e,Ae.setContext({user_id:e.user_id,tenant_id:e.tenant_id,email:e.email}),Ae.set(_e,e,{skipIntegrityCheck:!1,ttl:this.SESSION_TIMEOUT}),yield this.notifySessionChange({type:t?"user_change":"login",previous_context:t||void 0,new_context:e,cleanup_performed:!1,timestamp:Date.now()}),console.log("[SessionManager] Session context set successfully")})}clearSessionComplete(){return u(this,null,function*(){if(this.isCleanupInProgress)console.log("[SessionManager] Cleanup already in progress, waiting...");else{this.isCleanupInProgress=!0;try{console.log("[SessionManager] Starting complete session cleanup...");const e=this.currentContext;this.currentContext=null,Ae.clearContext(),yield this.performComprehensiveCleanup(),yield this.notifySessionChange({type:"logout",previous_context:e||void 0,new_context:void 0,cleanup_performed:!0,timestamp:Date.now()}),console.log("[SessionManager] Complete session cleanup finished")}finally{this.isCleanupInProgress=!1}}})}handleUserChange(e,t){return u(this,null,function*(){console.log("[SessionManager] Handling user change:",{previous_user:e.email,new_user:t.email}),yield this.performUserSpecificCleanup(e),yield this.setSessionContext(t),yield this.notifySessionChange({type:"user_change",previous_context:e,new_context:t,cleanup_performed:!0,timestamp:Date.now()})})}handleTenantChange(e,t){return u(this,null,function*(){console.log("[SessionManager] Handling tenant change:",{user:t.email,previous_tenant:e.tenant_id,new_tenant:t.tenant_id}),yield this.performTenantSpecificCleanup(e),yield this.setSessionContext(t),yield this.notifySessionChange({type:"tenant_change",previous_context:e,new_context:t,cleanup_performed:!0,timestamp:Date.now()})})}performComprehensiveCleanup(){return u(this,null,function*(){console.log("[SessionManager] Performing comprehensive cleanup...");try{this.currentContext&&Ae.clearUserData(this.currentContext),yield this.clearLegacyStorage(),yield Pe.performHealthCheck({autoFix:!0}),yield this.clearAuthState(),console.log("[SessionManager] Comprehensive cleanup completed")}catch(e){console.error("[SessionManager] Error during comprehensive cleanup:",e)}})}performUserSpecificCleanup(e){return u(this,null,function*(){console.log("[SessionManager] Performing user-specific cleanup for:",e.email);try{Ae.clearUserData(e),console.log("[SessionManager] User-specific cleanup completed")}catch(t){console.error("[SessionManager] Error during user-specific cleanup:",t)}})}performTenantSpecificCleanup(e){return u(this,null,function*(){console.log("[SessionManager] Performing tenant-specific cleanup for tenant:",e.tenant_id);try{const t=["city_access","bootstrap_data","permissions_cache"];for(const r of t)Ae.remove(r,{context:{tenant_id:e.tenant_id,user_id:e.user_id}});console.log("[SessionManager] Tenant-specific cleanup completed")}catch(t){console.error("[SessionManager] Error during tenant-specific cleanup:",t)}})}clearLegacyStorage(){return u(this,null,function*(){const e=["city_access_cache","bootstrap_cache","auth_cache","user_context"];for(let r=localStorage.length-1;r>=0;r--){const s=localStorage.key(r);if(s&&e.some(e=>s.includes(e)||s.startsWith(e)))try{localStorage.removeItem(s)}catch(t){console.warn("[SessionManager] Failed to remove legacy key:",s,t)}}console.log("[SessionManager] Legacy storage cleared")})}detectSessionCorruption(){return u(this,null,function*(){try{const e=[];for(let s=0;s<localStorage.length;s++){const t=localStorage.key(s);t&&t.includes(_e)&&e.push(t)}if(e.length>3)return console.warn("[SessionManager] Multiple session contexts detected"),!0;const{data:{session:t}}=yield ke.auth.getSession();if(t&&this.currentContext&&t.user.id!==this.currentContext.user_id)return console.warn("[SessionManager] Session user mismatch detected"),!0;const r=yield Pe.performHealthCheck();return("critical"===r.overall_health||"corrupted"===r.overall_health)&&(console.warn("[SessionManager] Storage corruption detected by health checker"),!0)}catch(e){return console.error("[SessionManager] Error detecting corruption:",e),!0}})}performEmergencyCleanup(){return u(this,null,function*(){console.log("[SessionManager] Performing emergency cleanup...");try{Ae.clearAll(),yield this.clearAuthState(),yield this.notifySessionChange({type:"cleanup",previous_context:this.currentContext||void 0,new_context:void 0,cleanup_performed:!0,timestamp:Date.now()}),this.currentContext=null,console.log("[SessionManager] Emergency cleanup completed")}catch(e){console.error("[SessionManager] Emergency cleanup failed:",e)}})}createSessionContext(e){return u(this,null,function*(){var t,r;const s=e.user;let n="";try{e.access_token&&e.access_token.includes(".")&&3===e.access_token.split(".").length?n=JSON.parse(atob(e.access_token.split(".")[1])).tenant_id||"":"mock-token-123"===e.access_token&&(n="tenant-a")}catch(o){n=(null==(t=s.app_metadata)?void 0:t.tenant_id)||(null==(r=s.user_metadata)?void 0:r.tenant_id)||""}return{user_id:s.id,tenant_id:n,email:s.email||"",session_id:`session_${s.id}_${Date.now()}`,login_timestamp:Date.now(),last_activity:Date.now()}})}setupSupabaseAuthListener(){ke.auth.onAuthStateChange((e,t)=>u(this,null,function*(){switch(console.log("[SessionManager] Supabase auth state changed:",e),e){case"SIGNED_IN":if(t){const e=yield this.createSessionContext(t);yield this.setSessionContext(e)}break;case"SIGNED_OUT":yield this.clearSessionComplete();break;case"TOKEN_REFRESHED":t&&this.currentContext&&(this.currentContext.last_activity=Date.now())}}))}initializeSessionMonitoring(){this.sessionMonitorInterval=setInterval(()=>u(this,null,function*(){this.currentContext&&Date.now()-this.currentContext.last_activity>this.SESSION_TIMEOUT&&(console.log("[SessionManager] Session timeout detected, clearing session"),yield this.clearSessionComplete())}),this.ACTIVITY_CHECK_INTERVAL)}updateActivity(){this.currentContext&&(this.currentContext.last_activity=Date.now())}addSessionChangeListener(e){this.sessionChangeListeners.add(e)}removeSessionChangeListener(e){this.sessionChangeListeners.delete(e)}notifySessionChange(e){return u(this,null,function*(){const t=Array.from(this.sessionChangeListeners).map(t=>u(this,null,function*(){try{yield t(e)}catch(r){console.error("[SessionManager] Session change listener error:",r)}}));yield Promise.all(t)})}getCurrentContext(){return this.currentContext}isLoggedInWithContext(){return null!==this.currentContext}clearAuthState(){return u(this,null,function*(){console.log("[SessionManager] Clearing all authentication state");try{yield ke.auth.signOut()}catch(t){console.error("[SessionManager] Error during signOut:",t)}const e=[];for(let r=0;r<localStorage.length;r++){const t=localStorage.key(r);t&&(t.includes("supabase")||t.includes("auth")||t.includes("token")||t.includes("session"))&&e.push(t)}e.forEach(e=>{localStorage.removeItem(e),console.log("[SessionManager] Removed auth key:",e)}),sessionStorage.clear(),this.sessionValidationPromise=null,this.lastValidationTime=0,this.isRefreshing=!1,this.refreshPromise=null})}getCurrentSession(){return u(this,null,function*(){try{const{data:{session:e}}=yield ke.auth.getSession();return e}catch(e){return console.error("[SessionManager] Error getting current session:",e),null}})}hasSession(){return u(this,null,function*(){return null!==(yield this.getCurrentSession())})}invalidateCache(){console.log("[SessionManager] Invalidating session validation cache"),this.sessionValidationPromise=null,this.lastValidationTime=0}};c(Ee,"instance");const Oe=Ee.getInstance(),Te=(()=>{if("undefined"!=typeof window&&"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname)return console.log(`[SecureAPI] Using relative URLs for ${window.location.hostname}`),"";const e="http://localhost:8000";return e.includes("localhost")?"http://localhost:8000":e})();class Le extends Error{constructor(e){super(e),this.name="TenantIsolationError"}}const De=class e{constructor(){c(this,"backendUrl"),c(this,"requestCount",0),c(this,"securityViolations",[]),c(this,"cachedToken",null),c(this,"cachedTenantId",null),c(this,"pendingRequests",new Map),c(this,"requestCache",new Map),c(this,"CACHE_TTL",5e3),this.backendUrl=Te,this.interceptDirectQueries()}static getInstance(){return e.instance||(e.instance=new e),e.instance}interceptDirectQueries(){}getAuthHeaders(){return u(this,null,function*(){let e=this.cachedToken;if(!e){console.log("[SecureAPI] No cached token, waiting for session or validating...");const t=(yield this.waitForSession(5e3))||(yield Oe.ensureValidSession());if(!t||!t.access_token)throw new Le("No valid authentication token available");e=t.access_token,this.cachedToken=e}return{Authorization:`Bearer ${e}`,"Content-Type":"application/json","X-Request-ID":`req_${Date.now()}_${++this.requestCount}`,"X-Client-Version":"2.0.0-secure"}})}setAccessToken(e){if(this.cachedToken!==e){const t=this.cachedTenantId;this.cachedTenantId=null,this.clearCache(),t&&e&&console.log("[SecureAPI SECURITY] Tenant context changed - cache cleared",{previousTenant:t,timestamp:(new Date).toISOString()})}this.cachedToken=e||null}getTenantId(){return u(this,null,function*(){var e;if(this.cachedTenantId)return this.cachedTenantId;try{const t=this.cachedToken;if(t){let r=null;if("mock-token-123"===t)r="tenant-a";else if(t.includes(".")&&3===t.split(".").length){const s=JSON.parse(atob(t.split(".")[1]));r=(null==(e=s.user_metadata)?void 0:e.tenant_id)||s.tenant_id}if(r){if(this.isValidTenantId(r))return this.cachedTenantId=r,this.cachedTenantId;console.error("[SecureAPI] Invalid tenant ID format:",r),this.cachedToken=null,this.cachedTenantId=null}}}catch(t){console.error("[SecureAPI] JWT parsing failed - clearing session:",t),this.cachedToken=null,this.cachedTenantId=null,this.clearCache()}return null})}getUserSessionKey(){return u(this,null,function*(){try{const e=this.cachedToken;if(e){const t=JSON.parse(atob(e.split(".")[1])),r=t.sub,s=t.email;if(r&&s)return`${r.substring(0,8)}-${s.split("@")[0]}`}}catch(e){console.error("[SecureAPI] Failed to extract user session key:",e)}return null})}isValidTenantId(e){return"string"==typeof e&&e.length>0&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}clearCache(){this.requestCache.clear(),this.pendingRequests.clear(),console.log("[SecureAPI] Cache cleared due to tenant/token change")}clearEndpointCache(e){let t=0;const r=[];for(const[n,o]of this.requestCache.entries())n.includes(e)&&(r.push(n),t++);r.forEach(e=>{this.requestCache.delete(e)});const s=[];for(const[n,o]of this.pendingRequests.entries())n.includes(e)&&s.push(n);return s.forEach(e=>{this.pendingRequests.delete(e)}),t>0&&console.log(`[SecureAPI] Cleared ${t} cache entries for pattern: ${e}`),t}getCacheDiagnostics(){var e,t,r;const s=Date.now();let n=0,o=0,i=1/0;const a=[];for(const[l,c]of this.requestCache.entries()){const u=s-c.timestamp;if(u>o&&(o=u),u<i&&(i=u),l.includes("secure/cleaning/reports")){n++;const s=(null==(e=c.data)?void 0:e.items)||(null==(t=c.data)?void 0:t.data)||[],o=(null==(r=c.data)?void 0:r.total)||0;0===o&&l.includes("overdue")&&a.push({key:l,age:u,data:{total:o,itemsCount:s.length}})}}return{totalCacheEntries:this.requestCache.size,totalPendingRequests:this.pendingRequests.size,cleaningCacheEntries:n,oldestCacheAge:o,newestCacheAge:i===1/0?0:i,suspiciousEntries:a}}emergencySecurityClear(){console.warn("[SecureAPI EMERGENCY] Security clear - all cache and session data cleared"),this.cachedToken=null,this.cachedTenantId=null,this.requestCache.clear(),this.pendingRequests.clear(),this.securityViolations=[]}generateCacheKey(e,t,r){return u(this,null,function*(){const s=yield this.getUserSessionKey(),n=s?`:${s}`:"";let o;if(t.includes("?")){const[s,i]=t.split("?"),a=new URLSearchParams(i),l=Array.from(a.entries()).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&");o=`${e}:${s}?${l}:${r}${n}`}else o=`${e}:${t}:${r}${n}`;return(t.includes("secure/cleaning/reports")||t.includes("properties"))&&console.log("[SecureAPI] Generated cache key:",{endpoint:t,cacheKey:o.length>100?o.substring(0,100)+"...":o,hasQueryParams:t.includes("?")}),o})}shouldCacheCleaningResult(e,t){return!e.includes("/cleaning/reports")||((null==t?void 0:t.items)||null==t||t.data,null==t||t.total,!(!t||"object"!=typeof t||!(t.hasOwnProperty("items")||t.hasOwnProperty("data")||t.hasOwnProperty("total")))||null!=t||(console.warn("[SecureAPI] Not caching null/undefined cleaning result"),!1))}isCacheResultValid(e,t,r){return e.includes("/cleaning/reports")?((null==t?void 0:t.items)||null==t||t.data,null==t||t.total,!(r>3e4||null==t||("object"!=typeof t||!("items"in t)&&!("data"in t))&&(console.warn("[SecureAPI] Invalidating malformed cached cleaning result"),1))):r<this.CACHE_TTL}waitForSession(e=7e3){return u(this,null,function*(){var t;const r=()=>{var e;try{if("undefined"==typeof localStorage)return null;for(let t=0;t<localStorage.length;t++){const r=localStorage.key(t)||"";if(r.startsWith("sb-")&&r.endsWith("-auth-token")){const t=localStorage.getItem(r);if(!t)continue;const s=JSON.parse(t),n=(null==s?void 0:s.access_token)||(null==(e=null==s?void 0:s.currentSession)?void 0:e.access_token);if(n)return n}}}catch(t){}return null},s=()=>u(null,null,function*(){var e;return(null==(e=(yield ke.auth.getSession()).data.session)?void 0:e.access_token)||r()}),n=yield ke.auth.getSession();if(null==(t=n.data.session)?void 0:t.access_token)return n.data.session;const o=r();if(o)return{access_token:o};let i=null,a=!1;const l=new Promise(e=>{const{data:t}=ke.auth.onAuthStateChange((t,r)=>{!a&&(null==r?void 0:r.access_token)&&(a=!0,i&&i(),e(r))});i=()=>t.subscription.unsubscribe()}),c=new Promise(t=>u(null,null,function*(){const r=Date.now();for(;Date.now()-r<e;){const e=yield s();if(e)return a=!0,i&&i(),void t({access_token:e});yield new Promise(e=>setTimeout(e,200))}t(null)})),d=new Promise(t=>setTimeout(()=>t(null),e)),h=yield Promise.race([l,c,d]);return i&&i(),h})}request(e){return u(this,arguments,function*(e,t={}){const r=t.method||"GET",s="GET"===r,n=(new Date).toISOString();console.log(`[API REQUEST] ${n} - ${r} ${e}`);const o=yield this.getTenantId();if(!o)return console.warn(`[API SECURITY] No valid tenant ID - bypassing cache for ${e}`),this.executeRequest(e,t,null,!1);const i=yield this.generateCacheKey(r,e,o);if(s){const t=this.requestCache.get(i);if(t){const r=Date.now()-t.timestamp;if(this.isCacheResultValid(e,t.data,r))return console.log(`[API CACHE HIT] ${e} (tenant: ${o}) age: ${r}ms`),t.data;console.log(`[API CACHE INVALID] ${e} - removing stale/suspicious entry`),this.requestCache.delete(i)}const r=this.pendingRequests.get(i);if(r){console.log(`[API DEDUP] ${e} - waiting for pending request (tenant: ${o})`);try{const t=yield Promise.race([r,new Promise((e,t)=>{setTimeout(()=>t(new Error("Pending request timeout")),1e4)})]);return console.log(`[API DEDUP SUCCESS] ${e} - returned cached result`),t}catch(l){console.warn("[SecureAPI] Pending request failed or timed out, making fresh request:",l),this.pendingRequests.delete(i)}}}const a=this.executeRequest(e,t,i,s);return s&&i&&this.pendingRequests.set(i,a),a})}executeRequest(e,t,r,s){return u(this,null,function*(){let n=null;for(let d=1;d<=3;d++)try{const n=yield this.getAuthHeaders(),c=`${this.backendUrl}${e}`;1===d?console.log(`üîí Secure API Request: ${t.method||"GET"} ${e}`):console.log(`üîí Secure API Request: ${t.method||"GET"} ${e} (retry ${d-1}/2)`);const h=yield fetch(c,l(a({},t),{headers:a(a({},n),t.headers)}));if(!h.ok){let e="";try{e=yield h.text()}catch(o){}let t="",r=null;try{r=JSON.parse(e),t=(null==r?void 0:r.detail)||(null==r?void 0:r.message)||"",console.error("üî¥ API Error Details:",{status:h.status,statusText:h.statusText,errorData:r,bodyText:e,url:h.url})}catch(i){console.error("üî¥ Could not parse error response:",e)}if(403===h.status)throw new Le(t||"Access denied: You can only access data from your organization");if(401===h.status){console.log("[SecureAPI] Got 401, attempting to refresh session...");const{sessionValidator:e}=yield P(()=>u(this,null,function*(){const{sessionValidator:e}=yield import("./sessionValidator-CHh5e7zs.js");return{sessionValidator:e}}),__vite__mapDeps([0,1,2,3,4,5,6]));this.cachedToken=null;const t=yield e.validateSession();if((null==t?void 0:t.access_token)&&(console.log("[SecureAPI] Session refreshed, will retry with new token"),this.cachedToken=t.access_token,d<3))throw new Error("Authentication refreshed, will retry with new token");throw new Error("Authentication failed - please login again")}const s=t||e||`${h.status} ${h.statusText}`;throw new Error(`API request failed: ${s}`)}let p;const g=h.headers.get("content-type");if(204===h.status||205===h.status)p=null;else if(g&&g.includes("application/json")){const e=yield h.text();p=e.trim()?JSON.parse(e):null}else p=(yield h.text())||null;return s&&null!==p&&r&&(this.shouldCacheCleaningResult(e,p)?(this.requestCache.set(r,{data:p,timestamp:Date.now()}),console.log(`[API CACHE STORE] ${e} (tenant: ${r.split(":")[2]})`)):console.log(`[API CACHE SKIP] ${e} - result validation failed`)),s&&r&&this.pendingRequests.delete(r),p}catch(c){if(n=c,s&&r&&this.pendingRequests.delete(r),c instanceof Le)throw c;if(console.error(`[SecureAPI] Attempt ${d}/3 failed:`,c),d<3){const e=1e3*Math.pow(2,d-1)+500*Math.random();console.log(`[SecureAPI] Retrying in ${Math.round(e)}ms...`),yield new Promise(t=>setTimeout(t,e))}}throw s&&r&&(this.pendingRequests.delete(r),this.requestCache.delete(r),console.log(`[API CACHE CLEAR] ${e} - cleared due to failed request`)),console.error("[SecureAPI] All retry attempts failed"),n||new Error("Request failed after all retries")})}requestPublic(e){return u(this,arguments,function*(e,t={}){const r=`${this.backendUrl}${e}`,s=yield fetch(r,l(a({},t),{headers:a({"Content-Type":"application/json","X-Request-ID":`req_${Date.now()}_${++this.requestCount}`,"X-Client-Version":"2.0.0-secure"},t.headers||{})}));if(!s.ok)throw new Error(`API request failed: ${s.status} ${s.statusText}`);return s.json()})}getAllReservations(){return u(this,null,function*(){return this.request("/api/v1/reservations/all")})}getReservations(e){return u(this,null,function*(){var t,r;const s=yield this.getCachedReservations(),n=Array.isArray(null==s?void 0:s.data)?s.data:Array.isArray(s)?s:(null==s?void 0:s.items)||[],o=((null==e?void 0:e.search)||"").toString().toLowerCase(),i=(null==e?void 0:e.property_id)||"",a=((null==e?void 0:e.status)||"").toString().toLowerCase(),l=(null==e?void 0:e.date_from)?new Date(e.date_from):null,c=(null==e?void 0:e.date_to)?new Date(e.date_to):null,u=n.filter(e=>{if(!e)return!1;if(i&&String(e.property_id)!==String(i))return!1;if(a&&String(e.status||"").toLowerCase()!==a)return!1;if(l){const t=e.checkin_date?new Date(e.checkin_date):null;if(!t||t<l)return!1}if(c){const t=e.checkout_date?new Date(e.checkout_date):null;if(!t||t>c)return!1}if(o){const t=String(e.guest_name||"").toLowerCase(),r=String(e.guest_email||"").toLowerCase(),s=String(e.reservation_id||e.id||"").toLowerCase();if(!(t.includes(o)||r.includes(o)||s.includes(o)))return!1}return!0}),d=null!=(t=null==e?void 0:e.limit)?t:50,h=null!=(r=null==e?void 0:e.offset)?r:0;return{data:u.slice(h,h+d),total:u.length,limit:d,offset:h}})}getReservationSuggestions(e,t=10,r){return u(this,null,function*(){const s=a({search:e,limit:Math.max(1,Math.min(t,1e3))},(null==r?void 0:r.status)?{status:r.status}:{});return this.request("/api/v1/reservations-suggest",{method:"POST",body:JSON.stringify(s)})})}getReservation(e){return u(this,null,function*(){return this.request(`/api/v1/reservations/${e}`)})}getCachedReservations(e=!1){return u(this,null,function*(){const t=e?"/api/v1/reservations/all?force_refresh=true":"/api/v1/reservations/all";return this.request(t)})}getReservationsProgressive(e,t){return u(this,null,function*(){const r=new URLSearchParams;return r.set("offset",e.toString()),r.set("limit",t.toString()),this.request(`/api/v1/reservations/all?${r.toString()}`)})}getReservationFilterOptions(){return u(this,null,function*(){return this.request("/api/v1/filter-options")})}invalidateReservationCache(e){return u(this,null,function*(){const t=new URLSearchParams;e&&t.set("property_id",e);const r=t.toString()?`?${t.toString()}`:"";return this.request(`/api/v1/cache/invalidate${r}`,{method:"POST"})})}getReservationDistinctValues(e){return u(this,null,function*(){return this.request(`/api/v1/reservations/distinct-values/${e}`)})}updateReservation(e,t){return u(this,null,function*(){return this.request(`/api/v1/reservations/${e}`,{method:"PUT",body:JSON.stringify(t)})})}createReservation(e){return u(this,null,function*(){return this.request("/api/v1/reservations",{method:"POST",body:JSON.stringify(e)})})}deleteReservation(e){return u(this,null,function*(){return this.request(`/api/v1/reservations/${e}`,{method:"DELETE"})})}bulkUpdateReservations(e,t){return u(this,null,function*(){return this.request("/api/v1/reservations/bulk-update",{method:"POST",body:JSON.stringify({ids:e,updates:t})})})}createUser(e){return u(this,null,function*(){return this.request("/api/v1/users",{method:"POST",body:JSON.stringify(e)})})}updateUser(e,t){return u(this,null,function*(){return this.request(`/api/v1/users/${e}`,{method:"PUT",body:JSON.stringify(t)})})}getProperties(e){return u(this,null,function*(){var t,r;console.log("[SecureAPI.getProperties] Called with filters:",e);const s=new URLSearchParams;e&&Object.entries(e).forEach(([e,t])=>{void 0!==t&&s.append(e,String(t))}),s.has("page_size")||s.append("page_size","1000");const n=`/api/v1/properties?${s}`;console.log("[SecureAPI.getProperties] Requesting endpoint:",n);try{const e=yield this.request(n);return console.log("[SecureAPI.getProperties] Request successful"),console.log("[SecureAPI.getProperties] Result type:",typeof e),e&&"object"==typeof e?(console.log("[SecureAPI.getProperties] Result keys:",Object.keys(e)),"items"in e?(console.log("[SecureAPI.getProperties] Found items array with",(null==(t=e.items)?void 0:t.length)||0,"properties"),{data:e.items||[],total:e.total||0}):"data"in e?(console.log("[SecureAPI.getProperties] Found data array with",(null==(r=e.data)?void 0:r.length)||0,"properties"),e):Array.isArray(e)?(console.log("[SecureAPI.getProperties] Result is array with",e.length,"properties"),{data:e,total:e.length}):(console.warn("[SecureAPI.getProperties] Unexpected result format, returning empty data"),{data:[],total:0})):(console.log("[SecureAPI.getProperties] Returning empty data for null/undefined result"),{data:[],total:0})}catch(o){throw console.error("[SecureAPI.getProperties] Request failed:",o),o}})}getProperty(e){return u(this,null,function*(){return this.request(`/api/v1/properties/${e}`)})}updateProperty(e,t){return u(this,null,function*(){return this.request(`/api/v1/properties/${e}`,{method:"PUT",body:JSON.stringify(t)})})}getPropertyNotes(e){return u(this,null,function*(){return this.request(`/api/v1/properties/${e}/notes`)})}createPropertyNote(e,t){return u(this,null,function*(){return this.request(`/api/v1/properties/${e}/notes`,{method:"POST",body:JSON.stringify({note:t})})})}deletePropertyNote(e){return u(this,null,function*(){return this.request(`/api/v1/properties/notes/${e}`,{method:"DELETE"})})}getPropertyAppliances(e){return u(this,null,function*(){return this.request(`/api/v1/properties/${e}/appliances`)})}createPropertyAppliance(e,t){return u(this,null,function*(){return this.request(`/api/v1/properties/${e}/appliances`,{method:"POST",body:JSON.stringify(t)})})}createAppliance(e,t){return u(this,null,function*(){return this.createPropertyAppliance(e,t)})}updatePropertyAppliance(e,t,r){return u(this,null,function*(){return this.request(`/api/v1/properties/${e}/appliances/${t}`,{method:"PUT",body:JSON.stringify(r)})})}updateAppliance(e,t,r){return u(this,null,function*(){return this.updatePropertyAppliance(e,t,r)})}deletePropertyAppliance(e,t){return u(this,null,function*(){return this.request(`/api/v1/properties/${e}/appliances/${t}`,{method:"DELETE",body:JSON.stringify({property_id:e})})})}deleteAppliance(e,t){return u(this,null,function*(){return this.deletePropertyAppliance(e,t)})}getPropertyContracts(e){return u(this,null,function*(){return this.request(`/api/v1/properties/${e}/contracts`)})}createPropertyContract(e,t){return u(this,null,function*(){return this.request(`/api/v1/properties/${e}/contracts`,{method:"POST",body:JSON.stringify(t)})})}updatePropertyContract(e,t,r){return u(this,null,function*(){return this.request(`/api/v1/properties/${e}/contracts/${t}`,{method:"PUT",body:JSON.stringify(r)})})}deletePropertyContract(e,t){return u(this,null,function*(){return this.request(`/api/v1/properties/${e}/contracts/${t}`,{method:"DELETE"})})}getContractSignedUrl(e,t){return u(this,null,function*(){return this.request(`/api/v1/properties/${e}/contracts/${t}/signed-url`)})}createProperty(e){return u(this,null,function*(){return this.request("/api/v1/properties",{method:"POST",body:JSON.stringify(e)})})}getPropertyAvailability(e,t,r){return u(this,null,function*(){return this.request(`/api/v1/properties/${e}/availability?start=${t}&end=${r}`)})}getAvailabilityChecks(){return u(this,null,function*(){return this.request("/api/v1/availability-checks")})}getReputationProperties(e){return u(this,null,function*(){const t=new URLSearchParams;return e&&Object.entries(e).forEach(([e,r])=>{void 0!==r&&t.append(e,String(r))}),this.request(`/api/v1/reputation/properties?${t}`)})}getReputationNotes(e){return u(this,null,function*(){const t=new URLSearchParams;return e&&e.length&&t.append("property_ids",e.join(",")),this.request(`/api/v1/reputation/notes?${t}`)})}createReputationNote(e){return u(this,null,function*(){return this.request("/api/v1/reputation/notes",{method:"POST",body:JSON.stringify(e)})})}deleteReputationNote(e){return u(this,null,function*(){return this.request(`/api/v1/reputation/notes/${e}`,{method:"DELETE"})})}getLockboxes(e){return u(this,null,function*(){const t=new URLSearchParams;return(null==e?void 0:e.propertyId)&&t.append("property_id",e.propertyId),(null==e?void 0:e.city)&&t.append("city",e.city),(null==e?void 0:e.page)&&t.append("page",e.page.toString()),(null==e?void 0:e.limit)&&t.append("limit",e.limit.toString()),(null==e?void 0:e.search)&&t.append("search",e.search),(null==e?void 0:e.status)&&t.append("status",e.status),(null==e?void 0:e.lockbox_type)&&t.append("lockbox_type",e.lockbox_type),this.request(`/api/v1/lockboxes?${t}`)})}getLockbox(e){return u(this,null,function*(){return this.request(`/api/v1/lockboxes/${e}`)})}createLockbox(e){return u(this,null,function*(){return this.request("/api/v1/lockboxes",{method:"POST",body:JSON.stringify(e)})})}updateLockbox(e,t){return u(this,null,function*(){return this.request(`/api/v1/lockboxes/${e}`,{method:"PUT",body:JSON.stringify(t)})})}deleteLockbox(e){return u(this,null,function*(){return this.request(`/api/v1/lockboxes/${e}`,{method:"DELETE"})})}getInternalKeys(e){return u(this,null,function*(){const t=new URLSearchParams;return(null==e?void 0:e.city)&&t.append("city",e.city),(null==e?void 0:e.page)&&t.append("page",e.page.toString()),(null==e?void 0:e.limit)&&t.append("limit",e.limit.toString()),(null==e?void 0:e.search)&&t.append("search",e.search),(null==e?void 0:e.status)&&t.append("status",e.status),this.request(`/api/v1/internal-keys?${t}`)})}createInternalKey(e){return u(this,null,function*(){return this.request("/api/v1/internal-keys",{method:"POST",body:JSON.stringify(e)})})}updateInternalKey(e,t){return u(this,null,function*(){return this.request(`/api/v1/internal-keys/${e}`,{method:"PUT",body:JSON.stringify(t)})})}deleteInternalKey(e){return u(this,null,function*(){return this.request(`/api/v1/internal-keys/${e}`,{method:"DELETE"})})}getInternalKey(e){return u(this,null,function*(){return this.request(`/api/v1/internal-keys/${e}`)})}getKeynestKeys(e){return u(this,null,function*(){const t=new URLSearchParams;return(null==e?void 0:e.city)&&t.append("city",e.city),this.request(`/api/v1/keynest-keys?${t}`)})}getActiveKeyAssignment(e){return u(this,null,function*(){const t=new URLSearchParams;return t.append("lockbox_id",e),this.request(`/api/v1/key-assignments/active?${t}`)})}getBulkActiveKeyAssignments(e){return u(this,null,function*(){return this.request("/api/v1/key-assignments/bulk-active",{method:"POST",body:JSON.stringify(e)})})}getAccessLogs(e,t,r,s=10){return u(this,null,function*(){const n=new URLSearchParams;return n.append("entity_id",e),n.append("entity_type",t),r&&n.append("action",r),n.append("limit",s.toString()),this.request(`/api/v1/access-logs?${n}`)})}getBulkLastViewed(e,t){return u(this,null,function*(){return this.request("/api/v1/access-logs/bulk-last-viewed",{method:"POST",body:JSON.stringify({entity_ids:e,entity_type:t})})})}logAccess(e,t,r="view"){return u(this,null,function*(){return this.request("/api/v1/access-logs",{method:"POST",body:JSON.stringify({entity_id:e,entity_type:t,action:r})})})}getCompanySettings(){return u(this,null,function*(){return this.request("/api/v1/company-settings")})}updateCompanySettings(e){return u(this,null,function*(){return this.request("/api/v1/company-settings",{method:"PUT",body:JSON.stringify(e)})})}getDashboardSummary(e,t){return u(this,null,function*(){const r=new URLSearchParams({property_id:e});(null==t?void 0:t.timestamp)&&r.append("_t",t.timestamp.toString());const s={};return(null==t?void 0:t.simulatedTenant)&&(s.headers={"X-Simulated-Tenant":t.simulatedTenant}),this.request(`/api/v1/dashboard/summary?${r}`,s)})}uploadCompanyLogo(e){return u(this,null,function*(){return this.request("/api/v1/company-settings/logo",{method:"POST",body:JSON.stringify({logo_url:e})})})}deleteCompanyLogo(){return u(this,null,function*(){return this.request("/api/v1/company-settings/logo",{method:"DELETE"})})}getPortalConfiguration(){return u(this,null,function*(){return this.request("/api/v1/portal-configuration")})}getDepartments(){return u(this,null,function*(){const e=yield this.request("/api/v1/departments");return Array.isArray(e)?e:Array.isArray(null==e?void 0:e.departments)?e.departments:[]})}createDepartment(e){return u(this,null,function*(){return yield this.request("/api/v1/departments",{method:"POST",body:JSON.stringify(e)})})}updateDepartment(e,t){return u(this,null,function*(){return yield this.request(`/api/v1/departments/${e}`,{method:"PUT",body:JSON.stringify(t)})})}deleteDepartment(e){return u(this,null,function*(){return yield this.request(`/api/v1/departments/${e}`,{method:"DELETE"})})}getMyDepartmentsWithPreferences(){return u(this,null,function*(){const e=yield this.request("/api/v1/departments/my-departments");return Array.isArray(e)?e:[]})}updateMyDepartmentPreference(e,t){return u(this,null,function*(){return yield this.request(`/api/v1/departments/my-departments/${e}/preference`,{method:"PUT",body:JSON.stringify({show_in_sidebar:t})})})}getProcessDocuments(e,t="active"){return u(this,null,function*(){const r=yield this.request(`/api/v1/departments/${e}/process-documents?status=${t}`);return Array.isArray(r)?r:[]})}createProcessDocument(e){return u(this,null,function*(){return this.request("/api/v1/process-documents",{method:"POST",headers:l(a({},yield this.getAuthHeaders()),{"Content-Type":"application/json"}),body:JSON.stringify(e)})})}updateProcessDocument(e,t){return u(this,null,function*(){const r={};return void 0!==t.title&&(r.title=t.title),void 0!==t.content&&(r.content=t.content),void 0!==t.status&&(r.status=t.status),this.request(`/api/v1/process-documents/${e}`,{method:"PUT",headers:l(a({},yield this.getAuthHeaders()),{"Content-Type":"application/json"}),body:JSON.stringify(r)})})}archiveProcessDocument(e){return u(this,null,function*(){return this.updateProcessDocument(e,{status:"archived"})})}restoreProcessDocument(e){return u(this,null,function*(){return this.updateProcessDocument(e,{status:"active"})})}listProcessDocumentAttachments(e){return u(this,null,function*(){return this.request(`/api/v1/process-documents/${e}/attachments`,{method:"GET",headers:yield this.getAuthHeaders()})})}getProcessDocument(e){return u(this,null,function*(){return this.request(`/api/v1/process-documents/${e}`)})}deleteProcessDocument(e){return u(this,null,function*(){return this.request(`/api/v1/process-documents/${e}`,{method:"DELETE"})})}uploadProcessDocumentAttachment(e,t){return u(this,null,function*(){const r=yield this.getAuthHeaders();delete r["Content-Type"];const s=new FormData;s.append("file",t),s.append("size",t.size.toString());const n=yield fetch(`${this.backendUrl}/api/v1/process-documents/${e}/attachments`,{method:"POST",headers:r,body:s});if(!n.ok){const e=yield n.text().catch(()=>"");throw new Error(`Upload failed (${n.status}) ${e}`)}return n.json()})}uploadInlineAttachment(e,t,r,s){return u(this,null,function*(){const n=yield this.getAuthHeaders();delete n["Content-Type"];const o=new FormData;o.append("file",t),o.append("size",t.size.toString()),o.append("node_id",r),s&&o.append("context_data",JSON.stringify(s));const i=yield fetch(`${this.backendUrl}/api/v1/process-documents/${e}/attachments/inline`,{method:"POST",headers:n,body:o});if(!i.ok){const e=yield i.text().catch(()=>"");throw new Error(`Upload failed (${i.status}) ${e}`)}return i.json()})}deleteProcessDocumentAttachment(e){return u(this,null,function*(){return this.request(`/api/v1/process-documents/attachments/${e}`,{method:"DELETE",headers:yield this.getAuthHeaders()})})}getAttachmentSignedUrl(e,t=3600){return u(this,null,function*(){return this.request(`/api/v1/process-documents/attachments/${e}/signed-url?expires_in=${t}`,{method:"GET",headers:yield this.getAuthHeaders()})})}getDepartmentDocuments(e,t="active"){return u(this,null,function*(){const r=yield this.request(`/api/v1/departments/${e}/documents?status=${t}`);return Array.isArray(r)?r:[]})}getPermissionTemplates(e){return u(this,null,function*(){const t=new URLSearchParams;(null==e?void 0:e.department_id)&&t.append("department_id",e.department_id),void 0!==(null==e?void 0:e.is_active)&&t.append("is_active",String(e.is_active));const r=yield this.request(`/api/v1/permission_templates?${t}`);return Array.isArray(null==r?void 0:r.permission_templates)?r.permission_templates:[]})}createPermissionTemplate(e){return u(this,null,function*(){return yield this.request("/api/v1/permission_templates",{method:"POST",body:JSON.stringify(e)})})}updatePermissionTemplate(e,t){return u(this,null,function*(){return yield this.request(`/api/v1/permission_templates/${e}`,{method:"PUT",body:JSON.stringify(t)})})}deletePermissionTemplate(e){return u(this,null,function*(){return yield this.request(`/api/v1/permission_templates/${e}`,{method:"DELETE"})})}getLogs(e){return u(this,null,function*(){const t=new URLSearchParams;return Object.entries(e||{}).forEach(([e,r])=>{null!=r&&""!==r&&t.append(e,String(r))}),this.request(`/api/v1/logs?${t.toString()}`)})}exportLogs(e){return u(this,null,function*(){const t=new URLSearchParams;return Object.entries(e||{}).forEach(([e,r])=>{null!=r&&""!==r&&t.append(e,String(r))}),this.request(`/api/v1/logs/export?${t.toString()}`)})}getAllProperties(){return u(this,null,function*(){const e=yield this.getProperties({page_size:1e3});return e&&"object"==typeof e&&"data"in e?e:Array.isArray(e)?{data:e,total:e.length}:{data:[],total:0}})}createLog(e){return u(this,null,function*(){return this.request("/api/v1/logs",{method:"POST",body:JSON.stringify(e)})})}updatePortalConfiguration(e){return u(this,null,function*(){return this.request("/api/v1/portal-configuration",{method:"PUT",body:JSON.stringify(e)})})}getCustomFields(){return u(this,null,function*(){return this.request("/api/v1/custom-fields")})}createCustomField(e){return u(this,null,function*(){return this.request("/api/v1/custom-fields",{method:"POST",body:JSON.stringify(e)})})}updateCustomField(e,t){return u(this,null,function*(){return this.request(`/api/v1/custom-fields/${e}`,{method:"PUT",body:JSON.stringify(t)})})}getCustomFieldValues(e){return u(this,null,function*(){var t,r;try{return yield this.request(`/api/v1/custom-fields/values/${e}`)}catch(s){return(null==(t=null==s?void 0:s.message)?void 0:t.includes("404"))||(null==(r=null==s?void 0:s.message)?void 0:r.includes("not found"))||console.debug("Custom field values fetch error:",null==s?void 0:s.message),{}}})}updateCustomFieldValues(e,t){return u(this,null,function*(){return this.request(`/api/v1/custom-fields/values/${e}`,{method:"PUT",body:JSON.stringify(t)})})}bulkUpdateCustomFieldValues(e,t,r){return u(this,null,function*(){return this.request("/api/v1/custom-fields/bulk-update",{method:"POST",body:JSON.stringify({reservation_ids:e,field_id:t,value:r})})})}getFinancialData(e){return u(this,null,function*(){const t=new URLSearchParams;return e&&Object.entries(e).forEach(([e,r])=>{void 0!==r&&t.append(e,String(r))}),this.request(`/api/v1/finance/summary?${t}`)})}getRevenueReport(e,t){return u(this,null,function*(){return this.request(`/api/v1/finance/revenue?start=${e}&end=${t}`)})}getSecurityViolations(){return[...this.securityViolations]}getAuthMe(e=!1){return u(this,null,function*(){const t=e?"/api/v1/auth/me?refresh=true":"/api/v1/auth/me";return this.request(t)})}getMyProfile(){return u(this,null,function*(){return this.request("/api/v1/profile")})}getUsersBrief(e){return u(this,null,function*(){const t=e&&e.length?`?ids=${encodeURIComponent(e.join(","))}`:"",r=yield this.request(`/api/v1/users/brief${t}`);return Array.isArray(null==r?void 0:r.users)?r.users:[]})}getRecentUserLogs(e=10){return u(this,null,function*(){const t=yield this.request(`/api/v1/logs/recent?limit=${e}&user_only=true`);return Array.isArray(null==t?void 0:t.data)?t.data:[]})}getDashboardData(){return u(this,null,function*(){return this.request("/api/v1/dashboard/data")})}clearSecurityViolations(){this.securityViolations=[]}getRequestStats(){return{totalRequests:this.requestCount,securityViolations:this.securityViolations.length,backendUrl:this.backendUrl,hasCachedToken:!!this.cachedToken}}verifyTenantIsolation(){return u(this,null,function*(){try{return{isolated:!0,tenantId:(yield this.request("/api/v1/auth/verify-tenant")).tenant_id,message:"Tenant isolation verified successfully"}}catch(e){return{isolated:!1,tenantId:"unknown",message:"Tenant isolation verification failed"}}})}checkConnection(){return u(this,null,function*(){try{return yield this.requestPublic("/api/v1/health"),!0}catch(e){try{return yield this.requestPublic("/health"),!0}catch(t){return!1}}})}checkAuthReady(){return u(this,null,function*(){try{if(!this.cachedToken)return console.log("[SecureAPI] No cached token, auth not ready"),!1;try{return yield this.getAuthMe(),console.log("[SecureAPI] Auth verified successfully"),!0}catch(e){return console.log("[SecureAPI] Auth token invalid or expired:",e),!1}}catch(t){return console.log("[SecureAPI] Auth check failed:",t),!1}})}getPropertyById(e){return u(this,null,function*(){return this.request(`/api/v1/properties/${e}`)})}getPropertiesInRadius(e){return u(this,null,function*(){const t=new URLSearchParams(e);return this.request(`/api/v1/properties/in-radius?${t}`)})}checkPropertyExists(e){return u(this,null,function*(){try{return(yield this.request(`/api/v1/properties/check-exists?hostaway_id=${e}`)).exists}catch(t){return!1}})}createPropertyDraft(e){return u(this,null,function*(){return this.request("/api/v1/property-drafts",{method:"POST",body:JSON.stringify(e)})})}getPropertyDraft(e,t){return u(this,null,function*(){const r=t?`?user_id=${t}`:"";return this.request(`/api/v1/property-drafts/${e}${r}`)})}updatePropertyDraft(e,t){return u(this,null,function*(){return this.request(`/api/v1/property-drafts/${e}`,{method:"PUT",body:JSON.stringify(t)})})}deletePropertyDraft(e){return u(this,null,function*(){return this.request(`/api/v1/property-drafts/${e}`,{method:"DELETE"})})}getMyOrgModules(){return u(this,null,function*(){const e=yield this.request("/api/v1/organizations/my-modules");return Array.isArray(null==e?void 0:e.modules)?e.modules:[]})}getCleaningReports(e,t){return u(this,null,function*(){const r=new URLSearchParams;e.city&&r.append("city",String(e.city)),e.date_from&&r.append("date_from",String(e.date_from)),e.date_to&&r.append("date_to",String(e.date_to)),e.status&&r.append("status",String(e.status)),e.booking_status&&r.append("booking_status",String(e.booking_status)),e.property_id&&r.append("property_id",String(e.property_id)),e.search&&r.append("search",String(e.search)),e.page&&r.append("page",String(e.page)),e.itemsPerPage&&r.append("itemsPerPage",String(e.itemsPerPage));const s=`/api/v1/secure/cleaning/reports?${r}`;try{const r=yield this.request(s,{signal:t});if(r&&"object"==typeof r){const t=r.items||r.data||[],n=r.total||0;0===n&&"overdue"===e.date_from&&console.warn("[SecureAPI] Received empty overdue cleaning data - this may indicate a backend issue"),e.date_from&&e.date_to&&e.date_from===e.date_to&&e.date_from===new Date(Date.now()+864e5).toISOString().split("T")[0]&&(console.log("[SecureAPI] Tomorrow cleaning request completed",{endpoint:s.substring(0,80)+"...",total:n,itemsLength:t.length,dateRequested:e.date_from,city:e.city,cacheKey:yield this.generateCacheKey("GET",s,(yield this.getTenantId())||"unknown")}),0===n&&console.warn("[SecureAPI] Tomorrow returned 0 cleanings - verify this is correct",{filters:e,cacheAge:"fresh_request"})),console.log(`[SecureAPI] Cleaning request completed: ${s.substring(0,80)}... -> ${n} items`)}return r}catch(n){throw console.error(`[SecureAPI] Cleaning request failed: ${s.substring(0,80)}...`,n),n}})}createCleaningReport(e){return u(this,null,function*(){return this.request("/api/v1/secure/cleaning/reports",{method:"POST",body:JSON.stringify(e)})})}updateCleaningReport(e,t){return u(this,null,function*(){return this.request(`/api/v1/secure/cleaning/reports/${e}`,{method:"PUT",body:JSON.stringify(t)})})}deleteCleaningReport(e){return u(this,null,function*(){return this.request(`/api/v1/secure/cleaning/reports/${e}`,{method:"DELETE"})})}getCleaningNotes(e){return u(this,null,function*(){return this.request(`/api/v1/secure/cleaning/notes/${e}`)})}addCleaningNote(e){return u(this,null,function*(){return this.request("/api/v1/secure/cleaning/notes",{method:"POST",body:JSON.stringify(e)})})}createCleaningNote(e){return u(this,null,function*(){return this.request("/api/v1/secure/cleaning/notes",{method:"POST",body:JSON.stringify(e)})})}deleteCleaningsByParentId(e){return u(this,null,function*(){return this.request(`/api/v1/cleaning-reports/by-parent/${e}`,{method:"DELETE"})})}getAnnouncements(e){return u(this,null,function*(){const t=new URLSearchParams;return Object.entries(e).forEach(([e,r])=>{void 0!==r&&t.append(e,String(r))}),this.request(`/api/v1/announcements?${t}`)})}createAnnouncement(e){return u(this,null,function*(){return this.request("/api/v1/announcements",{method:"POST",body:JSON.stringify(e)})})}acknowledgeAnnouncement(e,t){return u(this,null,function*(){return this.request("/api/v1/announcements/acknowledge",{method:"POST",body:JSON.stringify({announcement_id:e,user_id:t})})})}getCleaners(){return u(this,null,function*(){return this.request("/api/v1/secure/cleaning/cleaners")})}createCleaner(e){return u(this,null,function*(){return this.request("/api/v1/secure/cleaning/cleaners",{method:"POST",body:JSON.stringify(e)})})}deleteCleaner(e){return u(this,null,function*(){return this.request(`/api/v1/secure/cleaning/cleaners/${e}`,{method:"DELETE"})})}getContractRecords(e){return u(this,null,function*(){return this.request(`/api/v1/properties/${e}/contracts`)})}createContractRecord(e){return u(this,null,function*(){return this.request("/api/v1/contract-records",{method:"POST",body:JSON.stringify(e)})})}updateContractRecord(e,t){return u(this,null,function*(){return this.request(`/api/v1/contract-records/${e}`,{method:"PUT",body:JSON.stringify(t)})})}deleteContractRecord(e){return u(this,null,function*(){return this.request(`/api/v1/contract-records/${e}`,{method:"DELETE"})})}getAllReservationSubsections(e){return u(this,null,function*(){const t=e?`?${e.toString()}`:"";return this.request(`/api/v1/smart-views${t}`)})}getReservationSubsection(e){return u(this,null,function*(){return this.request(`/api/v1/smart-views/${e}`)})}createReservationSubsection(e){return u(this,null,function*(){return this.request("/api/v1/smart-views",{method:"POST",body:JSON.stringify(e)})})}updateReservationSubsection(e,t){return u(this,null,function*(){return this.request(`/api/v1/smart-views/${e}`,{method:"PUT",body:JSON.stringify(t)})})}deleteReservationSubsection(e){return u(this,null,function*(){return this.request(`/api/v1/smart-views/${e}`,{method:"DELETE"})})}duplicateReservationSubsection(e,t){return u(this,null,function*(){return this.request(`/api/v1/smart-views/${e}/duplicate`,{method:"POST",body:JSON.stringify(t)})})}getVerifications(e="pending"){return u(this,null,function*(){let t="/api/v1/guest-portal/verification-status";return"pending"===e?t+="/pending":"all"===e?t+="/all":e&&(t+=`/${e}`),this.request(t)})}reviewVerification(e,t){return u(this,null,function*(){return this.request(`/api/v1/guest-portal/review-verification/${e}`,{method:"POST",body:JSON.stringify(t)})})}translateEntity(e,t,r,s){return u(this,null,function*(){return this.request(`/api/v1/translations/${e}/${t}/translate`,{method:"POST",body:JSON.stringify({fields:r,languages:s})})})}getFormulas(){return u(this,null,function*(){return this.request("/api/v1/formulas")})}createFormula(e){return u(this,null,function*(){return this.request("/api/v1/formulas",{method:"POST",body:JSON.stringify(e)})})}updateFormula(e,t){return u(this,null,function*(){return this.request(`/api/v1/formulas/${e}`,{method:"PUT",body:JSON.stringify(t)})})}deleteFormula(e){return u(this,null,function*(){return this.request(`/api/v1/formulas/${e}`,{method:"DELETE"})})}};c(De,"instance");const $e=De.getInstance(),Me=class e{constructor(){c(this,"recoveryPromise",null),c(this,"recoveryStartTime",null)}static getInstance(){return e.instance||(e.instance=new e),e.instance}recoverSession(){return u(this,null,function*(){if("undefined"!=typeof window&&window.__isLoggingOut)return console.log("[SessionRecovery] Skipping recovery - logout in progress"),null;if(this.recoveryPromise){const e=Date.now();if(!(this.recoveryStartTime&&e-this.recoveryStartTime>1e4))return console.log("[SessionRecovery] Recovery already in progress, returning existing promise"),this.recoveryPromise;console.log("[SessionRecovery] Recovery timeout - resetting"),this.recoveryPromise=null,this.recoveryStartTime=null}this.recoveryStartTime=Date.now(),this.recoveryPromise=Promise.race([this.performRecovery(),new Promise(e=>{setTimeout(()=>{console.log("[SessionRecovery] Recovery timeout after 10s"),e(null)},1e4)})]);try{return yield this.recoveryPromise}finally{this.recoveryPromise=null,this.recoveryStartTime=null}})}performRecovery(){return u(this,null,function*(){var e;try{console.log("[SessionRecovery] Attempting to recover session from storage...");const{data:{session:r},error:s}=yield ke.auth.getSession();if(s)return console.error("[SessionRecovery] Error getting session:",s),null;if(r){console.log("[SessionRecovery] Session recovered successfully");const{data:{user:e},error:t}=yield ke.auth.getUser(r.access_token);if(t||!e){console.log("[SessionRecovery] Session invalid, attempting refresh...");const{data:{session:e},error:t}=yield ke.auth.refreshSession();return!t&&e?(console.log("[SessionRecovery] Session refreshed successfully"),e):(console.error("[SessionRecovery] Failed to refresh session:",t),null)}return r}console.log("[SessionRecovery] No session from getSession, checking localStorage directly...");const n=`sb-${(void 0).split("//")[1].split(".")[0]}-auth-token`,o=localStorage.getItem(n);if(o)try{const t=JSON.parse(o);if(null==(e=null==t?void 0:t.currentSession)?void 0:e.refresh_token){console.log("[SessionRecovery] Found refresh token in localStorage, attempting to restore...");const{data:{session:e},error:r}=yield ke.auth.setSession({access_token:t.currentSession.access_token,refresh_token:t.currentSession.refresh_token});if(!r&&e)return console.log("[SessionRecovery] Session restored from localStorage"),e;console.error("[SessionRecovery] Failed to restore session:",r)}}catch(t){console.error("[SessionRecovery] Failed to parse stored session:",t)}return console.log("[SessionRecovery] No recoverable session found"),null}catch(r){return console.error("[SessionRecovery] Recovery error:",r),null}})}persistSession(e){return u(this,null,function*(){try{console.log("[SessionRecovery] Persisting session to storage..."),yield ke.auth.setSession({access_token:e.access_token,refresh_token:e.refresh_token}),console.log("[SessionRecovery] Session persisted successfully")}catch(t){console.error("[SessionRecovery] Failed to persist session:",t)}})}clearStoredSession(){try{const e=`sb-${(void 0).split("//")[1].split(".")[0]}-auth-token`;localStorage.removeItem(e),console.log("[SessionRecovery] Stored session cleared")}catch(e){console.error("[SessionRecovery] Failed to clear stored session:",e)}}tryRecover(){return u(this,null,function*(){if("undefined"!=typeof window&&window.__isLoggingOut)return console.log("[SessionRecovery] Skipping tryRecover - logout in progress"),null;try{const e=yield this.recoverSession();return e&&e.user?{user:e.user}:null}catch(e){return console.error("[SessionRecovery] tryRecover failed:",e),null}})}};c(Me,"instance");const qe=Me.getInstance(),Fe=class e{constructor(){c(this,"sessionPromise",null),c(this,"bootstrapPromise",null),c(this,"cachedSession",null),c(this,"cachedBootstrap",null),c(this,"sessionTimestamp",0),c(this,"bootstrapTimestamp",0),c(this,"SESSION_CACHE_MS",3e5),c(this,"BOOTSTRAP_CACHE_MS",3e5),c(this,"REQUEST_TIMEOUT_MS",1e4)}static getInstance(){return e.instance||(e.instance=new e),e.instance}getSession(e=!1){return u(this,null,function*(){var t,r;if("undefined"!=typeof window&&window.__isLoggingOut)return console.log("[AuthOptimizer] Skipping getSession - logout in progress"),null;const s=Date.now();if(!e&&this.cachedSession&&s-this.sessionTimestamp<this.SESSION_CACHE_MS)return console.log("[AuthOptimizer] Returning cached session, user:",null==(t=this.cachedSession.user)?void 0:t.email),this.cachedSession.access_token&&$e.setAccessToken(this.cachedSession.access_token),this.cachedSession;if(this.sessionPromise&&!e)return console.log("[AuthOptimizer] Session fetch in progress, waiting..."),this.sessionPromise;this.cachedSession||this.sessionPromise||console.log("[AuthOptimizer] No cached session, starting initial session recovery..."),this.sessionPromise=this.fetchSessionWithTimeout();try{const e=yield this.sessionPromise;return e?(console.log("[AuthOptimizer] Session retrieved successfully, user:",null==(r=e.user)?void 0:r.email),this.cachedSession=e,this.sessionTimestamp=s):(console.log("[AuthOptimizer] No session retrieved - user not authenticated"),this.cachedSession=null,this.sessionTimestamp=0),e}finally{this.sessionPromise=null}})}getBootstrapData(e=!1){return u(this,null,function*(){const t=Date.now();if(!e&&this.cachedBootstrap&&t-this.bootstrapTimestamp<this.BOOTSTRAP_CACHE_MS)return console.log("[AuthOptimizer] Returning cached bootstrap data"),this.cachedBootstrap;if(this.bootstrapPromise&&!e)return console.log("[AuthOptimizer] Bootstrap fetch in progress, waiting..."),this.bootstrapPromise;let r=yield this.getSession();if(!r){console.warn("[AuthOptimizer] No session available for bootstrap fetch, checking for existing session");const{data:{session:e}}=yield ke.auth.getSession();if(!e)return this.createFallbackBootstrap(null);$e.setAccessToken(e.access_token),this.cachedSession=e,this.sessionTimestamp=Date.now(),r=e}this.bootstrapPromise=this.fetchBootstrapWithTimeout(r);try{const e=yield this.bootstrapPromise;return this.cachedBootstrap=e,this.bootstrapTimestamp=t,e}finally{this.bootstrapPromise=null}})}clearCache(){this.cachedSession=null,this.cachedBootstrap=null,this.sessionTimestamp=0,this.bootstrapTimestamp=0,this.sessionPromise=null,this.bootstrapPromise=null,console.log("[AuthOptimizer] Cache cleared")}storeSession(e){var t;try{e&&e.access_token&&(this.cachedSession=e,this.sessionTimestamp=Date.now(),$e.setAccessToken(e.access_token),console.log("[AuthOptimizer] Session stored for user:",null==(t=e.user)?void 0:t.email))}catch(r){console.warn("[AuthOptimizer] Failed to store session:",r)}}clearSession(){this.cachedSession=null,this.sessionTimestamp=0;try{$e.setAccessToken(null)}catch(e){}console.log("[AuthOptimizer] Session cleared")}clearUserCache(e){var t,r;(null==(r=null==(t=this.cachedSession)?void 0:t.user)?void 0:r.id)&&this.cachedSession.user.id!==e&&(this.clearCache(),console.log("[AuthOptimizer] Cache cleared due to user change"))}fetchSessionWithTimeout(){return u(this,null,function*(){if("undefined"!=typeof window&&window.__isLoggingOut)return console.log("[AuthOptimizer] Skipping fetchSessionWithTimeout - logout in progress"),null;const e=new Promise(e=>{setTimeout(()=>{console.warn("[AuthOptimizer] Session fetch timeout, using cached session if available"),e(this.cachedSession)},this.REQUEST_TIMEOUT_MS)}),t=(()=>u(this,null,function*(){console.log("[AuthOptimizer] Fetching session...");const e=Date.now();try{if(!this.cachedSession&&"undefined"!=typeof window){const e=`sb-${(void 0).split("//")[1].split(".")[0]}-auth-token`;localStorage.getItem(e)&&(console.log("[AuthOptimizer] Found stored session, waiting for Supabase to initialize..."),yield new Promise(e=>setTimeout(e,100)))}const{quickSessionCheck:t}=yield P(()=>u(this,null,function*(){const{quickSessionCheck:e}=yield import("./quickSessionCheck-CDz9td7h.js");return{quickSessionCheck:e}}),__vite__mapDeps([7,1,2,3,4,5,6])),r=yield t();if(r.hasSession&&r.session){const t=Date.now()-e;return console.log(`[AuthOptimizer] Session found via quick check in ${t}ms`),$e.setAccessToken(r.session.access_token),r.session}const s=yield qe.recoverSession(),n=Date.now()-e;return s?(console.log(`[AuthOptimizer] Session recovered successfully in ${n}ms`),$e.setAccessToken(s.access_token),s):(console.log(`[AuthOptimizer] No session found after ${n}ms - user may not be logged in`),null)}catch(t){return console.error("[AuthOptimizer] Session fetch failed:",t),this.cachedSession}}))();return yield Promise.race([t,e])})}fetchBootstrapWithTimeout(e){return u(this,null,function*(){const t=new Promise(t=>{setTimeout(()=>{console.warn("[AuthOptimizer] Bootstrap fetch timeout, using fallback"),t(this.createFallbackBootstrap(e))},this.REQUEST_TIMEOUT_MS)}),r=(()=>u(this,null,function*(){console.log("[AuthOptimizer] Fetching bootstrap data...");const t=Date.now();try{$e.setAccessToken(e.access_token);const r=yield $e.getAuthMe(),s=Date.now()-t;return console.log(`[AuthOptimizer] Bootstrap fetched in ${s}ms`),r}catch(r){return console.error("[AuthOptimizer] Bootstrap fetch failed:",r),this.createFallbackBootstrap(e)}}))();return Promise.race([r,t])})}createFallbackBootstrap(e){var t,r,s,n;const o=null==e?void 0:e.user;return{user:{id:(null==o?void 0:o.id)||"",email:(null==o?void 0:o.email)||"",role:(null==(t=null==o?void 0:o.app_metadata)?void 0:t.role)||"user",is_admin:"admin"===(null==(r=null==o?void 0:o.app_metadata)?void 0:r.role)},permissions:"admin"===(null==(s=null==o?void 0:o.app_metadata)?void 0:s.role)?[{section:"*",action:"*"}]:[],tenant:null,company_settings:null,modules:[],smart_views:{},subsections:[],metadata:{tenant_id:(null==(n=null==o?void 0:o.app_metadata)?void 0:n.tenant_id)||null,timestamp:(new Date).toISOString(),version:"1.0.0",is_fallback:!0}}}};c(Fe,"instance");const Ue=Fe.getInstance(),ze=class e{constructor(){c(this,"refreshTimer",null),c(this,"lastActivity",Date.now()),c(this,"visibilityChangeHandler",null),c(this,"isRefreshing",!1),console.log("[SessionPersistence] Manager initialized")}static getInstance(){return e.instance||(e.instance=new e),e.instance}start(){console.log("[SessionPersistence] Starting session monitoring..."),this.visibilityChangeHandler=this.handleVisibilityChange.bind(this),document.addEventListener("visibilitychange",this.visibilityChangeHandler),this.refreshTimer=window.setInterval(()=>this.checkAndRefresh(),12e4),["mousedown","keydown","scroll","touchstart"].forEach(e=>{window.addEventListener(e,()=>{this.lastActivity=Date.now()},{passive:!0})}),this.checkAndRefresh()}handleVisibilityChange(){return u(this,null,function*(){if("visible"!==document.visibilityState)return;const e=Date.now()-this.lastActivity;console.log(`[SessionPersistence] Tab visible after ${Math.floor(e/1e3)}s inactive`),yield this.validateAndRecoverSession()})}checkAndRefresh(){return u(this,null,function*(){try{const{data:{session:e},error:t}=yield ke.auth.getSession();if(!e||t)return;const r=1e3*e.expires_at-Date.now(),s=Math.floor(r/6e4);r<6e5&&r>0?(console.log(`[SessionPersistence] Token expiring in ${s} min - refreshing proactively...`),yield this.refreshWithRetry()):r<=0&&(console.warn("[SessionPersistence] Token already expired - attempting recovery..."),yield this.refreshWithRetry())}catch(e){console.error("[SessionPersistence] Error in checkAndRefresh:",e)}})}validateAndRecoverSession(){return u(this,null,function*(){try{const{data:{session:e},error:t}=yield ke.auth.getSession();if(!e||t)return;1e3*e.expires_at-Date.now()<3e5?(console.log("[SessionPersistence] Token expiring soon after inactivity - refreshing..."),yield this.refreshWithRetry()):console.log("[SessionPersistence] ‚úÖ Session still valid")}catch(e){console.error("[SessionPersistence] Error in validateAndRecoverSession:",e)}})}refreshWithRetry(e=3){return u(this,null,function*(){var t,r,s;if(this.isRefreshing)return console.log("[SessionPersistence] Refresh already in progress, skipping..."),!1;this.isRefreshing=!0;try{const{data:{session:o}}=yield ke.auth.getSession();if(!o)return!1;for(let i=1;i<=e;i++)try{console.log(`[SessionPersistence] Refresh attempt ${i}/${e}...`);const{data:n,error:o}=yield ke.auth.refreshSession();if(n.session)return console.log(`[SessionPersistence] ‚úÖ Refresh successful (attempt ${i})`),!0;if(o){if((null==(t=o.message)?void 0:t.includes("Auth session missing"))||(null==(r=o.message)?void 0:r.includes("Invalid Refresh Token"))||(null==(s=o.message)?void 0:s.includes("not found")))return!1;if(console.warn(`[SessionPersistence] Refresh attempt ${i} failed:`,o.message),i<e){const e=1e3*Math.pow(2,i);console.log(`[SessionPersistence] Waiting ${e}ms before retry...`),yield new Promise(t=>setTimeout(t,e))}}}catch(n){const t=(null==n?void 0:n.message)||String(n);if(t.includes("Auth session missing")||t.includes("Invalid Refresh Token"))return!1;if(console.error(`[SessionPersistence] Refresh attempt ${i} exception:`,n),i<e){const e=1e3*Math.pow(2,i);yield new Promise(t=>setTimeout(t,e))}}return console.error("[SessionPersistence] ‚ùå All refresh attempts failed"),!1}finally{this.isRefreshing=!1}})}stop(){console.log("[SessionPersistence] Stopping session monitoring..."),this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null),this.visibilityChangeHandler&&(document.removeEventListener("visibilitychange",this.visibilityChangeHandler),this.visibilityChangeHandler=null)}manualCheck(){return u(this,null,function*(){console.log("[SessionPersistence] Manual session check triggered"),yield this.validateAndRecoverSession()})}};c(ze,"instance");const Ve=ze.getInstance();"undefined"!=typeof window&&(window.debugSession=()=>{ke.auth.getSession().then(({data:{session:e}})=>{if(e){const t=Math.floor((1e3*e.expires_at-Date.now())/1e3);console.log("Session Debug:",{user:e.user.email,expiresIn:`${Math.floor(t/60)} minutes ${t%60} seconds`,expiresAt:new Date(1e3*e.expires_at).toLocaleTimeString()})}else console.log("No active session")})}),"undefined"!=typeof window&&(window.__isLoggingOut=!1);const He=v.createContext(void 0),Be=()=>{const e=v.useContext(He);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},Je=({children:e})=>{const[t,r]=v.useState(null),[s,n]=v.useState(!0),[o,i]=v.useState(!1),a=v.useCallback(e=>{var t,r;const s=e.user;let n=null;const o=function(e){if(!(null==e?void 0:e.access_token))return null;try{const t=function(e){try{const t=e.split(".");if(3!==t.length)return console.warn("[JWT] Invalid token format"),null;const r=t[1],s=r+"==".substring(0,(4-r.length%4)%4),n=atob(s);return JSON.parse(n)}catch(t){return console.error("[JWT] Failed to decode token payload:",t),null}}(e.access_token);return(null==t?void 0:t.tenant_id)||null}catch(t){return console.error("[JWT] Error extracting tenant from session:",t),null}}(e);return o&&(n=o),!n&&(null==(t=s.app_metadata)?void 0:t.tenant_id)&&(n=s.app_metadata.tenant_id),!n&&(null==(r=s.user_metadata)?void 0:r.tenant_id)&&(n=s.user_metadata.tenant_id),s.tenant_id=n,s},[]),l=v.useCallback(e=>{var t,r;const s=e;let n=null;return(null==(t=s.app_metadata)?void 0:t.tenant_id)?n=s.app_metadata.tenant_id:(null==(r=s.user_metadata)?void 0:r.tenant_id)&&(n=s.user_metadata.tenant_id),s.tenant_id=n,s},[]),c=v.useCallback(()=>u(null,null,function*(){try{const{data:{session:e}}=yield ke.auth.getSession();if(e){const t=a(e);r(t),i(!0)}else r(null),i(!1)}catch(e){console.error("Error refreshing session:",e),r(null),i(!1)}}),[a]),h=v.useCallback(()=>u(null,null,function*(){var e;try{const{data:{session:t}}=yield ke.auth.getSession();return null!=(e=null==t?void 0:t.access_token)?e:null}catch(t){return null}}),[]);return v.useEffect(()=>{console.log("üîç [AuthContext] Provider MOUNTED via useEffect"),u(null,null,function*(){try{if(window.__isLoggingOut)return console.log("[AuthContext] Skipping auth initialization - logout in progress"),void n(!1);const{data:{session:e}}=yield ke.auth.getSession();if(e){const t=a(e);r(t),i(!0)}else if(!window.__isLoggingOut){const e=yield qe.tryRecover();if(e){const t=l(e.user);r(t),i(!0)}}}catch(e){console.error("Error initializing auth:",e)}finally{n(!1)}}),Ve.start();const e=e=>{const t=e;console.error("[AuthContext] Session expired and could not be recovered:",t.detail),r(null),i(!1)};window.addEventListener("session-expired",e);const{data:{subscription:t}}=ke.auth.onAuthStateChange((e,t)=>{console.log("üîç [AuthContext] Auth state changed EVENT:",e),console.log("üîç [AuthContext] Session present:",!!t);try{if(t){console.log("üîç [AuthContext] Session User Email:",t.user.email);const e=a(t);console.log("üîç [AuthContext] Enriched User:",e?"SUCCESS":"NULL"),r(e),i(!0),Ue.storeSession(t)}else console.log("üîç [AuthContext] Session is NULL -> Logging out"),r(null),i(!1),Ue.clearSession()}catch(s){console.error("‚ùå [AuthContext] CRITICAL ERROR in auth state change handler:",s)}n(!1)});return()=>{t.unsubscribe(),Ve.stop(),window.removeEventListener("session-expired",e)}},[a]),d.jsx(He.Provider,{value:{user:t,isLoading:s,isAuthenticated:o,signIn:(e,t)=>u(null,null,function*(){try{const{data:s,error:n}=yield ke.auth.signInWithPassword({email:e,password:t});if(n)return{error:n};if(s.session){const e=a(s.session);r(e),i(!0),Ue.storeSession(s.session),Ve.start(),console.log("[AuthContext] Session persistence manager restarted after login")}return{error:null}}catch(s){return{error:s}}}),signOut:()=>u(null,null,function*(){try{console.log("[AuthContext] Starting logout process"),window.__isLoggingOut=!0,console.log("[AuthContext] Logout flag set - blocking all session recovery"),localStorage.clear(),sessionStorage.clear(),console.log("[AuthContext] Storage cleared"),Ve.stop(),console.log("[AuthContext] Session persistence manager stopped"),qe.clearStoredSession(),Ue.clearSession(),console.log("[AuthContext] Session recovery cleared"),yield ke.auth.signOut(),console.log("[AuthContext] Supabase sign out completed"),r(null),i(!1),console.log("[AuthContext] Logout completed successfully"),setTimeout(()=>{window.__isLoggingOut=!1,window.location.href="/login"},100)}catch(e){console.error("[AuthContext] Error during logout:",e);try{localStorage.clear(),sessionStorage.clear(),Ve.stop(),qe.clearStoredSession(),Ue.clearSession()}catch(t){console.error("[AuthContext] Error clearing sessions:",t)}r(null),i(!1),setTimeout(()=>{window.__isLoggingOut=!1,window.location.href="/login"},100)}}),refreshSession:c,getAccessToken:h},children:e})},We=v.createContext(null),Ke={},Ge=({children:e})=>{var t,r,s,n;const o=Be(),i={user:o.user,status:o.isLoading?"initializing":o.isAuthenticated?"authenticated":"unauthenticated",permissions:[],modules:[],tenantId:(null==(r=null==(t=o.user)?void 0:t.user_metadata)?void 0:r.tenant_id)||null,companySettings:null,tenant:null,error:null,hasPermission:(e,t)=>!1,hasModule:e=>!1,refreshSession:o.refreshSession},c=o.isLoading,[h,p]=v.useState([]),[g,m]=v.useState(null),[f,y]=v.useState(null),[x,b]=v.useState([]),[S,w]=v.useState(null),[k,_]=v.useState([]),[N,C]=v.useState(null),[j,I]=v.useState(!1),[A,R]=v.useState(!1),P=v.useMemo(()=>{var e;const t=f||i.tenantId||null,r=x.length>0?x:Array.isArray(i.modules)?i.modules:[];return t&&r.length>0?(Ke[t]=r,new Set(r)):t&&(null==(e=Ke[t])?void 0:e.length)?new Set(Ke[t]):new Set(r)},[x,i.modules,i.tenantId,f]),E=v.useMemo(()=>{var e,t,r,s,n;if(null!==N)return console.log("[AppContext] Using is_admin from /me endpoint:",N),N;if((h.length>0?h:i.permissions||[]).some(e=>"*"===e.section&&"*"===e.action))return!0;if("admin"===((null==(t=null==(e=i.user)?void 0:e.app_metadata)?void 0:t.role)||(null==(s=null==(r=i.user)?void 0:r.user_metadata)?void 0:s.role)))return!0;const o=(null==(n=i.user)?void 0:n.email)||"";return["sid@theflexliving.com","raouf@theflexliving.com","michael@theflexliving.com"].includes(o)},[N,h,i.permissions,i.user]);v.useEffect(()=>{try{Object.keys(Ke).forEach(e=>delete Ke[e])}catch(e){}b([]),w(null),y(null),p([]),_([]),C(null),I(!1),R(!1),console.log("[AppContext] User changed ‚Äì state reset")},[null==(s=i.user)?void 0:s.id]),v.useEffect(()=>{if("authenticated"!==i.status)return;let e=!1;return u(null,null,function*(){var t,r,s,n,o,a,l,c;try{if(!h.length)try{let o=null,a=0;for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e)||"";if(t.startsWith("app_bootstrap_data_")){const e=localStorage.getItem(t);if(!e)continue;const r=JSON.parse(e),s=(null==r?void 0:r.timestamp)||0;s>a&&(a=s,o=t)}}if(o){const a=localStorage.getItem(o),l=JSON.parse(a),c=(null==l?void 0:l.data)||{},u=Array.isArray(c.permissions)?c.permissions:[],d=(null==(t=null==c?void 0:c.metadata)?void 0:t.tenant_id)||(null==(r=null==c?void 0:c.tenant)?void 0:r.id)||null,h=Array.isArray(c.modules)?c.modules:[],g=c.company_settings||null,m=Array.isArray(c.departments)?c.departments:Array.isArray(null==(s=null==c?void 0:c.metadata)?void 0:s.departments)?c.metadata.departments:[];if(!e){if(u.length&&p(u),d){const e=i.tenantId,t=null==(n=i.user)?void 0:n.email,r={"noam@stayhomely.de":"5a382f72-aec3-40f1-9063-89476ae00669"};let s=e||d;if(t&&r[t]){const e=r[t];s!==e&&(console.warn("[AppContext] üö® BOOTSTRAP EMERGENCY OVERRIDE:",{user_email:t,wrong_tenant:s,correct_tenant:e}),s=e)}e&&d!==e&&console.warn("[AppContext] üö® BOOTSTRAP TENANT CONFLICT:",{jwt_tenant_id:e,bootstrap_tenant_id:d,final_tenant_id:s,resolution:r[t||""]?"emergency_override":"jwt_priority"}),y(s)}h.length&&b(h),g&&w(g),m.length&&_(m)}console.log("[AppContext] Hydrated from bootstrap cache",{perms:u.length,mods:h.length,depts:m.length,tidFromData:d})}}catch(u){console.log("[AppContext] Bootstrap cache parse failed",u)}const g=!j||A;if(j&&!A&&!h.length){const t=f||i.tenantId||"unknown",r=`auth_cache_permissions_${(null==(o=i.user)?void 0:o.id)||"anon"}_${t}`,s=localStorage.getItem(r);if(s){const t=JSON.parse(s);Array.isArray(null==t?void 0:t.data)&&t.data.length>0&&(e||p(t.data),console.log("[AppContext] Loaded permissions from cache (subsequent load)",t.data.length))}}if(g){console.log("[AppContext] Fetching FRESH permissions from backend (page refresh/initial load)",{hasInitialRefresh:j,forceRefreshFlag:A});const t=yield $e.getAuthMe();if(t){if(!e&&Array.isArray(t.permissions)&&(console.log(`[AppContext] ‚úÖ Setting FRESH permissions: ${t.permissions.length} permissions loaded`),p(t.permissions)),!e){const e=i.tenantId,r=t.tenant_id,s=null==(a=i.user)?void 0:a.email,n={"noam@stayhomely.de":"5a382f72-aec3-40f1-9063-89476ae00669"};let o=e||r||null;if(s&&n[s]){const e=n[s];o!==e&&(console.warn("[AppContext] üö® EMERGENCY TENANT OVERRIDE:",{user_email:s,wrong_tenant:o,correct_tenant:e,source:"emergency_override"}),o=e)}e&&r&&e!==r&&console.warn("[AppContext] üö® TENANT CONFLICT DETECTED:",{jwt_tenant_id:e,api_tenant_id:r,user_email:s,final_tenant_id:o,resolution:n[s||""]?"emergency_override":"jwt_priority"}),y(o),o&&(null==(l=i.user)?void 0:l.id)&&Ae.setContext({tenant_id:o,user_id:i.user.id,email:i.user.email}),console.log("[AppContext] ‚úÖ Tenant resolution completed:",{final_tenant_id:o,source:e?"JWT_prioritized":"API_fallback"})}if(e||(I(!0),R(!1)),t.is_admin){console.log("[AppContext] User is admin - fetching ALL departments");try{const t=yield $e.getDepartments();!e&&Array.isArray(t)&&(_(t),console.log("[AppContext] Admin departments loaded:",t.length))}catch(d){console.error("[AppContext] Failed to fetch all departments for admin:",d),!e&&Array.isArray(t.departments)&&_(t.departments)}}else!e&&Array.isArray(t.departments)&&_(t.departments);e||"boolean"!=typeof t.is_admin||(C(t.is_admin),console.log("[AppContext] Set isAdmin from /me endpoint:",t.is_admin));try{if(Array.isArray(t.permissions)){const e=`auth_cache_permissions_${(null==(c=i.user)?void 0:c.id)||"anon"}_${t.tenant_id||"unknown"}`;localStorage.setItem(e,JSON.stringify({ts:Date.now(),data:t.permissions}))}}catch(u){}}}}catch(u){e||m((null==u?void 0:u.message)||"Failed to load auth context"),console.log("[AppContext] Error during hydration",u)}}),()=>{e=!0}},[i.status,null==(n=i.user)?void 0:n.id,f,i.tenantId,h.length,j,A]);const O=v.useCallback((e,t)=>{const r=(e||"").toLowerCase(),s=h.length>0?h:i.permissions||[];if(!s.length)return!1;if(E)return!0;if(s.some(e=>"*"===e.section&&"*"===e.action))return!0;const n=e=>({reservations:"all_reservations",property:"properties",property_details:"properties",props:"properties"}[e]||e),o=n(r);return s.some(e=>n((e.section||"").toLowerCase())===o&&(e.action===t||"read"===t&&"view"===e.action))},[h,i.permissions,E]);v.useEffect(()=>{const e=f||i.tenantId||null;if("authenticated"!==i.status||!e)return;let t=!1;return u(null,null,function*(){try{const e=yield $e.getCompanySettings();!t&&e&&(w(e),console.log("[AppContext] Company settings refreshed"))}catch(e){}}),()=>{t=!0}},[i.status,f,i.tenantId]);const T=v.useMemo(()=>c||"authenticated"===i.status&&0===h.length&&!g,[c,i.status,h.length,g]),L=v.useMemo(()=>i.user?l(a({},i.user),{tenant_id:f||i.tenantId||null,permissions:h.length>0?h:i.permissions||[],departments:k,modules:Array.from(P),is_admin:null!=N&&N}):null,[i.user,f,i.tenantId,h,i.permissions,k,P,N]);v.useEffect(()=>{L&&console.log("[AppContext] Composed user updated",{id:L.id,email:L.email,is_admin:L.is_admin,tenant_id:L.tenant_id,permissions:L.permissions.length,departmentsCount:L.departments.length,modules:L.modules.length})},[L]);const D={user:L,tenant:f||i.tenantId?{id:f||i.tenantId}:null,companySettings:S||i.companySettings,permissions:h.length?h:i.permissions||[],modules:P,isLoading:T,error:g||i.error,isAdmin:E,hasPermission:O,hasModule:i.hasModule,refreshData:(e=!1)=>u(null,null,function*(){yield i.refreshSession(),e||!j?(console.log("[AppContext] refreshData invoked - forcing permission refresh"),R(!0)):console.log("[AppContext] refreshData invoked - session refresh only")}),refreshDepartments:()=>u(null,null,function*(){console.log("[AppContext] refreshDepartments invoked");try{if(E){console.log("[AppContext] Fetching ALL departments for admin");const e=yield $e.getDepartments();_(e),console.log("[AppContext] Departments refreshed:",e.length)}else{console.log("[AppContext] Fetching assigned departments for non-admin");const e=yield $e.getAuthMe();e&&Array.isArray(e.departments)&&(_(e.departments),console.log("[AppContext] Departments refreshed:",e.departments.length))}}catch(e){console.error("[AppContext] Failed to refresh departments:",e)}}),departments:k};return d.jsx(We.Provider,{value:D,children:e})},Ye=({children:e})=>{const{isAuthenticated:t,isLoading:r}=Be();return console.log(`üõ°Ô∏è [ProtectedRoute] Rendering. Loading: ${r}, Authenticated: ${t}`),r?d.jsx("div",{className:"flex items-center justify-center min-h-screen",children:d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t?d.jsx(d.Fragment,{children:e}):(console.warn("üõ°Ô∏è [ProtectedRoute] Not authenticated -> Redirecting to /login"),d.jsx(x,{to:"/login",replace:!0}))};function Qe({children:e}){var t,r;const s=Be(),{user:n}=s,o="initializing"===s.status,i=b();if(o)return d.jsx("div",{className:"min-h-screen flex items-center justify-center",children:d.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(n){const e=(null==(r=null==(t=i.state)?void 0:t.from)?void 0:r.pathname)||"/";return d.jsx(x,{to:e,replace:!0})}return d.jsx(d.Fragment,{children:e})}const Xe=()=>{var e,t;const r=b(),s=S(),{signOut:n,user:o}=Be(),{isCollapsed:i,setIsCollapsed:a,isMobileOpen:l,setIsMobileOpen:c}=qt(),h=w.useMemo(()=>(e=>[{name:"Dashboard",href:"/dashboard",icon:$,section:"dashboard",alwaysShow:!0},{name:"Properties",href:"/properties",icon:$,section:"properties"},{name:"Reservations",href:"/reservations",icon:$,section:"reservations"},{name:"Cleaning",href:"/cleaning",icon:$,section:"cleaning"}].filter(t=>t.alwaysShow||((e,t)=>{var r;return!(!e||!e.permissions)&&(!(!e.isAdmin&&"admin"!==(null==(r=e.app_metadata)?void 0:r.role))||e.permissions.some(e=>!(e.section!==t&&"*"!==e.section||"read"!==e.action&&"*"!==e.action&&"create"!==e.action&&"update"!==e.action&&"delete"!==e.action)))})(e,t.section)))(o),[o]),p=e=>{s(e),c(!1)};return d.jsxs(d.Fragment,{children:[l&&d.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 lg:hidden",onClick:()=>c(!1)}),d.jsxs("div",{className:`\n            fixed inset-y-0 left-0 z-50 flex flex-col bg-white border-r border-gray-200\n            transition-all duration-300 ease-in-out\n            ${i?"w-16":"w-64"}\n            ${l?"translate-x-0":"-translate-x-full"}\n            lg:translate-x-0 lg:static lg:h-full\n          `,children:[d.jsxs("div",{className:"flex items-center justify-between h-16 px-4 border-b border-gray-200",children:[!i&&d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-lg flex items-center justify-center shadow-sm",children:d.jsx("span",{className:"text-white font-bold text-sm",children:"PF"})}),d.jsx("span",{className:"font-bold text-gray-900 tracking-tight",children:"PropertyFlow"})]}),d.jsx("button",{onClick:()=>a(!i),className:"hidden lg:flex p-1.5 rounded-lg hover:bg-gray-100 transition-colors items-center justify-center",title:i?"Expand sidebar":"Collapse sidebar",children:i?d.jsx(E,{className:"w-5 h-5 min-w-[20px] min-h-[20px] shrink-0 text-gray-600"}):d.jsx(O,{className:"w-5 h-5 min-w-[20px] min-h-[20px] shrink-0 text-gray-600"})}),d.jsx("button",{onClick:()=>c(!1),className:"lg:hidden p-1.5 rounded-lg hover:bg-gray-100 flex items-center justify-center",children:d.jsx(T,{className:"w-5 h-5 min-w-[20px] min-h-[20px] shrink-0 text-gray-600"})})]}),d.jsx("nav",{className:"flex-1 overflow-y-auto p-4 space-y-1",children:h.map(e=>{const t=e.icon,s="/dashboard"===(n=e.href)?"/"===r.pathname||"/dashboard"===r.pathname:r.pathname.startsWith(n);var n;return d.jsxs("button",{onClick:()=>p(e.href),className:`\n                  w-full flex items-center gap-3 px-3 py-2.5 rounded-lg\n                  transition-colors duration-150\n                  ${s?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-100"}\n                  ${i?"justify-center":""}\n                `,title:i?e.name:void 0,children:[d.jsx(t,{className:"w-5 h-5 min-w-[20px] min-h-[20px] shrink-0 "+(s?"text-blue-700":"text-gray-500")}),!i&&d.jsx("span",{className:"font-medium",children:e.name})]},e.name)})}),d.jsxs("div",{className:"border-t border-gray-200 p-4",children:[d.jsxs("button",{onClick:()=>p("/profile"),className:`\n              w-full flex items-center gap-3 px-3 py-2.5 rounded-lg\n              text-gray-700 hover:bg-gray-100 transition-colors mb-2\n              ${i?"justify-center":""}\n            `,title:i?"Profile":void 0,children:[d.jsx("div",{className:"w-8 h-8 min-w-[32px] min-h-[32px] bg-blue-100 rounded-full flex items-center justify-center shrink-0",children:d.jsx(L,{className:"w-4 h-4 min-w-[16px] min-h-[16px] shrink-0 text-blue-600"})}),!i&&o&&d.jsxs("div",{className:"flex-1 text-left min-w-0",children:[d.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:(null==(e=o.user_metadata)?void 0:e.full_name)||(null==(t=o.user_metadata)?void 0:t.name)||o.email}),d.jsx("p",{className:"text-xs text-gray-500 truncate",children:o.email})]})]}),d.jsxs("button",{onClick:()=>u(null,null,function*(){try{console.log("[Sidebar] Logout clicked"),yield n()}catch(e){console.error("[Sidebar] Logout error:",e)}}),className:`\n              w-full flex items-center gap-3 px-3 py-2.5 rounded-lg\n              text-red-600 hover:bg-red-50 transition-colors\n              ${i?"justify-center":""}\n            `,title:i?"Logout":void 0,children:[d.jsx(D,{className:"w-5 h-5 min-w-[20px] min-h-[20px] shrink-0"}),!i&&d.jsx("span",{className:"font-medium",children:"Logout"})]})]})]})]})},Ze=class e{constructor(){c(this,"recoveryInProgress",!1),c(this,"recoveryHistory",[]),c(this,"MAX_RECOVERY_ATTEMPTS",5),c(this,"RECOVERY_COOLDOWN",3e4),c(this,"lastRecoveryTime",0),c(this,"recoveryStrategies",[]),this.initializeRecoveryStrategies(),this.startRecoveryMonitoring()}static getInstance(){return e.instance||(e.instance=new e),e.instance}initializeRecoveryStrategies(){this.recoveryStrategies=[{name:"remove_corrupted_items",severity:"targeted",description:"Remove specific corrupted storage items",applicableIssues:["corruption"],execute:()=>u(this,null,function*(){return this.removeCorruptedItems()})},{name:"clean_expired_items",severity:"targeted",description:"Remove expired storage items",applicableIssues:["size_overflow"],execute:()=>u(this,null,function*(){return this.cleanExpiredItems()})},{name:"resolve_orphaned_data",severity:"targeted",description:"Remove orphaned data from previous sessions",applicableIssues:["orphaned_data"],execute:()=>u(this,null,function*(){return this.resolveOrphanedData()})},{name:"fix_version_mismatches",severity:"targeted",description:"Migrate or remove items with version mismatches",applicableIssues:["version_mismatch"],execute:()=>u(this,null,function*(){return this.fixVersionMismatches()})},{name:"clear_session_conflicts",severity:"aggressive",description:"Resolve conflicting session data",applicableIssues:["session_conflict"],execute:()=>u(this,null,function*(){return this.clearSessionConflicts()})},{name:"rebuild_storage_schema",severity:"aggressive",description:"Rebuild storage with current schema",applicableIssues:["invalid_schema","version_mismatch"],execute:()=>u(this,null,function*(){return this.rebuildStorageSchema()})},{name:"clear_user_cache",severity:"aggressive",description:"Clear all cached data while preserving session",applicableIssues:["corruption","size_overflow"],execute:()=>u(this,null,function*(){return this.clearUserCache()})},{name:"emergency_reset_with_backup",severity:"nuclear",description:"Reset all storage while backing up critical data",applicableIssues:["corruption","critical"],execute:()=>u(this,null,function*(){return this.emergencyResetWithBackup()})},{name:"complete_storage_wipe",severity:"nuclear",description:"Complete storage wipe - absolute last resort",applicableIssues:["critical"],execute:()=>u(this,null,function*(){return this.completeStorageWipe()})}]}attemptRecovery(e){return u(this,null,function*(){if(this.recoveryInProgress)return console.log("[StorageRecoverySystem] Recovery already in progress"),this.createEmptyRecoveryReport();const t=Date.now();if(t-this.lastRecoveryTime<this.RECOVERY_COOLDOWN)return console.log("[StorageRecoverySystem] Recovery in cooldown period"),this.createEmptyRecoveryReport();this.recoveryInProgress=!0,this.lastRecoveryTime=t;const r=Date.now();try{console.log("[StorageRecoverySystem] Starting automatic recovery...");const t=e||(yield Pe.performHealthCheck());if("healthy"===t.overall_health)return console.log("[StorageRecoverySystem] Storage is healthy, no recovery needed"),this.createSuccessRecoveryReport(r,[]);const o=yield this.backupCriticalData(),i=this.selectRecoveryStrategies(t.issues);console.log("[StorageRecoverySystem] Selected recovery strategies:",i.map(e=>e.name));const a=[];let l=t.issues.length;for(const e of i){if(0===l){console.log("[StorageRecoverySystem] All issues resolved, stopping recovery");break}if(a.length>=this.MAX_RECOVERY_ATTEMPTS){console.log("[StorageRecoverySystem] Max recovery attempts reached");break}console.log(`[StorageRecoverySystem] Executing strategy: ${e.name}`);const t=Date.now();let r,n=!1;try{n=yield e.execute()}catch(s){r=s instanceof Error?s.message:String(s),console.error(`[StorageRecoverySystem] Strategy ${e.name} failed:`,r)}const o=(yield Pe.performHealthCheck()).issues.length,i={strategy:e.name,timestamp:t,success:n&&o<l,issues_before:l,issues_after:o,error:r};if(a.push(i),this.recoveryHistory.push(i),l=o,console.log(`[StorageRecoverySystem] Strategy ${e.name} result:`,{success:i.success,issues_reduced:l<i.issues_before,remaining_issues:l}),"nuclear"===e.severity&&i.success)break}const c=a.some(e=>{var t,r;return"aggressive"===(null==(t=this.recoveryStrategies.find(t=>t.name===e.strategy))?void 0:t.severity)||"nuclear"===(null==(r=this.recoveryStrategies.find(t=>t.name===e.strategy))?void 0:r.severity)});c&&o&&(yield this.restoreCriticalData(o));const u=yield Pe.performHealthCheck(),d={total_attempts:a.length,successful_attempts:a.filter(e=>e.success).length,failed_attempts:a.filter(e=>!e.success).length,recovery_strategies_used:a.map(e=>e.strategy),final_health_status:u.overall_health,critical_data_preserved:!c||!!o,recovery_duration_ms:Date.now()-r,recommendations:this.generateRecoveryRecommendations(a,u)};console.log("[StorageRecoverySystem] Recovery completed:",d);try{Ae.set("last_recovery_report",d,{skipIntegrityCheck:!0,ttl:864e5})}catch(n){console.warn("[StorageRecoverySystem] Failed to store recovery report:",n)}return d}finally{this.recoveryInProgress=!1}})}selectRecoveryStrategies(e){const t=[],r=new Set(e.map(e=>e.type)),s=Math.max(...e.map(e=>"critical"===e.severity?4:"high"===e.severity?3:"medium"===e.severity?2:1));for(const n of this.recoveryStrategies)n.applicableIssues.some(e=>r.has(e))&&(s>=4||s>=3&&"nuclear"!==n.severity||s>=2&&"targeted"===n.severity||1===s&&"targeted"===n.severity)&&t.push(n);if(0===t.length&&e.length>0){const e=this.recoveryStrategies.find(e=>"remove_corrupted_items"===e.name);e&&t.push(e)}return t.sort((e,t)=>{const r={targeted:1,aggressive:2,nuclear:3};return r[e.severity]-r[t.severity]})}backupCriticalData(){return u(this,null,function*(){try{const t={},r=Oe.getCurrentContext();r&&(t.session_context=r);try{const{data:{session:e}}=yield ke.auth.getSession();e&&(t.supabase_session={access_token:e.access_token,refresh_token:e.refresh_token,user_id:e.user.id,expires_at:e.expires_at})}catch(e){console.warn("[StorageRecoverySystem] Failed to backup Supabase session:",e)}try{const e=Ae.get("user_preferences");e&&(t.user_preferences=e)}catch(e){}const s=`emergency_backup_${Date.now()}`;try{return localStorage.setItem(s,JSON.stringify({timestamp:Date.now(),data:t})),console.log("[StorageRecoverySystem] Critical data backed up"),{backup_key:s,data:t}}catch(e){return console.warn("[StorageRecoverySystem] Failed to store backup:",e),t}}catch(t){return console.error("[StorageRecoverySystem] Failed to backup critical data:",t),null}})}restoreCriticalData(e){return u(this,null,function*(){try{if(!e||!e.data)return void console.log("[StorageRecoverySystem] No backup data to restore");const{data:r}=e;if(r.session_context)try{yield Oe.setSessionContext(r.session_context),console.log("[StorageRecoverySystem] Session context restored")}catch(t){console.warn("[StorageRecoverySystem] Failed to restore session context:",t)}if(r.supabase_session)try{yield ke.auth.setSession({access_token:r.supabase_session.access_token,refresh_token:r.supabase_session.refresh_token}),console.log("[StorageRecoverySystem] Supabase session restored")}catch(t){console.warn("[StorageRecoverySystem] Failed to restore Supabase session:",t)}if(r.user_preferences)try{Ae.set("user_preferences",r.user_preferences),console.log("[StorageRecoverySystem] User preferences restored")}catch(t){console.warn("[StorageRecoverySystem] Failed to restore user preferences:",t)}if(e.backup_key)try{localStorage.removeItem(e.backup_key)}catch(t){}}catch(r){console.error("[StorageRecoverySystem] Failed to restore critical data:",r)}})}removeCorruptedItems(){return u(this,null,function*(){try{let t=0;for(let r=localStorage.length-1;r>=0;r--){const s=localStorage.key(r);if(s)try{const e=localStorage.getItem(s);e&&JSON.parse(e)}catch(e){localStorage.removeItem(s),t++}}return console.log(`[StorageRecoverySystem] Removed ${t} corrupted items`),t>0}catch(e){return console.error("[StorageRecoverySystem] Failed to remove corrupted items:",e),!1}})}cleanExpiredItems(){return u(this,null,function*(){try{let t=0;const r=Date.now();for(let s=localStorage.length-1;s>=0;s--){const n=localStorage.key(s);if(n)try{const e=localStorage.getItem(n);if(!e)continue;const s=JSON.parse(e);s.expires_at&&r>s.expires_at&&(localStorage.removeItem(n),t++)}catch(e){}}return console.log(`[StorageRecoverySystem] Removed ${t} expired items`),t>0}catch(e){return console.error("[StorageRecoverySystem] Failed to clean expired items:",e),!1}})}resolveOrphanedData(){return u(this,null,function*(){try{const e=Oe.getCurrentContext();if(!e)return!1;let t=0;for(let r=localStorage.length-1;r>=0;r--){const s=localStorage.key(r);if(!s)continue;const n=s.split("::");if(n.length>=2){const r=n[1],o=n[0];r===e.user_id&&o===e.tenant_id||(localStorage.removeItem(s),t++)}}return console.log(`[StorageRecoverySystem] Resolved ${t} orphaned items`),t>0}catch(e){return console.error("[StorageRecoverySystem] Failed to resolve orphaned data:",e),!1}})}fixVersionMismatches(){return u(this,null,function*(){try{let t=0;const r="2.0.0";for(let s=localStorage.length-1;s>=0;s--){const n=localStorage.key(s);if(n)try{const e=localStorage.getItem(n);if(!e)continue;const s=JSON.parse(e);s.version&&s.version!==r&&(localStorage.removeItem(n),t++)}catch(e){}}return console.log(`[StorageRecoverySystem] Fixed ${t} version mismatches`),t>0}catch(e){return console.error("[StorageRecoverySystem] Failed to fix version mismatches:",e),!1}})}clearSessionConflicts(){return u(this,null,function*(){try{const e=Oe.getCurrentContext();let t=0;for(let r=localStorage.length-1;r>=0;r--){const s=localStorage.key(r);s&&(s.includes("session")||s.includes("auth"))&&(e&&s.includes(e.user_id)||(localStorage.removeItem(s),t++))}return console.log(`[StorageRecoverySystem] Cleared ${t} session conflicts`),t>0}catch(e){return console.error("[StorageRecoverySystem] Failed to clear session conflicts:",e),!1}})}rebuildStorageSchema(){return u(this,null,function*(){try{return console.log("[StorageRecoverySystem] Schema rebuild not yet implemented"),!0}catch(e){return console.error("[StorageRecoverySystem] Failed to rebuild storage schema:",e),!1}})}clearUserCache(){return u(this,null,function*(){try{const e=Oe.getCurrentContext();if(e){const t=Ae.clearUserData(e);return console.log(`[StorageRecoverySystem] Cleared user cache: ${t} items`),t>0}return!1}catch(e){return console.error("[StorageRecoverySystem] Failed to clear user cache:",e),!1}})}emergencyResetWithBackup(){return u(this,null,function*(){try{console.log("[StorageRecoverySystem] Performing emergency reset with backup");const e=[];for(let t=0;t<localStorage.length;t++){const r=localStorage.key(t);r&&r.includes("emergency_backup_")&&e.push(r)}return Ae.clearAll(),e.forEach(e=>{}),console.log("[StorageRecoverySystem] Emergency reset completed with backup preservation"),!0}catch(e){return console.error("[StorageRecoverySystem] Emergency reset failed:",e),!1}})}completeStorageWipe(){return u(this,null,function*(){try{if(console.log("[StorageRecoverySystem] Performing complete storage wipe"),Ae.clearAll(),sessionStorage.clear(),"indexedDB"in window)try{const e=yield indexedDB.databases();for(const t of e)t.name&&(yield indexedDB.deleteDatabase(t.name))}catch(e){console.warn("[StorageRecoverySystem] Failed to clear IndexedDB:",e)}return console.log("[StorageRecoverySystem] Complete storage wipe completed"),!0}catch(t){return console.error("[StorageRecoverySystem] Complete storage wipe failed:",t),!1}})}generateRecoveryRecommendations(e,t){const r=[],s=e.filter(e=>!e.success),n=e.filter(e=>e.success);return"healthy"===t.overall_health?r.push("Recovery successful - storage is now healthy"):"degraded"===t.overall_health?r.push("Partial recovery - monitor storage health closely"):r.push("Recovery incomplete - manual intervention may be required"),s.length>0&&r.push(`${s.length} recovery strategies failed - check browser console for details`),0===n.length&&r.push("No recovery strategies succeeded - consider using incognito mode temporarily"),t.issues.some(e=>"corruption"===e.type)&&r.push("Corruption still detected - avoid storing sensitive data until resolved"),t.issues.some(e=>"size_overflow"===e.type)&&r.push("Storage size issues persist - clear old data manually"),r}createEmptyRecoveryReport(){return{total_attempts:0,successful_attempts:0,failed_attempts:0,recovery_strategies_used:[],final_health_status:"unknown",critical_data_preserved:!0,recovery_duration_ms:0,recommendations:["Recovery was not performed"]}}createSuccessRecoveryReport(e,t){return{total_attempts:t.length,successful_attempts:t.filter(e=>e.success).length,failed_attempts:t.filter(e=>!e.success).length,recovery_strategies_used:t.map(e=>e.strategy),final_health_status:"healthy",critical_data_preserved:!0,recovery_duration_ms:Date.now()-e,recommendations:["Storage is healthy - no action required"]}}startRecoveryMonitoring(){setInterval(()=>u(this,null,function*(){if(!this.recoveryInProgress){const e=yield Pe.performHealthCheck();("critical"===e.overall_health||"corrupted"===e.overall_health&&e.issues.some(e=>"critical"===e.severity))&&(console.log("[StorageRecoverySystem] Critical storage issues detected, attempting automatic recovery"),yield this.attemptRecovery(e))}}),6e4)}getRecoveryHistory(){return[...this.recoveryHistory]}getDiagnostics(){return{recovery_in_progress:this.recoveryInProgress,last_recovery_time:this.lastRecoveryTime,recovery_history_count:this.recoveryHistory.length,available_strategies:this.recoveryStrategies.length,max_recovery_attempts:this.MAX_RECOVERY_ATTEMPTS,recovery_cooldown_ms:this.RECOVERY_COOLDOWN}}};c(Ze,"instance");const et=Ze.getInstance();"undefined"!=typeof window&&(window.storageRecoverySystem=et,window.attemptStorageRecovery=()=>et.attemptRecovery());const tt="app_storage_version",rt="2.0.0",st=class e{constructor(){this.initialize()}static getInstance(){return e.instance||(e.instance=new e),e.instance}initialize(){try{const e=localStorage.getItem(tt);e&&e===rt||(console.log(`LocalStorage version mismatch. Current: ${rt}, Stored: ${e}`),this.migrateStorage(e)),localStorage.setItem(tt,rt)}catch(e){console.error("Failed to initialize localStorage:",e),this.clearCorruptedStorage()}}migrateStorage(e){console.log(`Migrating localStorage from version ${e} to ${rt}`);const t={null:()=>{this.clearAllExceptEssentials()},"1.0.0":()=>{this.migrateV1ToV2()},"1.1.0":()=>{this.migrateV1ToV2()},"1.2.0":()=>{this.migrateV1ToV2()},"2.0.0":()=>{this.migrateV1ToV2()}}[e||"null"];t?t():(console.warn(`Unknown storage version: ${e}. Clearing non-essential data.`),this.clearAllExceptEssentials())}migrateV1ToV2(){try{const t=["selectedCity","user_permissions","tenant_id","organization_id"],r={};for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);if(t&&(t.includes("supabase")||t.includes("sb-"))){const e=localStorage.getItem(t);e&&(r[t]=e,console.log(`Preserving Supabase key: ${t}`))}}t.forEach(e=>{const t=localStorage.getItem(e);if(t)if("user_permissions"===e)try{JSON.parse(t),r[e]=t}catch(s){console.warn(`Corrupted JSON in ${e}, skipping preservation`)}else r[e]=t});const s=["cache_","temp_","old_","_legacy","undefined","null"],n=[];for(let o=0;o<localStorage.length;o++){const r=localStorage.key(o);if(r){s.some(e=>r.startsWith(e)||r===e)&&n.push(r);try{const e=localStorage.getItem(r);(e&&e.startsWith("{")||(null==e?void 0:e.startsWith("[")))&&JSON.parse(e)}catch(e){t.includes(r)||(console.warn(`Removing corrupted JSON key: ${r}`),n.push(r))}}}n.forEach(e=>{r.hasOwnProperty(e)||localStorage.removeItem(e)}),Object.entries(r).forEach(([e,t])=>{localStorage.setItem(e,t)}),this.updateDataStructures(),console.log("Migration from v1 to v2 completed successfully",{preservedKeys:Object.keys(r).length,removedKeys:n.length})}catch(t){console.error("Migration failed:",t),this.clearCorruptedStorage()}}updateDataStructures(){const e=localStorage.getItem("filterPresets");if(e)try{const t=JSON.parse(e);localStorage.setItem("filterPresets",JSON.stringify(t))}catch(r){localStorage.removeItem("filterPresets")}const t=localStorage.getItem("reservation_cache");if(t)try{const e=JSON.parse(t);e.timestamp&&Date.now()-e.timestamp>864e5&&localStorage.removeItem("reservation_cache")}catch(r){localStorage.removeItem("reservation_cache")}}clearAllExceptEssentials(){const e={};for(let r=0;r<localStorage.length;r++){const t=localStorage.key(r);if(t&&(t.includes("supabase")||t.includes("sb-"))){const r=localStorage.getItem(t);r&&(e[t]=r)}}const t=localStorage.getItem(tt);t&&(e[tt]=t),localStorage.clear(),Object.entries(e).forEach(([e,t])=>{localStorage.setItem(e,t)}),console.log("Cleared localStorage except essential keys",{preservedKeys:Object.keys(e)})}clearCorruptedStorage(){console.warn("Clearing corrupted localStorage");try{localStorage.clear(),localStorage.setItem(tt,rt)}catch(e){console.error("Failed to clear corrupted storage:",e)}}validateStoredData(e,t){try{const r=localStorage.getItem(e);if(!r)return null;const s=JSON.parse(r);return t(s)?s:(console.warn(`Invalid data structure for key: ${e}. Removing.`),localStorage.removeItem(e),null)}catch(r){return console.error(`Failed to validate data for key: ${e}`,r),localStorage.removeItem(e),null}}getItem(e){return console.warn(`[LocalStorageManager] DEPRECATED: getItem(${e}) - Use storageManager.get() instead`),Ae.get(e,{skipIntegrityCheck:!0})}setItem(e,t){console.warn(`[LocalStorageManager] DEPRECATED: setItem(${e}) - Use storageManager.set() instead`),Ae.set(e,t,{skipIntegrityCheck:!0})||(console.error(`Failed to set item: ${e}`),et.attemptRecovery().catch(e=>{console.error("Failed to recover storage:",e)}))}clearCacheData(){const e=["reservation_cache","properties_cache","cache_","temp_"];for(let t=localStorage.length-1;t>=0;t--){const r=localStorage.key(t);r&&e.some(e=>r.startsWith(e))&&localStorage.removeItem(r)}console.log("Cleared cache data from localStorage")}forceReset(){console.warn("[LocalStorageManager] DEPRECATED: forceReset() - Use storageManager.clearAll() instead"),Ae.clearAll(),localStorage.setItem(tt,rt),window.location.reload()}getStorageInfo(){console.warn("[LocalStorageManager] DEPRECATED: getStorageInfo() - Use storageManager.getDiagnostics() instead");const e=Ae.getDiagnostics();return{version:localStorage.getItem(tt)||"unknown",itemCount:e.item_count,approximateSize:e.total_size,keys:[]}}};c(st,"instance");let nt=st;nt.getInstance();class ot extends v.Component{constructor(e){super(e),c(this,"handleClearStorage",()=>{try{console.warn("[LocalStorageManager] DEPRECATED: resetLocalStorage() - Use storageManager.clearAll() instead"),Ae.clearAll()}catch(e){console.error("Failed to reset localStorage:",e),localStorage.clear(),window.location.reload()}}),c(this,"handleReload",()=>{window.location.reload()}),this.state={hasError:!1,errorMessage:""}}static getDerivedStateFromError(e){if(e.message.includes("localStorage")||e.message.includes("QuotaExceededError")||e.message.includes("storage")||"QuotaExceededError"===e.name)return{hasError:!0,errorMessage:e.message};throw e}componentDidCatch(e,t){console.error("LocalStorage Error:",e,t)}render(){return this.state.hasError?d.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:d.jsx("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:d.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),d.jsx("h2",{className:"mt-4 text-xl font-semibold text-gray-900",children:"Storage Error Detected"}),d.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"We've detected an issue with your browser's local storage. This might be due to:"}),d.jsxs("ul",{className:"mt-3 text-left text-sm text-gray-600 list-disc list-inside",children:[d.jsx("li",{children:"Outdated or corrupted storage data"}),d.jsx("li",{children:"Storage quota exceeded"}),d.jsx("li",{children:"Browser storage disabled or blocked"}),d.jsx("li",{children:"Incompatible data from a previous version"})]}),d.jsxs("div",{className:"mt-6 space-y-3",children:[d.jsx("button",{onClick:this.handleClearStorage,className:"w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Clear Storage & Reload"}),d.jsx("button",{onClick:this.handleReload,className:"w-full inline-flex justify-center items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Try Reload Only"})]}),d.jsxs("p",{className:"mt-4 text-xs text-gray-500",children:["Error: ",this.state.errorMessage]})]})})}):this.props.children}}class it extends v.Component{constructor(e){super(e),c(this,"retryTimeoutId"),c(this,"memoryCheckInterval"),c(this,"handleOnline",()=>{this.setState({isOffline:!1}),this.state.hasError&&this.state.retryCount<(this.props.maxRetries||3)&&this.handleRetryWithDelay()}),c(this,"handleOffline",()=>{this.setState({isOffline:!0})}),c(this,"handleUnhandledRejection",e=>{var t;console.error("Unhandled promise rejection:",e.reason),e.preventDefault();const r=new Error(`Unhandled Promise Rejection: ${(null==(t=e.reason)?void 0:t.message)||e.reason}`);this.componentDidCatch(r,{componentStack:"Promise rejection"})}),c(this,"startMemoryMonitoring",()=>{this.memoryCheckInterval=setInterval(()=>{if("memory"in performance){const e=performance.memory,t=e.usedJSHeapSize/e.jsHeapSizeLimit*100;t>80?(console.warn(`High memory usage detected: ${t.toFixed(1)}%`),this.setState({memoryWarning:!0}),"gc"in window&&window.gc()):t<60&&this.setState({memoryWarning:!1})}},3e4)}),c(this,"logErrorDetails",(e,t)=>{const r={message:e.message,stack:e.stack,componentStack:t.componentStack,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent,retryCount:this.state.retryCount,isOffline:this.state.isOffline,memoryWarning:this.state.memoryWarning,memory:"memory"in performance?performance.memory:null};console.error("Detailed error information:",r),this.sendErrorToMonitoring(r)}),c(this,"sendErrorToMonitoring",e=>{try{fetch("/api/errors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).catch(e=>console.error("Failed to send error to monitoring:",e))}catch(t){console.error("Error sending to monitoring service:",t)}}),c(this,"shouldAutoRetry",e=>{const t=this.props.maxRetries||3;return!(this.state.retryCount>=t)&&["ChunkLoadError","NetworkError","Failed to fetch","Loading chunk","Script error"].some(t=>e.message.includes(t)||e.name.includes(t))}),c(this,"handleRetryWithDelay",()=>{const e=this.props.retryDelay||1e3+500*this.state.retryCount;this.setState({isRetrying:!0}),this.retryTimeoutId=setTimeout(()=>{this.handleRetry()},e)}),c(this,"handleRetry",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0,isRetrying:!1})}),c(this,"handleReload",()=>{window.location.reload()}),this.state={hasError:!1,retryCount:0,isRetrying:!1,isOffline:!navigator.onLine,memoryWarning:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidMount(){this.props.enableOfflineSupport&&(window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline)),this.props.enableMemoryMonitoring&&this.startMemoryMonitoring(),window.addEventListener("unhandledrejection",this.handleUnhandledRejection)}componentWillUnmount(){window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline),window.removeEventListener("unhandledrejection",this.handleUnhandledRejection),this.retryTimeoutId&&clearTimeout(this.retryTimeoutId),this.memoryCheckInterval&&clearInterval(this.memoryCheckInterval)}componentDidCatch(e,t){console.error("CrashPrevention caught an error:",e,t),this.setState({errorInfo:t,retryCount:this.state.retryCount+1}),this.logErrorDetails(e,t),this.props.onError&&this.props.onError(e,t),this.shouldAutoRetry(e)&&this.handleRetryWithDelay()}componentDidUpdate(e){this.props.resetOnPropsChange&&e.children!==this.props.children&&this.state.hasError&&this.setState({hasError:!1,error:void 0,errorInfo:void 0,retryCount:0,isRetrying:!1})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:d.jsx("div",{className:"min-h-[400px] flex items-center justify-center bg-gray-50 rounded-lg border border-gray-200",children:d.jsxs("div",{className:"text-center p-8 max-w-lg",children:[d.jsxs("div",{className:"flex justify-center gap-2 mb-4",children:[d.jsx("div",{className:"w-3 h-3 rounded-full "+(this.state.isOffline?"bg-red-500":"bg-green-500"),title:this.state.isOffline?"Offline":"Online"}),this.state.memoryWarning&&d.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500",title:"High memory usage"})]}),d.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:this.state.isRetrying?d.jsx(M,{className:"w-8 h-8 text-blue-600 animate-spin"}):d.jsx(q,{className:"w-8 h-8 text-red-600"})}),d.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:this.state.isRetrying?"Retrying...":"Something went wrong"}),d.jsx("p",{className:"text-sm text-gray-600 mb-4",children:this.state.isOffline?"You appear to be offline. Please check your connection.":"We encountered an unexpected error. Please try again or contact support if the problem persists."}),this.state.retryCount>0&&d.jsxs("p",{className:"text-xs text-gray-500 mb-4",children:["Retry attempt: ",this.state.retryCount,"/",this.props.maxRetries||3]}),this.props.enableOfflineSupport&&d.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[this.state.isOffline?d.jsx(F,{className:"w-4 h-4 text-red-500"}):d.jsx(U,{className:"w-4 h-4 text-green-500"}),d.jsx("span",{className:"text-sm text-gray-600",children:this.state.isOffline?"Offline":"Online"})]}),!1,d.jsxs("div",{className:"flex gap-3 justify-center",children:[d.jsxs("button",{onClick:this.handleRetry,disabled:this.state.isRetrying||this.state.retryCount>=(this.props.maxRetries||3),className:"inline-flex items-center px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[d.jsx(M,{className:"w-4 h-4 mr-2 "+(this.state.isRetrying?"animate-spin":"")}),this.state.isRetrying?"Retrying...":"Try Again"]}),d.jsxs("button",{onClick:this.handleReload,className:"inline-flex items-center px-4 py-2 bg-gray-600 text-white text-sm font-medium rounded-lg hover:bg-gray-700 transition-colors",children:[d.jsx(z,{className:"w-4 h-4 mr-2"}),"Reload Page"]})]})]})}):this.props.children}}const at=class e{constructor(){c(this,"sessionId"),c(this,"userActions",[]),c(this,"isMonitoring",!1),c(this,"reportQueue",[]),c(this,"maxReports",50),c(this,"maxUserActions",20),c(this,"lastReportTime",0),c(this,"reportCount",0),c(this,"RATE_LIMIT_WINDOW",6e4),c(this,"MAX_REPORTS_PER_WINDOW",10),this.sessionId=this.generateSessionId(),this.initializeMonitoring()}static getInstance(){return e.instance||(e.instance=new e),e.instance}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}initializeMonitoring(){this.isMonitoring||(this.isMonitoring=!0,window.addEventListener("error",this.handleError.bind(this)),window.addEventListener("unhandledrejection",this.handlePromiseRejection.bind(this)),this.initializePerformanceMonitoring(),this.initializeMemoryMonitoring(),this.initializeUserActionTracking(),this.initializeNetworkMonitoring())}handleError(e){var t;const r={id:this.generateReportId(),timestamp:Date.now(),type:"error",severity:this.classifyErrorSeverity(e.error),message:e.message,stack:null==(t=e.error)?void 0:t.stack,url:window.location.href,userAgent:navigator.userAgent,sessionId:this.sessionId,userId:this.getCurrentUserId(),tenantId:this.getCurrentTenantId(),buildVersion:this.getBuildVersion(),context:this.gatherContext()};this.addReport(r)}handlePromiseRejection(e){var t,r;const s={id:this.generateReportId(),timestamp:Date.now(),type:"error",severity:"medium",message:`Unhandled Promise Rejection: ${(null==(t=e.reason)?void 0:t.message)||e.reason}`,stack:null==(r=e.reason)?void 0:r.stack,url:window.location.href,userAgent:navigator.userAgent,sessionId:this.sessionId,userId:this.getCurrentUserId(),tenantId:this.getCurrentTenantId(),buildVersion:this.getBuildVersion(),context:this.gatherContext()};this.addReport(s)}initializePerformanceMonitoring(){if("PerformanceObserver"in window){const t=new PerformanceObserver(e=>{const t=e.getEntries(),r=t[t.length-1];r.startTime>4e3&&this.reportPerformanceIssue("lcp",r.startTime,"high")});try{t.observe({entryTypes:["largest-contentful-paint"]})}catch(e){}const r=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{e.processingStart-e.startTime>100&&this.reportPerformanceIssue("fid",e.processingStart-e.startTime,"medium")})});try{r.observe({entryTypes:["first-input"]})}catch(e){}const s=new PerformanceObserver(e=>{let t=0;e.getEntries().forEach(e=>{e.hadRecentInput||(t+=e.value)}),t>.25&&this.reportPerformanceIssue("cls",t,"medium")});try{s.observe({entryTypes:["layout-shift"]})}catch(e){}}if("PerformanceObserver"in window){const t=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{e.duration>50&&this.reportPerformanceIssue("long-task",e.duration,"low")})});try{t.observe({entryTypes:["longtask"]})}catch(e){}}}initializeMemoryMonitoring(){"memory"in performance&&setInterval(()=>{const e=performance.memory,t=Math.round(e.usedJSHeapSize/1048576),r=Math.round(e.totalJSHeapSize/1048576),s=Math.round(e.jsHeapSizeLimit/1048576),n=e.usedJSHeapSize/e.jsHeapSizeLimit*100;n>90?this.reportMemoryIssue("critical",{usedMB:t,totalMB:r,limitMB:s,usedPercent:Math.round(n)}):n>80&&this.reportMemoryIssue("high",{usedMB:t,totalMB:r,limitMB:s,usedPercent:Math.round(n)})},3e4)}initializeUserActionTracking(){document.addEventListener("click",e=>{const t=e.target,r=`Click: ${t.tagName}${t.className?"."+t.className.split(" ").join("."):""}${t.id?"#"+t.id:""}`;this.addUserAction(r)});let e=window.location.pathname;setInterval(()=>{window.location.pathname!==e&&(e=window.location.pathname,this.addUserAction(`Navigation: ${e}`))},1e3),document.addEventListener("submit",e=>{const t=e.target,r=`Form Submit: ${t.action||t.id||"unnamed"}`;this.addUserAction(r)})}initializeNetworkMonitoring(){window.addEventListener("online",()=>{this.addUserAction("Network: Back online")}),window.addEventListener("offline",()=>{this.reportNetworkIssue("offline")})}addUserAction(e){this.userActions.push(`${(new Date).toISOString()}: ${e}`),this.userActions.length>this.maxUserActions&&(this.userActions=this.userActions.slice(-this.maxUserActions))}gatherContext(){return{memoryUsage:"memory"in performance?performance.memory:null,networkStatus:navigator.onLine,viewportSize:{width:window.innerWidth,height:window.innerHeight},timestamp:(new Date).toISOString(),route:window.location.pathname,userActions:[...this.userActions]}}classifyErrorSeverity(e){var t,r;if(!e)return"low";const s=(null==(t=e.message)?void 0:t.toLowerCase())||"",n=(null==(r=e.stack)?void 0:r.toLowerCase())||"";return s.includes("chunk")&&s.includes("load")||s.includes("out of memory")||s.includes("maximum call stack")?"critical":n.includes("auth")||s.includes("network")||s.includes("fetch")||s.includes("permission")||s.includes("unauthorized")||n.includes("payment")||n.includes("billing")?"high":s.includes("validation")||s.includes("invalid")||s.includes("timeout")?"medium":"low"}reportPerformanceIssue(e,t,r){const s={id:this.generateReportId(),timestamp:Date.now(),type:"performance",severity:r,message:`Performance issue: ${e} = ${t.toFixed(2)}ms`,url:window.location.href,userAgent:navigator.userAgent,sessionId:this.sessionId,userId:this.getCurrentUserId(),tenantId:this.getCurrentTenantId(),buildVersion:this.getBuildVersion(),context:this.gatherContext()};this.addReport(s)}reportMemoryIssue(e,t){const r={id:this.generateReportId(),timestamp:Date.now(),type:"memory",severity:e,message:`High memory usage: ${t.usedPercent}% (${t.usedMB}MB/${t.limitMB}MB)`,url:window.location.href,userAgent:navigator.userAgent,sessionId:this.sessionId,userId:this.getCurrentUserId(),tenantId:this.getCurrentTenantId(),buildVersion:this.getBuildVersion(),context:l(a({},this.gatherContext()),{memoryDetails:t})};this.addReport(r)}reportNetworkIssue(e,t){var r,s;if((null==(r=null==t?void 0:t.url)?void 0:r.includes("/api/crash-reports"))||(null==(s=null==t?void 0:t.url)?void 0:s.includes("crash-reports")))return;const n={id:this.generateReportId(),timestamp:Date.now(),type:"error",severity:"offline"===e?"high":"medium",message:`Network issue: ${e}`,url:window.location.href,userAgent:navigator.userAgent,sessionId:this.sessionId,userId:this.getCurrentUserId(),tenantId:this.getCurrentTenantId(),buildVersion:this.getBuildVersion(),context:l(a({},this.gatherContext()),{networkDetails:t})};this.addReport(n)}addReport(e){if("critical"!==e.severity)return;const t=Date.now();t-this.lastReportTime>this.RATE_LIMIT_WINDOW&&(this.reportCount=0,this.lastReportTime=t),this.reportCount>=this.MAX_REPORTS_PER_WINDOW||(this.reportCount++,this.reportQueue.push(e),this.reportQueue.length>this.maxReports&&(this.reportQueue=this.reportQueue.slice(-this.maxReports)),this.isProductionEnvironment()&&this.sendReportToService(e))}isProductionEnvironment(){const e="http://localhost:8000",t=e.endsWith("://pms.base360.ai");return e.includes("localhost")&&console.debug(`[CrashMonitor] Environment check - URL: ${e}, isProduction: ${t}`),t}sendReportToService(e){return u(this,null,function*(){if(!e.message||!e.message.toLowerCase().includes("crash-reports"))try{if(!this.isProductionEnvironment()||"critical"!==e.severity)return;yield fetch("/api/crash-reports",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(5e3)})}catch(t){}})}generateReportId(){return`crash_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}getCurrentUserId(){var e;try{const t=localStorage.getItem("auth_session");if(t)return null==(e=JSON.parse(t).user)?void 0:e.id}catch(t){}}getCurrentTenantId(){var e;try{const t=localStorage.getItem("auth_session");if(t)return null==(e=JSON.parse(t).user)?void 0:e.tenant_id}catch(t){}}getBuildVersion(){return'"1.0.0"'}reportError(e,t){const r={id:this.generateReportId(),timestamp:Date.now(),type:"error",severity:this.classifyErrorSeverity(e),message:t?`${t}: ${e.message}`:e.message,stack:e.stack,url:window.location.href,userAgent:navigator.userAgent,sessionId:this.sessionId,userId:this.getCurrentUserId(),tenantId:this.getCurrentTenantId(),buildVersion:this.getBuildVersion(),context:this.gatherContext()};this.addReport(r)}getReports(){return[...this.reportQueue]}clearReports(){this.reportQueue=[]}exportReports(){return JSON.stringify({sessionId:this.sessionId,exportTime:(new Date).toISOString(),reports:this.reportQueue},null,2)}};function lt(){const[e,t]=v.useState(""),[r,s]=v.useState(""),[n,o]=v.useState(!1),[i,a]=v.useState(null),{user:l,signIn:c}=Be(),h=S(),p=b();return v.useEffect(()=>{var e;if(l){const t=(null==(e=p.state)?void 0:e.from)||"/";h(t,{replace:!0})}},[l,h,p]),d.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[d.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[d.jsx("div",{className:"flex justify-center",children:d.jsx(V,{className:"h-12 w-12 text-primary"})}),d.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Sign in to your account"})]}),d.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:d.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[i&&d.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md flex items-start",children:[d.jsx(H,{className:"h-5 w-5 text-red-400 mt-0.5 mr-3"}),d.jsx("p",{className:"text-sm text-red-600",children:i})]}),d.jsxs("form",{onSubmit:t=>u(null,null,function*(){t.preventDefault();try{o(!0),a(null);const{error:t}=yield c(e,r);if(t)throw t}catch(s){console.error("Login error:",s);const e=s instanceof Error?s.message:"Authentication failed";a(e)}finally{o(!1)}}),className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email address"}),d.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[d.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:d.jsx(B,{className:"h-5 w-5 text-gray-400"})}),d.jsx("input",{id:"email",type:"email",required:!0,value:e,onChange:e=>t(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary focus:border-primary",placeholder:"you@example.com"})]})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),d.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[d.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:d.jsx(J,{className:"h-5 w-5 text-gray-400"})}),d.jsx("input",{id:"password",type:"password",required:!0,value:r,onChange:e=>s(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary focus:border-primary",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]})]}),d.jsx("div",{children:d.jsx("button",{type:"submit",disabled:n,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50",children:n?d.jsxs("div",{className:"flex items-center",children:[d.jsx(W,{className:"h-5 w-5 animate-spin mr-2"}),"Signing in..."]}):"Sign in"})})]})]})})]})}c(at,"instance"),at.getInstance();const ct=({propertyId:e="prop-001",debugTenant:t,showRaw:r})=>{const[s,n]=v.useState(null),[o,i]=v.useState(!0),[a,l]=v.useState(""),c=t||"candidate";if(v.useEffect(()=>{u(null,null,function*(){i(!0);try{const t=yield $e.getDashboardSummary(e,{simulatedTenant:c,timestamp:Date.now()});n(t)}catch(t){l("Failed to load revenue data"),console.error(t)}finally{i(!1)}})},[e,c]),o)return d.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:d.jsxs("div",{className:"animate-pulse space-y-4",children:[d.jsx("div",{className:"h-4 bg-gray-100 rounded w-1/4"}),d.jsx("div",{className:"h-8 bg-gray-100 rounded w-1/2"}),d.jsxs("div",{className:"flex gap-4 pt-4",children:[d.jsx("div",{className:"h-12 bg-gray-100 rounded flex-1"}),d.jsx("div",{className:"h-12 bg-gray-100 rounded flex-1"})]})]})});if(a)return d.jsx("div",{className:"p-4 text-red-500 bg-red-50 rounded-lg",children:a});if(!s)return null;const h=Math.round(100*s.total_revenue)/100;return d.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow duration-300",children:[r&&d.jsxs("div",{className:"p-3 bg-gray-50 text-xs font-mono border-b border-gray-100 overflow-auto max-h-32",children:[d.jsx("strong",{className:"block mb-1 text-gray-500 uppercase tracking-wider text-[10px]",children:"Raw API Response"}),d.jsx("pre",{className:"text-gray-700",children:JSON.stringify(s,null,2)})]}),d.jsxs("div",{className:"p-6",children:[d.jsx("div",{className:"flex items-center justify-between mb-6",children:d.jsxs("div",{children:[d.jsx("h2",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide",children:"Total Revenue"}),d.jsxs("div",{className:"flex items-baseline gap-2 mt-1",children:[d.jsxs("span",{className:"text-3xl font-bold text-gray-900 tracking-tight",children:[s.currency," ",h.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),d.jsxs("span",{className:"inline-flex items-baseline px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 md:mt-2 lg:mt-0",children:[d.jsx("svg",{className:"-ml-1 mr-0.5 h-3 w-3 flex-shrink-0 self-center text-green-500",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true",children:d.jsx("path",{fillRule:"evenodd",d:"M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z",clipRule:"evenodd"})}),"12%"]})]})]})}),d.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-gray-100",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase tracking-wider",children:"Property ID"}),d.jsx("p",{className:"text-sm font-semibold text-gray-700 font-mono mt-1",children:s.property_id})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase tracking-wider",children:"Reservations"}),d.jsxs("p",{className:"text-sm font-semibold text-gray-700 mt-1",children:[s.reservations_count," ",d.jsx("span",{className:"font-normal text-gray-400",children:"bookings"})]})]})]}),d.jsx("div",{className:"mt-4 h-6",children:Math.abs(s.total_revenue-h)>1e-6&&r&&d.jsxs("div",{className:"flex items-center text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded",children:[d.jsx("svg",{className:"h-4 w-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"Precision Mismatch Detected"]})})]})]})},ut=[{id:"prop-001",name:"Beach House Alpha"},{id:"prop-002",name:"City Apartment Downtown"},{id:"prop-003",name:"Country Villa Estate"},{id:"prop-004",name:"Lakeside Cottage"},{id:"prop-005",name:"Urban Loft Modern"}],dt=()=>{const[e,t]=v.useState("prop-001");return d.jsx("div",{className:"p-4 lg:p-6 min-h-full",children:d.jsxs("div",{className:"max-w-7xl mx-auto",children:[d.jsx("h1",{className:"text-2xl font-bold mb-6 text-gray-900",children:"Property Management Dashboard"}),d.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 lg:p-6",children:[d.jsx("div",{className:"mb-6",children:d.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-lg lg:text-xl font-medium text-gray-900 mb-2",children:"Revenue Overview"}),d.jsx("p",{className:"text-sm lg:text-base text-gray-600",children:"Monthly performance insights for your properties"})]}),d.jsxs("div",{className:"flex flex-col sm:items-end",children:[d.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1",children:"Select Property"}),d.jsx("select",{value:e,onChange:e=>t(e.target.value),className:"block w-full sm:w-auto min-w-[200px] px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm",children:ut.map(e=>d.jsx("option",{value:e.id,children:e.name},e.id))})]})]})}),d.jsx("div",{className:"space-y-6",children:d.jsx(ct,{propertyId:e})})]})]})})};function ht(){return d.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[d.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[d.jsx("div",{className:"flex justify-center",children:d.jsx(K,{className:"h-12 w-12 text-red-600"})}),d.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Access Denied"}),d.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"You don't have permission to access this resource"})]}),d.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:d.jsx("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:d.jsx("div",{className:"text-center",children:d.jsx(k,{to:"/",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:"Return to Dashboard"})})})})]})}function pt(){const e=Be(),{user:t}=e;return"initializing"===e.status?d.jsx("div",{className:"min-h-screen flex items-center justify-center",children:d.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):t?d.jsx(x,{to:"/dashboard",replace:!0}):d.jsx(x,{to:"/login",replace:!0})}function gt(){const e=b(),t=_(),r=[];let s=Object.keys(mt).filter(t=>N({path:t,end:!1},e.pathname)).sort((e,t)=>t.length-e.length)[0];for(;s;){const e=mt[s];if(!e)break;const{label:n,parent:o,dynamicLabel:i}=e,a=i?i(t):n;r.unshift({path:s,label:a}),s=o}return r}const mt={"/hr":{label:"Employees management"},"/hr/people":{label:"People",parent:"/hr"},"/hr/my-profile/:id":{label:"My Profile",parent:"/hr"},"/hr/people/:id":{label:"Profile",parent:"/hr"},"/hr/away":{label:"Who's Away",parent:"/hr"},"/hr/time-away-requests":{label:"Requests",parent:"/hr"},"/hr/settings":{label:"Settings",parent:"/hr"},"/hr/settings/company":{label:"Company",parent:"/hr/settings"},"/hr/settings/time-away":{label:"Time Away",parent:"/hr/settings"},"/pricing":{label:"Pricing management"},"/pricing/listings":{label:"Listings pricing",parent:"/pricing"},"/pricing/listings/:id":{label:"Listing details",parent:"/pricing/listings"},"/pricing/groups":{label:"Groups pricing",parent:"/pricing"}},ft=()=>{const e=gt();return e.length?d.jsx("nav",{className:"flex items-center gap-x-2",children:e.map((t,r)=>d.jsxs("span",{className:"flex items-center gap-x-2",children:[r>0&&d.jsx(G,{size:14,color:"#64748B"}),r===e.length-1?d.jsx("p",{className:"text-sm text-[#09090B]",children:t.label}):d.jsx("p",{className:"text-sm text-[#64748B]",children:t.label})]},t.path))}):null};function yt(){const{setIsMobileOpen:e,isCollapsed:t}=qt(),{user:r,signOut:s}=Be();S();const[n,o]=v.useState(!1),i=v.useRef(null),a=gt();return v.useEffect(()=>{const e=e=>{i.current&&!i.current.contains(e.target)&&o(!1)};return n&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[n]),d.jsxs("header",{className:"bg-white border-b border-gray-200 h-16 flex items-center justify-between px-4 lg:px-6",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("button",{onClick:()=>e(!0),className:"lg:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Open menu",children:d.jsx(Y,{className:"w-5 h-5 text-gray-600"})}),d.jsx("div",{className:"hidden md:block",children:d.jsx(ft,{crumbs:a})})]}),d.jsx("div",{className:"flex items-center gap-3",children:d.jsxs("div",{className:"relative",ref:i,children:[d.jsxs("button",{onClick:()=>o(!n),className:"flex items-center gap-2 p-2 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"User menu",children:[d.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:d.jsx(L,{className:"w-4 h-4 text-blue-600"})}),d.jsx("span",{className:"hidden md:block text-sm font-medium text-gray-700",children:(null==r?void 0:r.full_name)||(null==r?void 0:r.email)||"User"})]}),n&&d.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50",children:[d.jsxs("div",{className:"px-4 py-3 border-b border-gray-200",children:[d.jsx("p",{className:"text-sm font-medium text-gray-900",children:(null==r?void 0:r.full_name)||"User"}),d.jsx("p",{className:"text-xs text-gray-500 truncate",children:null==r?void 0:r.email})]}),d.jsxs(k,{to:"/profile",onClick:()=>o(!1),className:"flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors",children:[d.jsx(Q,{className:"w-4 h-4"}),"Profile"]}),d.jsx("div",{className:"border-t border-gray-200 mt-1 pt-1",children:d.jsxs("button",{onClick:()=>u(null,null,function*(){try{o(!1),yield s()}catch(e){console.error("Error signing out:",e)}}),className:"flex items-center gap-3 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors w-full",children:[d.jsx(D,{className:"w-4 h-4"}),"Sign out"]})})]})]})})]})}const vt=new class{getAuthHeaders(){return u(this,null,function*(){const{data:{session:e}}=yield ke.auth.getSession();if(!(null==e?void 0:e.access_token))throw new Error("No active session");return{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"}})}getProfile(){return u(this,null,function*(){const e=yield fetch("http://localhost:8000/api/v1/profile",{method:"GET",headers:yield this.getAuthHeaders()});if(!e.ok)throw new Error(`Failed to fetch profile: ${e.statusText}`);return e.json()})}updateProfile(e){return u(this,null,function*(){const t=yield fetch("http://localhost:8000/api/v1/profile",{method:"PUT",headers:yield this.getAuthHeaders(),body:JSON.stringify(e)});if(!t.ok)throw new Error(`Failed to update profile: ${t.statusText}`);return t.json()})}updatePreferences(e){return u(this,null,function*(){const t=yield fetch("http://localhost:8000/api/v1/profile/preferences",{method:"PUT",headers:yield this.getAuthHeaders(),body:JSON.stringify(e)});if(!t.ok)throw new Error(`Failed to update preferences: ${t.statusText}`);return t.json()})}updateNotificationPreference(e,t){return u(this,null,function*(){const r=yield fetch(`http://localhost:8000/api/v1/profile/notification-preferences/${e}`,{method:"PUT",headers:yield this.getAuthHeaders(),body:JSON.stringify(t)});if(!r.ok)throw new Error(`Failed to update notification preference: ${r.statusText}`);return r.json()})}uploadAvatar(e){return u(this,null,function*(){try{const t=yield this.getAuthHeaders(),r=new FormData;r.append("file",e);const s=yield fetch("http://localhost:8000/api/v1/profile/avatar",{method:"POST",headers:{Authorization:t.Authorization},body:r});if(!s.ok)throw new Error(`Upload failed: ${s.status} ${s.statusText}`);return s.json()}catch(t){throw console.error("Avatar upload error:",t),t}})}deleteAvatar(){return u(this,null,function*(){try{const e=yield fetch("http://localhost:8000/api/v1/profile/avatar",{method:"DELETE",headers:yield this.getAuthHeaders()});if(!e.ok)throw new Error(`Failed to delete avatar: ${e.statusText}`);return e.json()}catch(e){throw console.error("Avatar delete error:",e),e}})}},xt=({currentAvatarUrl:e,onAvatarUpdate:t,size:r="md"})=>{const[s,n]=v.useState(!1),[o,i]=v.useState(null),[a,l]=v.useState(!1),[c,h]=v.useState(null),[p,g]=v.useState(null),m=v.useRef(null),f=v.useRef(null),y=e=>u(null,null,function*(){const r=(e=>["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(e.type)?e.size>5242880?"File size must be less than 5MB":null:"Please select a valid image file (JPEG, PNG, WebP, or GIF)")(e);if(r)return void h(r);const s=new FileReader;s.onload=e=>{var t;i(null==(t=e.target)?void 0:t.result)},s.readAsDataURL(e),n(!0),h(null);try{const r=yield vt.uploadAvatar(e);t(r.avatar_url),g("Avatar updated successfully!"),i(null),setTimeout(()=>g(null),3e3)}catch(o){console.error("Error uploading avatar:",o);const e=o instanceof Error?o.message:"Failed to upload avatar. Please try again.";h(e),i(null)}finally{n(!1)}}),x=()=>u(null,null,function*(){try{yield vt.deleteAvatar(),t(null),i(null),g("Avatar removed successfully!"),setTimeout(()=>g(null),3e3)}catch(e){console.error("Error deleting avatar:",e);const t=e instanceof Error?e.message:"Failed to remove avatar";h(t)}}),b=()=>{var e;null==(e=m.current)||e.click()},S=()=>{h(null),g(null)},w=o||e;return d.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[c&&d.jsxs("div",{className:"w-full max-w-sm bg-red-50 border border-red-200 rounded-lg p-3 flex items-start gap-2",children:[d.jsx(H,{className:"h-4 w-4 text-red-600 flex-shrink-0 mt-0.5"}),d.jsx("div",{className:"flex-1",children:d.jsx("span",{className:"text-red-800 text-xs font-medium",children:c})}),d.jsx("button",{onClick:S,className:"text-red-600 hover:text-red-800",children:d.jsx(T,{className:"h-3 w-3"})})]}),p&&d.jsxs("div",{className:"w-full max-w-sm bg-green-50 border border-green-200 rounded-lg p-3 flex items-start gap-2",children:[d.jsx(X,{className:"h-4 w-4 text-green-600 flex-shrink-0 mt-0.5"}),d.jsx("div",{className:"flex-1",children:d.jsx("span",{className:"text-green-800 text-xs font-medium",children:p})}),d.jsx("button",{onClick:S,className:"text-green-600 hover:text-green-800",children:d.jsx(T,{className:"h-3 w-3"})})]}),d.jsxs("div",{className:"relative group",children:[d.jsxs("div",{ref:f,onDrop:e=>{e.preventDefault(),l(!1);const t=e.dataTransfer.files;t.length>0&&y(t[0])},onDragOver:e=>{e.preventDefault(),l(!0)},onDragLeave:e=>{e.preventDefault(),l(!1)},className:`${{sm:"w-16 h-16",md:"w-24 h-24",lg:"w-32 h-32"}[r]} rounded-full overflow-hidden bg-gray-100 border-4 ${a?"border-primary":"border-gray-200"} flex items-center justify-center relative transition-all duration-200 ${s?"opacity-60":"hover:border-gray-300 cursor-pointer"}`,onClick:b,children:[w?d.jsx("img",{src:w,alt:"Profile",className:"w-full h-full object-cover avatar-image"}):d.jsx(L,{className:`${{sm:"w-6 h-6",md:"w-8 h-8",lg:"w-10 h-10"}[r]} text-gray-400`}),d.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity "+(s?"opacity-100":""),children:s?d.jsxs("div",{className:"flex flex-col items-center gap-2",children:[d.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"}),d.jsx("span",{className:"text-white text-xs font-medium",children:"Uploading..."})]}):d.jsxs("div",{className:"flex flex-col items-center gap-1",children:[d.jsx(Z,{className:"w-6 h-6 text-white"}),d.jsx("span",{className:"text-white text-xs font-medium",children:"Change"})]})}),a&&!s&&d.jsx("div",{className:"absolute inset-0 bg-primary bg-opacity-80 flex items-center justify-center",children:d.jsxs("div",{className:"flex flex-col items-center gap-1",children:[d.jsx(ee,{className:"w-6 h-6 text-white"}),d.jsx("span",{className:"text-white text-xs font-medium",children:"Drop here"})]})})]}),e&&!s&&d.jsx("button",{onClick:e=>{e.stopPropagation(),x()},className:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full p-1.5 shadow-lg hover:bg-red-600 transition-colors border-2 border-white",title:"Remove avatar",children:d.jsx(T,{className:"w-3 h-3"})})]}),d.jsxs("div",{className:"text-center space-y-3",children:[d.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center",children:[d.jsxs("button",{onClick:b,disabled:s,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[d.jsx(ee,{className:"w-4 h-4 mr-2"}),s?"Uploading...":e?"Change Photo":"Upload Photo"]}),e&&!s&&d.jsxs("button",{onClick:x,className:"inline-flex items-center px-4 py-2 border border-red-300 shadow-sm text-sm font-medium rounded-lg text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors",children:[d.jsx(T,{className:"w-4 h-4 mr-2"}),"Remove"]})]}),d.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[d.jsxs("div",{className:"flex items-center justify-center gap-1",children:[d.jsx(te,{className:"w-3 h-3"}),d.jsx("span",{children:"Max 5MB ‚Ä¢ JPEG, PNG, WebP, GIF"})]}),d.jsx("p",{children:"Click, drag & drop, or paste from clipboard"})]})]}),d.jsx("input",{ref:m,type:"file",accept:"image/*",onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&y(r)},className:"hidden"})]})},bt=()=>{const[e,t]=v.useState(null),[r,s]=v.useState(!0),[n,o]=v.useState(!1),[i,c]=v.useState("profile"),[h,p]=v.useState(!1),[g,m]=v.useState(null),[f,y]=v.useState({}),[x,b]=v.useState({});v.useEffect(()=>{S()},[]),v.useEffect(()=>{if(!e)return;const t=Object.keys(f).some(t=>{const r=t;return f[r]!==e.profile[r]}),r=Object.keys(x).some(t=>{const r=t;return x[r]!==e.preferences[r]});p(t||r)},[f,x,e]);const S=()=>u(null,null,function*(){try{s(!0),m(null);const e=yield vt.getProfile();t(e),y({display_name:e.profile.display_name||"",bio:e.profile.bio||"",phone:e.profile.phone||"",department:e.profile.department||"",job_title:e.profile.job_title||"",location:e.profile.location||"",timezone:e.profile.timezone,language:e.profile.language,theme:e.profile.theme}),b({notification_email:e.preferences.notification_email,notification_push:e.preferences.notification_push,notification_desktop:e.preferences.notification_desktop,notification_sound:e.preferences.notification_sound,auto_refresh:e.preferences.auto_refresh,compact_view:e.preferences.compact_view,sidebar_collapsed:e.preferences.sidebar_collapsed})}catch(e){console.error("Error loading profile:",e),m("Failed to load profile data"),ye.error("Failed to load profile")}finally{s(!1)}}),w=(e,r,s)=>u(null,null,function*(){try{yield vt.updateNotificationPreference(e,{[r]:s}),t(t=>{if(!t)return null;const n=t.notification_preferences.map(t=>t.category===e?l(a({},t),{[r]:s}):t);return l(a({},t),{notification_preferences:n})}),ye.success("Notification preference updated")}catch(n){console.error("Error updating notification preference:",n),ye.error("Failed to update notification preference")}});if(r)return d.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:d.jsxs("div",{className:"flex items-center gap-3 text-gray-500",children:[d.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),d.jsx("span",{className:"text-sm font-medium",children:"Loading profile..."})]})});if(!e)return d.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:d.jsxs("div",{className:"text-center",children:[d.jsx(H,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),d.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Failed to Load Profile"}),d.jsx("p",{className:"text-gray-600 mb-4",children:"There was an error loading your profile data."}),d.jsx("button",{onClick:S,className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors",children:"Try Again"})]})});const k=[{id:"profile",label:"Profile",icon:L,description:"Personal information and settings"},{id:"preferences",label:"Preferences",icon:ne,description:"App preferences and display options"},{id:"notifications",label:"Notifications",icon:oe,description:"Notification settings by category"}];return d.jsx("div",{className:"min-h-screen bg-gray-50",children:d.jsxs("div",{className:"max-w-5xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:[d.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 mb-8 overflow-hidden",children:[d.jsx("div",{className:"bg-gradient-to-r from-primary/10 to-primary/5 px-8 py-6",children:d.jsxs("div",{className:"flex items-center gap-6",children:[d.jsx("div",{className:"relative",children:d.jsx("div",{className:"w-20 h-20 rounded-full overflow-hidden bg-gray-100 border-4 border-white shadow-lg",children:e.profile.avatar_url?d.jsx("img",{src:e.profile.avatar_url,alt:"Profile",className:"w-full h-full object-cover"}):d.jsx("div",{className:"w-full h-full flex items-center justify-center",children:d.jsx(L,{className:"w-8 h-8 text-gray-400"})})})}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:e.profile.display_name||"User Profile"}),d.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-600",children:[e.profile.job_title&&d.jsxs("span",{className:"flex items-center gap-1",children:[d.jsx(re,{className:"w-4 h-4"}),e.profile.job_title]}),e.profile.department&&d.jsxs("span",{className:"flex items-center gap-1",children:[d.jsx(z,{className:"w-4 h-4"}),e.profile.department]}),e.profile.location&&d.jsxs("span",{className:"flex items-center gap-1",children:[d.jsx(se,{className:"w-4 h-4"}),e.profile.location]})]})]})]})}),d.jsx("div",{className:"border-b border-gray-200",children:d.jsx("nav",{className:"flex",role:"tablist",children:k.map(e=>{const t=e.icon;return d.jsxs("button",{onClick:()=>c(e.id),role:"tab","aria-selected":i===e.id,className:"flex-1 flex flex-col items-center px-6 py-4 text-sm font-medium border-b-2 transition-all duration-200 "+(i===e.id?"border-primary text-primary bg-primary/5":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:[d.jsx(t,{className:"w-5 h-5 mb-1"}),d.jsx("span",{className:"font-semibold",children:e.label}),d.jsx("span",{className:"text-xs text-gray-500 mt-1 hidden sm:block",children:e.description})]},e.id)})})})]}),g&&d.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[d.jsx(H,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),d.jsx("div",{className:"flex-1",children:d.jsx("span",{className:"text-red-800 text-sm font-medium",children:g})}),d.jsx("button",{onClick:()=>m(null),className:"text-red-600 hover:text-red-800 transition-colors",children:d.jsx(T,{className:"h-4 w-4"})})]}),d.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:d.jsxs("div",{className:"p-8",children:["profile"===i&&d.jsxs("div",{className:"space-y-8",children:[d.jsxs("div",{className:"text-center",children:[d.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center justify-center gap-2",children:[d.jsx(Z,{className:"w-5 h-5"}),"Profile Picture"]}),d.jsx(xt,{currentAvatarUrl:e.profile.avatar_url,onAvatarUpdate:e=>{t(t=>t?l(a({},t),{profile:l(a({},t.profile),{avatar_url:e})}):null)},size:"lg"})]}),d.jsxs("div",{children:[d.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[d.jsx(ie,{className:"w-5 h-5"}),"Basic Information"]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"display-name",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Display Name"}),d.jsx("input",{id:"display-name",type:"text",value:f.display_name||"",onChange:e=>y(t=>l(a({},t),{display_name:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all duration-200",placeholder:"Your display name"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Phone Number"}),d.jsxs("div",{className:"relative",children:[d.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),d.jsx("input",{type:"tel",value:f.phone||"",onChange:e=>y(t=>l(a({},t),{phone:e.target.value})),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all duration-200",placeholder:"+1 (555) 000-0000"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Job Title"}),d.jsxs("div",{className:"relative",children:[d.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),d.jsx("input",{type:"text",value:f.job_title||"",onChange:e=>y(t=>l(a({},t),{job_title:e.target.value})),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all duration-200",placeholder:"Software Engineer"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Department"}),d.jsxs("div",{className:"relative",children:[d.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),d.jsx("input",{type:"text",value:f.department||"",onChange:e=>y(t=>l(a({},t),{department:e.target.value})),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all duration-200",placeholder:"Engineering"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Location"}),d.jsxs("div",{className:"relative",children:[d.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),d.jsx("input",{type:"text",value:f.location||"",onChange:e=>y(t=>l(a({},t),{location:e.target.value})),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all duration-200",placeholder:"London, UK"})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Timezone"}),d.jsxs("div",{className:"relative",children:[d.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),d.jsxs("select",{value:f.timezone||"UTC",onChange:e=>y(t=>l(a({},t),{timezone:e.target.value})),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all duration-200",children:[d.jsx("option",{value:"UTC",children:"UTC"}),d.jsx("option",{value:"Europe/London",children:"London (GMT)"}),d.jsx("option",{value:"Europe/Paris",children:"Paris (CET)"}),d.jsx("option",{value:"Africa/Algiers",children:"Algiers (CET)"}),d.jsx("option",{value:"Europe/Lisbon",children:"Lisbon (WET)"})]})]})]})]}),d.jsxs("div",{className:"mt-6",children:[d.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Bio"}),d.jsx("textarea",{value:f.bio||"",onChange:e=>y(t=>l(a({},t),{bio:e.target.value})),rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all duration-200",placeholder:"Tell us about yourself..."})]})]}),d.jsxs("div",{children:[d.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[d.jsx(ce,{className:"w-5 h-5"}),"App Settings"]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Language"}),d.jsxs("div",{className:"relative",children:[d.jsx(ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),d.jsxs("select",{value:f.language||"en",onChange:e=>y(t=>l(a({},t),{language:e.target.value})),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all duration-200",children:[d.jsx("option",{value:"en",children:"English"}),d.jsx("option",{value:"fr",children:"Fran√ßais"}),d.jsx("option",{value:"ar",children:"ÿßŸÑÿπÿ±ÿ®Ÿäÿ©"}),d.jsx("option",{value:"es",children:"Espa√±ol"}),d.jsx("option",{value:"pt",children:"Portugu√™s"})]})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Theme"}),d.jsxs("div",{className:"relative",children:[d.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),d.jsxs("select",{value:f.theme||"light",onChange:e=>y(t=>l(a({},t),{theme:e.target.value})),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all duration-200",children:[d.jsx("option",{value:"light",children:"Light"}),d.jsx("option",{value:"dark",children:"Dark"}),d.jsx("option",{value:"auto",children:"Auto"})]})]})]})]})]}),d.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-200",children:[d.jsxs("button",{onClick:()=>{e&&(y({display_name:e.profile.display_name||"",bio:e.profile.bio||"",phone:e.profile.phone||"",department:e.profile.department||"",job_title:e.profile.job_title||"",location:e.profile.location||"",timezone:e.profile.timezone,language:e.profile.language,theme:e.profile.theme}),b({notification_email:e.preferences.notification_email,notification_push:e.preferences.notification_push,notification_desktop:e.preferences.notification_desktop,notification_sound:e.preferences.notification_sound,auto_refresh:e.preferences.auto_refresh,compact_view:e.preferences.compact_view,sidebar_collapsed:e.preferences.sidebar_collapsed}),m(null))},disabled:!h||n,className:"px-4 py-2 text-gray-600 hover:text-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2 text-sm font-medium",children:[d.jsx(M,{className:"h-4 w-4"}),"Reset Changes"]}),d.jsxs("div",{className:"flex items-center gap-3",children:[h&&d.jsx("span",{className:"text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded font-medium",children:"Unsaved changes"}),d.jsx("button",{onClick:()=>u(null,null,function*(){if(e){o(!0);try{m(null);const r={};if(Object.keys(f).forEach(t=>{const s=t;f[s]!==e.profile[s]&&(r[s]=f[s])}),0===Object.keys(r).length)return void ye.success("No changes to save");const s=yield vt.updateProfile(r);t(e=>e?l(a({},e),{profile:s}):null),ye.success("Profile updated successfully!")}catch(r){console.error("Error updating profile:",r),m("Failed to update profile"),ye.error("Failed to update profile")}finally{o(!1)}}}),disabled:!h||n,className:"px-6 py-2.5 bg-primary text-white rounded-lg hover:bg-primary-dark focus:ring-2 focus:ring-primary/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2 font-medium text-sm shadow-sm",children:n?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):d.jsxs(d.Fragment,{children:[d.jsx(he,{className:"h-4 w-4"}),"Save Changes"]})})]})]})]}),"preferences"===i&&d.jsxs("div",{className:"space-y-8",children:[d.jsxs("div",{children:[d.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[d.jsx(ne,{className:"w-5 h-5"}),"General Preferences"]}),d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:d.jsx(M,{className:"w-5 h-5 text-blue-600"})}),d.jsxs("div",{children:[d.jsx("label",{className:"text-sm font-semibold text-gray-900",children:"Auto Refresh"}),d.jsx("p",{className:"text-sm text-gray-500",children:"Automatically refresh data in real-time"})]})]}),d.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:x.auto_refresh||!1,onChange:e=>b(t=>l(a({},t),{auto_refresh:e.target.checked})),className:"sr-only peer"}),d.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"})]})]}),d.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:d.jsx(pe,{className:"w-5 h-5 text-green-600"})}),d.jsxs("div",{children:[d.jsx("label",{className:"text-sm font-semibold text-gray-900",children:"Compact View"}),d.jsx("p",{className:"text-sm text-gray-500",children:"Use compact layout for lists and tables"})]})]}),d.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:x.compact_view||!1,onChange:e=>b(t=>l(a({},t),{compact_view:e.target.checked})),className:"sr-only peer"}),d.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"})]})]}),d.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:d.jsx(ge,{className:"w-5 h-5 text-purple-600"})}),d.jsxs("div",{children:[d.jsx("label",{className:"text-sm font-semibold text-gray-900",children:"Collapsed Sidebar"}),d.jsx("p",{className:"text-sm text-gray-500",children:"Keep sidebar collapsed by default"})]})]}),d.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:x.sidebar_collapsed||!1,onChange:e=>b(t=>l(a({},t),{sidebar_collapsed:e.target.checked})),className:"sr-only peer"}),d.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"})]})]})]})]}),d.jsx("div",{className:"flex justify-end pt-6 border-t border-gray-200",children:d.jsx("button",{onClick:()=>u(null,null,function*(){if(e){o(!0);try{m(null);const r={};if(Object.keys(x).forEach(t=>{const s=t;x[s]!==e.preferences[s]&&(r[s]=x[s])}),0===Object.keys(r).length)return void ye.success("No changes to save");const s=yield vt.updatePreferences(r);t(e=>e?l(a({},e),{preferences:s}):null),ye.success("Preferences updated successfully!")}catch(r){console.error("Error updating preferences:",r),m("Failed to update preferences"),ye.error("Failed to update preferences")}finally{o(!1)}}}),disabled:!h||n,className:"px-6 py-2.5 bg-primary text-white rounded-lg hover:bg-primary-dark focus:ring-2 focus:ring-primary/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2 font-medium text-sm shadow-sm",children:n?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):d.jsxs(d.Fragment,{children:[d.jsx(he,{className:"h-4 w-4"}),"Save Preferences"]})})})]}),"notifications"===i&&d.jsx("div",{className:"space-y-8",children:d.jsxs("div",{children:[d.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[d.jsx(oe,{className:"w-5 h-5"}),"Notification Settings"]}),d.jsx("div",{className:"space-y-6",children:e.notification_preferences.map(e=>d.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 bg-gray-50",children:[d.jsxs("h4",{className:"text-base font-semibold text-gray-900 mb-4 capitalize flex items-center gap-2",children:[d.jsx(oe,{className:"w-4 h-4"}),e.category," Notifications"]}),d.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[d.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(B,{className:"w-4 h-4 text-gray-500"}),d.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Email"})]}),d.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:e.email_enabled,onChange:t=>w(e.category,"email_enabled",t.target.checked),className:"sr-only peer"}),d.jsx("div",{className:"w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-primary"})]})]}),d.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(me,{className:"w-4 h-4 text-gray-500"}),d.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Push"})]}),d.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:e.push_enabled,onChange:t=>w(e.category,"push_enabled",t.target.checked),className:"sr-only peer"}),d.jsx("div",{className:"w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-primary"})]})]}),d.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(de,{className:"w-4 h-4 text-gray-500"}),d.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Desktop"})]}),d.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:e.desktop_enabled,onChange:t=>w(e.category,"desktop_enabled",t.target.checked),className:"sr-only peer"}),d.jsx("div",{className:"w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-primary"})]})]}),d.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(fe,{className:"w-4 h-4 text-gray-500"}),d.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Sound"})]}),d.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:e.sound_enabled,onChange:t=>w(e.category,"sound_enabled",t.target.checked),className:"sr-only peer"}),d.jsx("div",{className:"w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-primary"})]})]})]})]},e.category))})]})})]})})]})})},St=()=>d.jsxs("div",{className:"p-6",children:[d.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Properties"}),d.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[d.jsx("p",{className:"text-gray-500",children:"Property management and listing details will appear here."}),d.jsx("div",{className:"mt-4 p-4 bg-yellow-50 text-yellow-800 rounded-md",children:"üöß This feature is currently under development."})]})]}),wt=()=>d.jsxs("div",{className:"p-6",children:[d.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Reservations"}),d.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[d.jsx("p",{className:"text-gray-500",children:"Reservation calendar and booking details will appear here."}),d.jsx("div",{className:"mt-4 p-4 bg-yellow-50 text-yellow-800 rounded-md",children:"üöß This feature is currently under development."})]})]}),kt=()=>d.jsxs("div",{className:"p-6",children:[d.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Cleaning Assignments"}),d.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[d.jsx("p",{className:"text-gray-500",children:"Cleaning assignments and reports will appear here."}),d.jsx("div",{className:"mt-4 p-4 bg-yellow-50 text-yellow-800 rounded-md",children:"üöß This feature is currently under development."})]})]}),_t=({children:e})=>{const{isLoading:t,modules:r,permissions:s,refreshData:n}=(()=>{const e=v.useContext(We);if(!e)throw new Error("useAppContext must be used within AppProvider");return e})(),o="initializing"===Be().status,[i,a]=v.useState(!0),[l,c]=v.useState(!1),[u,h]=v.useState(!1),p=s.length>0||r.size>0;v.useEffect(()=>{const e=setTimeout(()=>{i&&!p&&(console.warn("[AppLoadingGate] Loading timeout after 5s, forcing display"),h(!0),n(!1).catch(e=>{console.error("[AppLoadingGate] Failed to refresh on timeout:",e)}))},5e3);return()=>clearTimeout(e)},[i,p,n]),v.useEffect(()=>{!p&&!u||l||(console.log("[AppLoadingGate] Initial load complete - has essential data or timeout"),c(!0),setTimeout(()=>{a(!1)},300))},[p,l,u]);const g=i&&!u&&(o||t&&!p);return v.useEffect(()=>{console.log("[AppLoadingGate] Loading state:",{authLoading:o,appLoading:t,hasEssentialData:p,isInitialLoad:i,hasLoadedOnce:l,shouldShowLoading:g,modulesCount:r.size,permissionsCount:s.length})},[o,t,p,i,l,g,r.size,s.length]),d.jsx(d.Fragment,{children:e})},Nt=v.createContext(void 0),Ct=({children:e})=>{const[t,r]=v.useState({open:!1,kind:"info",title:"",subtitle:"",key:0});return d.jsx(Nt.Provider,{value:{showToast:(e,t,s)=>{r({open:!0,kind:e,title:t,subtitle:s,key:Date.now()})},hideToast:()=>{r(e=>l(a({},e),{open:!1}))},toastInfo:t},children:e})},jt=()=>{const{toastInfo:e,hideToast:t}=(()=>{const e=v.useContext(Nt);if(!e)throw new Error("useToast must be used within a ToastProvider");return e})(),[r,s]=v.useState(!1),[n,o]=v.useState(!1);if(v.useEffect(()=>{if(e.open){o(!0),setTimeout(()=>s(!0),10);const e=setTimeout(()=>{s(!1),setTimeout(()=>{o(!1),t()},300)},3e3);return()=>clearTimeout(e)}s(!1),setTimeout(()=>o(!1),300)},[e.open,t]),!n)return null;if("loading"===e.kind)return d.jsxs("div",{className:"fixed top-4 right-4 z-[9999] bg-white border border-gray-200 shadow-lg rounded-xl px-6 py-4 flex items-center gap-4 transition-all duration-300 "+(r?"opacity-100 scale-100":"opacity-0 scale-95"),style:{pointerEvents:r?"auto":"none"},children:[d.jsxs("svg",{className:"animate-spin h-6 w-6 text-primary",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[d.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),d.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),d.jsxs("div",{children:[d.jsx("h5",{className:"text-base font-semibold text-gray-900 m-0",children:e.title}),d.jsx("p",{className:"text-sm text-gray-600 m-0",children:e.subtitle})]})]});const i={success:"bg-green-50 border-green-200 text-green-800",error:"bg-red-50 border-red-200 text-red-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800",info:"bg-blue-50 border-blue-200 text-blue-800"}[e.kind]||"bg-white border-gray-200 text-gray-900";return d.jsxs("div",{className:`fixed top-4 right-4 z-[9999] border shadow-lg rounded-xl px-6 py-4 flex items-start gap-4 transition-all duration-300 ${i} ${r?"opacity-100 scale-100":"opacity-0 scale-95"}`,role:"alert",style:{pointerEvents:r?"auto":"none"},children:[d.jsx("button",{onClick:()=>{s(!1),setTimeout(()=>{o(!1),t()},300)},className:"absolute top-2 right-2 text-gray-400 hover:text-gray-700 p-1 rounded-full focus:outline-none","aria-label":"Close notification",children:d.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),d.jsxs("div",{children:[d.jsx("h5",{className:"text-base font-semibold m-0",children:e.title}),d.jsx("p",{className:"text-sm m-0",children:e.subtitle})]})]})};var It=["added","removed","updated"];function At(e){return It.includes(e)}function Rt(e){return u(this,arguments,function*({queryClient:e,persister:t,buster:r="",dehydrateOptions:s}){const n={buster:r,timestamp:Date.now(),clientState:p(e,s)};yield t.persistClient(n)})}var Pt=e=>{var t=e,{children:r,persistOptions:i,onSuccess:c,onError:p}=t,f=((e,t)=>{var r={};for(var i in e)n.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&s)for(var i of s(e))t.indexOf(i)<0&&o.call(e,i)&&(r[i]=e[i]);return r})(t,["children","persistOptions","onSuccess","onError"]);const[y,x]=v.useState(!0),b=v.useRef({persistOptions:i,onSuccess:c,onError:p}),S=v.useRef(!1);return v.useEffect(()=>{b.current={persistOptions:i,onSuccess:c,onError:p}}),v.useEffect(()=>{const e=l(a({},b.current.persistOptions),{queryClient:f.client});return S.current||(S.current=!0,function(e){return u(this,arguments,function*({queryClient:e,persister:t,maxAge:r=864e5,buster:s="",hydrateOptions:n}){try{const o=yield t.restoreClient();if(o){if(!o.timestamp)return t.removeClient();{const i=Date.now()-o.timestamp>r,a=o.buster!==s;if(i||a)return t.removeClient();h(e,o.clientState,n)}}}catch(o){throw yield t.removeClient(),o}})}(e).then(()=>{var e,t;return null==(t=(e=b.current).onSuccess)?void 0:t.call(e)}).catch(()=>{var e,t;return null==(t=(e=b.current).onError)?void 0:t.call(e)}).finally(()=>{x(!1)})),y?void 0:function(e){const t=e.queryClient.getQueryCache().subscribe(t=>{At(t.type)&&Rt(e)}),r=e.queryClient.getMutationCache().subscribe(t=>{At(t.type)&&Rt(e)});return()=>{t(),r()}}(e)},[f.client,y]),d.jsx(g,l(a({},f),{children:d.jsx(m,{value:y,children:r})}))};function Et(){}function Ot(e,t=100){let r,s=null;return function(...n){r=n,null===s&&(s=f.setTimeout(()=>{e(...r),s=null},t))}}function Tt(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Lt,Dt={exports:{}};const $t=R((Lt||(Lt=1,Dt.exports=function e(t,r,s){function n(i,a){if(!r[i]){if(!t[i]){if(!a&&Tt)return Tt(i);if(o)return o(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[i]={exports:{}};t[i][0].call(c.exports,function(e){return n(t[i][1][e]||e)},c,c.exports,e,t,r,s)}return r[i].exports}for(var o=Tt,i=0;i<s.length;i++)n(s[i]);return n}({1:[function(e,t,r){(function(e){var r,s,n=e.MutationObserver||e.WebKitMutationObserver;if(n){var o=0,i=new n(u),a=e.document.createTextNode("");i.observe(a,{characterData:!0}),r=function(){a.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var l=new e.MessageChannel;l.port1.onmessage=u,r=function(){l.port2.postMessage(0)}}var c=[];function u(){var e,t;s=!0;for(var r=c.length;r;){for(t=c,c=[],e=-1;++e<r;)t[e]();r=c.length}s=!1}t.exports=function(e){1!==c.push(e)||s||r()}}).call(this,"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){var s=e(1);function n(){}var o={},i=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==n&&p(this,e)}function u(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function d(e,t,r){s(function(){var s;try{s=t(r)}catch(n){return o.reject(e,n)}s===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,s)})}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(e,t){var r=!1;function s(t){r||(r=!0,o.reject(e,t))}function n(t){r||(r=!0,o.resolve(e,t))}var i=g(function(){t(n,s)});"error"===i.status&&s(i.value)}function g(e,t){var r={};try{r.value=e(t),r.status="success"}catch(s){r.status="error",r.value=s}return r}t.exports=c,c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===i)return this;var r=new this.constructor(n);return this.state!==l?d(r,this.state===a?e:t,this.outcome):this.queue.push(new u(r,e,t)),r},u.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){o.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},o.resolve=function(e,t){var r=g(h,t);if("error"===r.status)return o.reject(e,r.value);var s=r.value;if(s)p(e,s);else{e.state=a,e.outcome=t;for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callFulfilled(t)}return e},o.reject=function(e,t){e.state=i,e.outcome=t;for(var r=-1,s=e.queue.length;++r<s;)e.queue[r].callRejected(t);return e},c.resolve=function(e){return e instanceof this?e:o.resolve(new this(n),e)},c.reject=function(e){var t=new this(n);return o.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,s=!1;if(!r)return this.resolve([]);for(var i=new Array(r),a=0,l=-1,c=new this(n);++l<r;)u(e[l],l);return c;function u(e,n){t.resolve(e).then(function(e){i[n]=e,++a!==r||s||(s=!0,o.resolve(c,i))},function(e){s||(s=!0,o.reject(c,e))})}},c.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,s=!1;if(!r)return this.resolve([]);for(var i=-1,a=new this(n);++i<r;)l(e[i]);return a;function l(e){t.resolve(e).then(function(e){s||(s=!0,o.resolve(a,e))},function(e){s||(s=!0,o.reject(a,e))})}}},{1:1}],3:[function(e,t,r){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,r){var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function o(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(n){if("TypeError"!==n.name)throw n;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),s=0;s<e.length;s+=1)r.append(e[s]);return r.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var i=Promise;function a(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function l(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function c(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var d="local-forage-detect-blob-support",h=void 0,p={},g=Object.prototype.toString,m="readonly",f="readwrite";function y(e){for(var t=e.length,r=new ArrayBuffer(t),s=new Uint8Array(r),n=0;n<t;n++)s[n]=e.charCodeAt(n);return r}function v(e){return"boolean"==typeof h?i.resolve(h):function(e){return new i(function(t){var r=e.transaction(d,f),s=o([""]);r.objectStore(d).put(s,"key"),r.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},r.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);t(r||!e||parseInt(e[1],10)>=43)}}).catch(function(){return!1})}(e).then(function(e){return h=e})}function x(e){var t=p[e.name],r={};r.promise=new i(function(e,t){r.resolve=e,r.reject=t}),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then(function(){return r.promise}):t.dbReady=r.promise}function b(e){var t=p[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function S(e,t){var r=p[e.name].deferredOperations.pop();if(r)return r.reject(t),r.promise}function w(e,t){return new i(function(r,s){if(p[e.name]=p[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return r(e.db);x(e),e.db.close()}var o=[e.name];t&&o.push(e.version);var i=n.open.apply(n,o);t&&(i.onupgradeneeded=function(t){var r=i.result;try{r.createObjectStore(e.storeName),t.oldVersion<=1&&r.createObjectStore(d)}catch(s){if("ConstraintError"!==s.name)throw s;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),i.onerror=function(e){e.preventDefault(),s(i.error)},i.onsuccess=function(){var t=i.result;t.onversionchange=function(e){e.target.close()},r(t),b(e)}})}function k(e){return w(e,!1)}function _(e){return w(e,!0)}function N(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),s=e.version<e.db.version,n=e.version>e.db.version;if(s&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),n||r){if(r){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function C(e){return o([y(atob(e.data))],{type:e.type})}function j(e){return e&&e.__local_forage_encoded_blob}function I(e){var t=this,r=t._initReady().then(function(){var e=p[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return l(r,e,e),r}function A(e,t,r,s){void 0===s&&(s=1);try{var n=e.db.transaction(e.storeName,t);r(null,n)}catch(o){if(s>0&&(!e.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return i.resolve().then(function(){if(!e.db||"NotFoundError"===o.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),_(e)}).then(function(){return function(e){x(e);for(var t=p[e.name],r=t.forages,s=0;s<r.length;s++){var n=r[s];n._dbInfo.db&&(n._dbInfo.db.close(),n._dbInfo.db=null)}return e.db=null,k(e).then(function(t){return e.db=t,N(e)?_(e):t}).then(function(s){e.db=t.db=s;for(var n=0;n<r.length;n++)r[n]._dbInfo.db=s}).catch(function(t){throw S(e,t),t})}(e).then(function(){A(e,t,r,s-1)})}).catch(r);r(o)}}var R={_driver:"asyncStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var s in e)r[s]=e[s];var n=p[r.name];n||(n={forages:[],db:null,dbReady:null,deferredOperations:[]},p[r.name]=n),n.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=I);var o=[];function a(){return i.resolve()}for(var l=0;l<n.forages.length;l++){var c=n.forages[l];c!==t&&o.push(c._initReady().catch(a))}var u=n.forages.slice(0);return i.all(o).then(function(){return r.db=n.db,k(r)}).then(function(e){return r.db=e,N(r,t._defaultConfig.version)?_(r):e}).then(function(e){r.db=n.db=e,t._dbInfo=r;for(var s=0;s<u.length;s++){var o=u[s];o!==t&&(o._dbInfo.db=r.db,o._dbInfo.version=r.version)}})},_support:function(){try{if(!n||!n.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(r){return!1}}(),iterate:function(e,t){var r=this,s=new i(function(t,s){r.ready().then(function(){A(r._dbInfo,m,function(n,o){if(n)return s(n);try{var i=o.objectStore(r._dbInfo.storeName).openCursor(),a=1;i.onsuccess=function(){var r=i.result;if(r){var s=r.value;j(s)&&(s=C(s));var n=e(s,r.key,a++);void 0!==n?t(n):r.continue()}else t()},i.onerror=function(){s(i.error)}}catch(l){s(l)}})}).catch(s)});return a(s,t),s},getItem:function(e,t){var r=this;e=c(e);var s=new i(function(t,s){r.ready().then(function(){A(r._dbInfo,m,function(n,o){if(n)return s(n);try{var i=o.objectStore(r._dbInfo.storeName).get(e);i.onsuccess=function(){var e=i.result;void 0===e&&(e=null),j(e)&&(e=C(e)),t(e)},i.onerror=function(){s(i.error)}}catch(a){s(a)}})}).catch(s)});return a(s,t),s},setItem:function(e,t,r){var s=this;e=c(e);var n=new i(function(r,n){var o;s.ready().then(function(){return o=s._dbInfo,"[object Blob]"===g.call(t)?v(o.db).then(function(e){return e?t:(r=t,new i(function(e,t){var s=new FileReader;s.onerror=t,s.onloadend=function(t){var s=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:s,type:r.type})},s.readAsBinaryString(r)}));var r}):t}).then(function(t){A(s._dbInfo,f,function(o,i){if(o)return n(o);try{var a=i.objectStore(s._dbInfo.storeName);null===t&&(t=void 0);var l=a.put(t,e);i.oncomplete=function(){void 0===t&&(t=null),r(t)},i.onabort=i.onerror=function(){var e=l.error?l.error:l.transaction.error;n(e)}}catch(c){n(c)}})}).catch(n)});return a(n,r),n},removeItem:function(e,t){var r=this;e=c(e);var s=new i(function(t,s){r.ready().then(function(){A(r._dbInfo,f,function(n,o){if(n)return s(n);try{var i=o.objectStore(r._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){s(i.error)},o.onabort=function(){var e=i.error?i.error:i.transaction.error;s(e)}}catch(a){s(a)}})}).catch(s)});return a(s,t),s},clear:function(e){var t=this,r=new i(function(e,r){t.ready().then(function(){A(t._dbInfo,f,function(s,n){if(s)return r(s);try{var o=n.objectStore(t._dbInfo.storeName).clear();n.oncomplete=function(){e()},n.onabort=n.onerror=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(i){r(i)}})}).catch(r)});return a(r,e),r},length:function(e){var t=this,r=new i(function(e,r){t.ready().then(function(){A(t._dbInfo,m,function(s,n){if(s)return r(s);try{var o=n.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){r(o.error)}}catch(i){r(i)}})}).catch(r)});return a(r,e),r},key:function(e,t){var r=this,s=new i(function(t,s){e<0?t(null):r.ready().then(function(){A(r._dbInfo,m,function(n,o){if(n)return s(n);try{var i=o.objectStore(r._dbInfo.storeName),a=!1,l=i.openKeyCursor();l.onsuccess=function(){var r=l.result;r?0===e||a?t(r.key):(a=!0,r.advance(e)):t(null)},l.onerror=function(){s(l.error)}}catch(c){s(c)}})}).catch(s)});return a(s,t),s},keys:function(e){var t=this,r=new i(function(e,r){t.ready().then(function(){A(t._dbInfo,m,function(s,n){if(s)return r(s);try{var o=n.objectStore(t._dbInfo.storeName).openKeyCursor(),i=[];o.onsuccess=function(){var t=o.result;t?(i.push(t.key),t.continue()):e(i)},o.onerror=function(){r(o.error)}}catch(a){r(a)}})}).catch(r)});return a(r,e),r},dropInstance:function(e,t){t=u.apply(this,arguments);var r,s=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||s.name,e.storeName=e.storeName||s.storeName),e.name){var o=e.name===s.name&&this._dbInfo.db?i.resolve(this._dbInfo.db):k(e).then(function(t){var r=p[e.name],s=r.forages;r.db=t;for(var n=0;n<s.length;n++)s[n]._dbInfo.db=t;return t});r=e.storeName?o.then(function(t){if(t.objectStoreNames.contains(e.storeName)){var r=t.version+1;x(e);var s=p[e.name],o=s.forages;t.close();for(var a=0;a<o.length;a++){var l=o[a];l._dbInfo.db=null,l._dbInfo.version=r}return new i(function(t,s){var o=n.open(e.name,r);o.onerror=function(e){o.result.close(),s(e)},o.onupgradeneeded=function(){o.result.deleteObjectStore(e.storeName)},o.onsuccess=function(){var e=o.result;e.close(),t(e)}}).then(function(e){s.db=e;for(var t=0;t<o.length;t++){var r=o[t];r._dbInfo.db=e,b(r._dbInfo)}}).catch(function(t){throw(S(e,t)||i.resolve()).catch(function(){}),t})}}):o.then(function(t){x(e);var r=p[e.name],s=r.forages;t.close();for(var o=0;o<s.length;o++)s[o]._dbInfo.db=null;return new i(function(t,r){var s=n.deleteDatabase(e.name);s.onerror=function(){var e=s.result;e&&e.close(),r(s.error)},s.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},s.onsuccess=function(){var e=s.result;e&&e.close(),t(e)}}).then(function(e){r.db=e;for(var t=0;t<s.length;t++)b(s[t]._dbInfo)}).catch(function(t){throw(S(e,t)||i.resolve()).catch(function(){}),t})})}else r=i.reject("Invalid arguments");return a(r,t),r}};var P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",E=/^~~local_forage_type~([^~]+)~/,O="__lfsc__:",T="arbf",L="blob",D="si08",$="ui08",M="uic8",q="si16",F="si32",U="ur16",z="ui32",V="fl32",H="fl64",B=Object.prototype.toString;function J(e){var t,r,s,n,o,i=.75*e.length,a=e.length,l=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var c=new ArrayBuffer(i),u=new Uint8Array(c);for(t=0;t<a;t+=4)r=P.indexOf(e[t]),s=P.indexOf(e[t+1]),n=P.indexOf(e[t+2]),o=P.indexOf(e[t+3]),u[l++]=r<<2|s>>4,u[l++]=(15&s)<<4|n>>2,u[l++]=(3&n)<<6|63&o;return c}function W(e){var t,r=new Uint8Array(e),s="";for(t=0;t<r.length;t+=3)s+=P[r[t]>>2],s+=P[(3&r[t])<<4|r[t+1]>>4],s+=P[(15&r[t+1])<<2|r[t+2]>>6],s+=P[63&r[t+2]];return r.length%3==2?s=s.substring(0,s.length-1)+"=":r.length%3==1&&(s=s.substring(0,s.length-2)+"=="),s}var K={serialize:function(e,t){var r="";if(e&&(r=B.call(e)),e&&("[object ArrayBuffer]"===r||e.buffer&&"[object ArrayBuffer]"===B.call(e.buffer))){var s,n=O;e instanceof ArrayBuffer?(s=e,n+=T):(s=e.buffer,"[object Int8Array]"===r?n+=D:"[object Uint8Array]"===r?n+=$:"[object Uint8ClampedArray]"===r?n+=M:"[object Int16Array]"===r?n+=q:"[object Uint16Array]"===r?n+=U:"[object Int32Array]"===r?n+=F:"[object Uint32Array]"===r?n+=z:"[object Float32Array]"===r?n+=V:"[object Float64Array]"===r?n+=H:t(new Error("Failed to get type for BinaryArray"))),t(n+W(s))}else if("[object Blob]"===r){var o=new FileReader;o.onload=function(){var r="~~local_forage_type~"+e.type+"~"+W(this.result);t(O+L+r)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(i){console.error("Couldn't convert value into a JSON string: ",e),t(null,i)}},deserialize:function(e){if(e.substring(0,9)!==O)return JSON.parse(e);var t,r=e.substring(13),s=e.substring(9,13);if(s===L&&E.test(r)){var n=r.match(E);t=n[1],r=r.substring(n[0].length)}var i=J(r);switch(s){case T:return i;case L:return o([i],{type:t});case D:return new Int8Array(i);case $:return new Uint8Array(i);case M:return new Uint8ClampedArray(i);case q:return new Int16Array(i);case U:return new Uint16Array(i);case F:return new Int32Array(i);case z:return new Uint32Array(i);case V:return new Float32Array(i);case H:return new Float64Array(i);default:throw new Error("Unkown type: "+s)}},stringToBuffer:J,bufferToString:W};function G(e,t,r,s){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],r,s)}function Y(e,t,r,s,n,o){e.executeSql(r,s,n,function(e,i){i.code===i.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],function(e,a){a.rows.length?o(e,i):G(e,t,function(){e.executeSql(r,s,n,o)},o)},o):o(e,i)},o)}function Q(e,t,r,s){var n=this;e=c(e);var o=new i(function(o,i){n.ready().then(function(){void 0===t&&(t=null);var a=t,l=n._dbInfo;l.serializer.serialize(t,function(t,c){c?i(c):l.db.transaction(function(r){Y(r,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[e,t],function(){o(a)},function(e,t){i(t)})},function(t){if(t.code===t.QUOTA_ERR){if(s>0)return void o(Q.apply(n,[e,a,r,s-1]));i(t)}})})}).catch(i)});return a(o,r),o}var X={_driver:"webSQLStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var s in e)r[s]="string"!=typeof e[s]?e[s].toString():e[s];var n=new i(function(e,s){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(n){return s(n)}r.db.transaction(function(n){G(n,r,function(){t._dbInfo=r,e()},function(e,t){s(t)})},s)});return r.serializer=K,n},_support:"function"==typeof openDatabase,iterate:function(e,t){var r=this,s=new i(function(t,s){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(r){Y(r,n,"SELECT * FROM "+n.storeName,[],function(r,s){for(var o=s.rows,i=o.length,a=0;a<i;a++){var l=o.item(a),c=l.value;if(c&&(c=n.serializer.deserialize(c)),void 0!==(c=e(c,l.key,a+1)))return void t(c)}t()},function(e,t){s(t)})})}).catch(s)});return a(s,t),s},getItem:function(e,t){var r=this;e=c(e);var s=new i(function(t,s){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(r){Y(r,n,"SELECT * FROM "+n.storeName+" WHERE key = ? LIMIT 1",[e],function(e,r){var s=r.rows.length?r.rows.item(0).value:null;s&&(s=n.serializer.deserialize(s)),t(s)},function(e,t){s(t)})})}).catch(s)});return a(s,t),s},setItem:function(e,t,r){return Q.apply(this,[e,t,r,1])},removeItem:function(e,t){var r=this;e=c(e);var s=new i(function(t,s){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(r){Y(r,n,"DELETE FROM "+n.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){s(t)})})}).catch(s)});return a(s,t),s},clear:function(e){var t=this,r=new i(function(e,r){t.ready().then(function(){var s=t._dbInfo;s.db.transaction(function(t){Y(t,s,"DELETE FROM "+s.storeName,[],function(){e()},function(e,t){r(t)})})}).catch(r)});return a(r,e),r},length:function(e){var t=this,r=new i(function(e,r){t.ready().then(function(){var s=t._dbInfo;s.db.transaction(function(t){Y(t,s,"SELECT COUNT(key) as c FROM "+s.storeName,[],function(t,r){var s=r.rows.item(0).c;e(s)},function(e,t){r(t)})})}).catch(r)});return a(r,e),r},key:function(e,t){var r=this,s=new i(function(t,s){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(r){Y(r,n,"SELECT key FROM "+n.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,r){var s=r.rows.length?r.rows.item(0).key:null;t(s)},function(e,t){s(t)})})}).catch(s)});return a(s,t),s},keys:function(e){var t=this,r=new i(function(e,r){t.ready().then(function(){var s=t._dbInfo;s.db.transaction(function(t){Y(t,s,"SELECT key FROM "+s.storeName,[],function(t,r){for(var s=[],n=0;n<r.rows.length;n++)s.push(r.rows.item(n).key);e(s)},function(e,t){r(t)})})}).catch(r)});return a(r,e),r},dropInstance:function(e,t){t=u.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var s,n=this;return a(s=e.name?new i(function(t){var s;s=e.name===r.name?n._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:s,storeNames:[e.storeName]}):t(function(e){return new i(function(t,r){e.transaction(function(s){s.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(r,s){for(var n=[],o=0;o<s.rows.length;o++)n.push(s.rows.item(o).name);t({db:e,storeNames:n})},function(e,t){r(t)})},function(e){r(e)})})}(s))}).then(function(e){return new i(function(t,r){e.db.transaction(function(s){function n(e){return new i(function(t,r){s.executeSql("DROP TABLE IF EXISTS "+e,[],function(){t()},function(e,t){r(t)})})}for(var o=[],a=0,l=e.storeNames.length;a<l;a++)o.push(n(e.storeNames[a]));i.all(o).then(function(){t()}).catch(function(e){r(e)})},function(e){r(e)})})}):i.reject("Invalid arguments"),t),s}};function Z(e,t){var r=e.name+"/";return e.storeName!==t.storeName&&(r+=e.storeName+"/"),r}function ee(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(t){return!0}}()||localStorage.length>0}var te={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var r in e)t[r]=e[r];return t.keyPrefix=Z(e,this._defaultConfig),ee()?(this._dbInfo=t,t.serializer=K,i.resolve()):i.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var r=this,s=r.ready().then(function(){for(var t=r._dbInfo,s=t.keyPrefix,n=s.length,o=localStorage.length,i=1,a=0;a<o;a++){var l=localStorage.key(a);if(0===l.indexOf(s)){var c=localStorage.getItem(l);if(c&&(c=t.serializer.deserialize(c)),void 0!==(c=e(c,l.substring(n),i++)))return c}}});return a(s,t),s},getItem:function(e,t){var r=this;e=c(e);var s=r.ready().then(function(){var t=r._dbInfo,s=localStorage.getItem(t.keyPrefix+e);return s&&(s=t.serializer.deserialize(s)),s});return a(s,t),s},setItem:function(e,t,r){var s=this;e=c(e);var n=s.ready().then(function(){void 0===t&&(t=null);var r=t;return new i(function(n,o){var i=s._dbInfo;i.serializer.serialize(t,function(t,s){if(s)o(s);else try{localStorage.setItem(i.keyPrefix+e,t),n(r)}catch(a){"QuotaExceededError"!==a.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==a.name||o(a),o(a)}})})});return a(n,r),n},removeItem:function(e,t){var r=this;e=c(e);var s=r.ready().then(function(){var t=r._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return a(s,t),s},clear:function(e){var t=this,r=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,r=localStorage.length-1;r>=0;r--){var s=localStorage.key(r);0===s.indexOf(e)&&localStorage.removeItem(s)}});return a(r,e),r},length:function(e){var t=this.keys().then(function(e){return e.length});return a(t,e),t},key:function(e,t){var r=this,s=r.ready().then(function(){var t,s=r._dbInfo;try{t=localStorage.key(e)}catch(n){t=null}return t&&(t=t.substring(s.keyPrefix.length)),t});return a(s,t),s},keys:function(e){var t=this,r=t.ready().then(function(){for(var e=t._dbInfo,r=localStorage.length,s=[],n=0;n<r;n++){var o=localStorage.key(n);0===o.indexOf(e.keyPrefix)&&s.push(o.substring(e.keyPrefix.length))}return s});return a(r,e),r},dropInstance:function(e,t){if(t=u.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var r=this.config();e.name=e.name||r.name,e.storeName=e.storeName||r.storeName}var s,n=this;return a(s=e.name?new i(function(t){e.storeName?t(Z(e,n._defaultConfig)):t(e.name+"/")}).then(function(e){for(var t=localStorage.length-1;t>=0;t--){var r=localStorage.key(t);0===r.indexOf(e)&&localStorage.removeItem(r)}}):i.reject("Invalid arguments"),t),s}},re=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},se=function(e,t){for(var r=e.length,s=0;s<r;){if(re(e[s],t))return!0;s++}return!1},ne=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},oe={},ie={},ae={INDEXEDDB:R,WEBSQL:X,LOCALSTORAGE:te},le=[ae.INDEXEDDB._driver,ae.WEBSQL._driver,ae.LOCALSTORAGE._driver],ce=["dropInstance"],ue=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ce),de={description:"",driver:le.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function he(e,t){e[t]=function(){var r=arguments;return e.ready().then(function(){return e[t].apply(e,r)})}}function pe(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var r in t)t.hasOwnProperty(r)&&(ne(t[r])?arguments[0][r]=t[r].slice():arguments[0][r]=t[r])}return arguments[0]}var ge=function(){function e(t){for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ae)if(ae.hasOwnProperty(r)){var s=ae[r],n=s._driver;this[r]=n,oe[n]||this.defineDriver(s)}this._defaultConfig=pe({},de),this._config=pe({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":s(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,r){var s=new i(function(t,r){try{var s=e._driver,n=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void r(n);for(var o=ue.concat("_initStorage"),l=0,c=o.length;l<c;l++){var u=o[l];if((!se(ce,u)||e[u])&&"function"!=typeof e[u])return void r(n)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),r=i.reject(t);return a(r,arguments[arguments.length-1]),r}},r=0,s=ce.length;r<s;r++){var n=ce[r];e[n]||(e[n]=t(n))}}();var d=function(r){oe[s]&&console.info("Redefining LocalForage driver: "+s),oe[s]=e,ie[s]=r,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(d,r):d(!!e._support):d(!0)}catch(h){r(h)}});return l(s,t,r),s},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,r){var s=oe[e]?i.resolve(oe[e]):i.reject(new Error("Driver not found."));return l(s,t,r),s},e.prototype.getSerializer=function(e){var t=i.resolve(K);return l(t,e),t},e.prototype.ready=function(e){var t=this,r=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return l(r,e,e),r},e.prototype.setDriver=function(e,t,r){var s=this;ne(e)||(e=[e]);var n=this._getSupportedDrivers(e);function o(){s._config.driver=s.driver()}function a(e){return s._extend(e),o(),s._ready=s._initStorage(s._config),s._ready}var c=null!==this._driverSet?this._driverSet.catch(function(){return i.resolve()}):i.resolve();return this._driverSet=c.then(function(){var e=n[0];return s._dbInfo=null,s._ready=null,s.getDriver(e).then(function(e){var t;s._driver=e._driver,o(),s._wrapLibraryMethodsWithReady(),s._initDriver=(t=n,function(){var e=0;return function r(){for(;e<t.length;){var n=t[e];return e++,s._dbInfo=null,s._ready=null,s.getDriver(n).then(a).catch(r)}o();var l=new Error("No available storage method found.");return s._driverSet=i.reject(l),s._driverSet}()})})}).catch(function(){o();var e=new Error("No available storage method found.");return s._driverSet=i.reject(e),s._driverSet}),l(this._driverSet,t,r),this._driverSet},e.prototype.supports=function(e){return!!ie[e]},e.prototype._extend=function(e){pe(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],r=0,s=e.length;r<s;r++){var n=e[r];this.supports(n)&&t.push(n)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=ue.length;e<t;e++)he(this,ue[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),me=new ge;t.exports=me},{3:3}]},{},[4])(4)),Dt.exports)),Mt=v.createContext({isCollapsed:!1,setIsCollapsed:()=>{},isMobileOpen:!1,setIsMobileOpen:()=>{},submenuOpen:null,setSubmenuOpen:()=>{}}),qt=()=>v.useContext(Mt)||{isCollapsed:!1,setIsCollapsed:()=>{},isMobileOpen:!1,setIsMobileOpen:()=>{},submenuOpen:null,setSubmenuOpen:()=>{}},Ft=new y({defaultOptions:{queries:{gcTime:864e5,staleTime:3e5,refetchOnWindowFocus:!0,refetchOnMount:!0,retry:1}}}),Ut=function({storage:e,key:t="REACT_QUERY_OFFLINE_CACHE",throttleTime:r=1e3,serialize:s=JSON.stringify,deserialize:n=JSON.parse,retry:o}){if(e){const i=r=>{try{return void e.setItem(t,s(r))}catch(n){return n}};return{persistClient:Ot(e=>{let t=e,r=i(t),s=0;for(;r&&t;)s++,t=null==o?void 0:o({persistedClient:t,error:r,errorCount:s}),t&&(r=i(t))},r),restoreClient:()=>{const r=e.getItem(t);if(r)return n(r)},removeClient:()=>{e.removeItem(t)}}}return{persistClient:Et,restoreClient:Et,removeClient:Et}}({storage:$t});function zt(){return v.useEffect(()=>{try{(()=>{const e=localStorage.getItem("sb-auth-token");if(e)try{const t=JSON.parse(e);t.expires_at&&new Date(1e3*t.expires_at)<new Date&&(localStorage.removeItem("sb-auth-token"),console.log("Cleared expired auth token"))}catch(t){localStorage.removeItem("sb-auth-token"),console.log("Cleared malformed auth token")}})();const e=(console.warn("[LocalStorageManager] DEPRECATED: getStorageInfo() - Use storageManager.getDiagnostics() instead"),nt.getInstance().getStorageInfo());console.log("LocalStorage initialized:",e)}catch(e){console.error("Failed to initialize localStorage:",e),confirm("LocalStorage appears to be corrupted. Would you like to clear it and reload the app?")&&(localStorage.clear(),window.location.reload())}},[]),d.jsx(ot,{children:d.jsx(it,{maxRetries:3,retryDelay:1e3,enableOfflineSupport:!0,enableMemoryMonitoring:!0,resetOnPropsChange:!0,children:d.jsx(C,{children:d.jsx(Je,{children:d.jsx(Ge,{children:d.jsx(Ct,{children:d.jsxs(Pt,{client:Ft,persistOptions:{persister:Ut,maxAge:864e5,buster:""},children:[d.jsx(Vt,{}),d.jsx(jt,{})]})})})})})})})}function Vt(){const[e,t]=v.useState(()=>"true"===localStorage.getItem("sidebarCollapsed")),[r,s]=v.useState(!1),[n,o]=v.useState(null);return v.useEffect(()=>{localStorage.setItem("sidebarCollapsed",e.toString())},[e]),d.jsx(Mt.Provider,{value:{isCollapsed:e,setIsCollapsed:t,isMobileOpen:r,setIsMobileOpen:s,submenuOpen:n,setSubmenuOpen:o},children:d.jsxs(_t,{children:[d.jsxs(j,{children:[d.jsx(I,{path:"/login",element:d.jsx(Qe,{children:d.jsx(lt,{})})}),d.jsx(I,{path:"/unauthorized",element:d.jsx(ht,{})}),d.jsx(I,{path:"/",element:d.jsx(pt,{})}),d.jsx(I,{path:"/*",element:d.jsx(Ye,{children:d.jsxs("div",{className:"flex h-screen overflow-hidden bg-gray-50",children:[d.jsx(Xe,{}),d.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden",children:[d.jsx(yt,{}),d.jsx("main",{className:"flex-1 overflow-y-auto",children:d.jsxs(j,{children:[d.jsx(I,{path:"/dashboard",element:d.jsx(dt,{})}),d.jsx(I,{path:"/properties",element:d.jsx(St,{})}),d.jsx(I,{path:"/reservations",element:d.jsx(wt,{})}),d.jsx(I,{path:"/cleaning",element:d.jsx(kt,{})}),d.jsx(I,{path:"/profile",element:d.jsx(bt,{})}),d.jsx(I,{path:"*",element:d.jsx(x,{to:"/dashboard",replace:!0})})]})})]})]})})})]}),d.jsx(ve,{position:"top-right"})]})})}function Ht(){return d.jsx(zt,{})}const Bt=e=>"string"==typeof e,Jt=()=>{let e,t;const r=new Promise((r,s)=>{e=r,t=s});return r.resolve=e,r.reject=t,r},Wt=e=>null==e?"":""+e,Kt=/###/g,Gt=e=>e&&e.indexOf("###")>-1?e.replace(Kt,"."):e,Yt=e=>!e||Bt(e),Qt=(e,t,r)=>{const s=Bt(t)?t.split("."):t;let n=0;for(;n<s.length-1;){if(Yt(e))return{};const t=Gt(s[n]);!e[t]&&r&&(e[t]=new r),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++n}return Yt(e)?{}:{obj:e,k:Gt(s[n])}},Xt=(e,t,r)=>{const{obj:s,k:n}=Qt(e,t,Object);if(void 0!==s||1===t.length)return void(s[n]=r);let o=t[t.length-1],i=t.slice(0,t.length-1),a=Qt(e,i,Object);for(;void 0===a.obj&&i.length;)o=`${i[i.length-1]}.${o}`,i=i.slice(0,i.length-1),a=Qt(e,i,Object),a&&a.obj&&void 0!==a.obj[`${a.k}.${o}`]&&(a.obj=void 0);a.obj[`${a.k}.${o}`]=r},Zt=(e,t)=>{const{obj:r,k:s}=Qt(e,t);if(r)return r[s]},er=(e,t,r)=>{for(const s in t)"__proto__"!==s&&"constructor"!==s&&(s in e?Bt(e[s])||e[s]instanceof String||Bt(t[s])||t[s]instanceof String?r&&(e[s]=t[s]):er(e[s],t[s],r):e[s]=t[s]);return e},tr=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var rr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const sr=e=>Bt(e)?e.replace(/[&<>"'\/]/g,e=>rr[e]):e,nr=[" ",",","?","!",";"],or=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}(20),ir=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(!e)return;if(e[t])return e[t];const s=t.split(r);let n=e;for(let o=0;o<s.length;){if(!n||"object"!=typeof n)return;let e,t="";for(let i=o;i<s.length;++i)if(i!==o&&(t+=r),t+=s[i],e=n[t],void 0!==e){if(["string","number","boolean"].indexOf(typeof e)>-1&&i<s.length-1)continue;o+=i-o+1;break}n=e}return n},ar=e=>e&&e.replace("_","-"),lr={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){console&&console[e]&&console[e].apply(console,t)}};class cr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||lr,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,r,s){return s&&!this.debug?null:(Bt(e[0])&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new cr(this.logger,a(a({},{prefix:`${this.prefix}:${e}:`}),this.options))}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new cr(this.logger,e)}}var ur=new cr;class dr{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);const r=this.observers[e].get(t)||0;this.observers[e].set(t,r+1)}),this}off(e,t){this.observers[e]&&(t?this.observers[e].delete(t):delete this.observers[e])}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(e=>{let[t,s]=e;for(let n=0;n<s;n++)t(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(t=>{let[s,n]=t;for(let o=0;o<n;o++)s.apply(s,[e,...r])})}}class hr extends dr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const n=void 0!==s.keySeparator?s.keySeparator:this.options.keySeparator,o=void 0!==s.ignoreJSONStructure?s.ignoreJSONStructure:this.options.ignoreJSONStructure;let i;e.indexOf(".")>-1?i=e.split("."):(i=[e,t],r&&(Array.isArray(r)?i.push(...r):Bt(r)&&n?i.push(...r.split(n)):i.push(r)));const a=Zt(this.data,i);return!a&&!t&&!r&&e.indexOf(".")>-1&&(e=i[0],t=i[1],r=i.slice(2).join(".")),!a&&o&&Bt(r)?ir(this.data&&this.data[e]&&this.data[e][t],r,n):a}addResource(e,t,r,s){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1};const o=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator;let i=[e,t];r&&(i=i.concat(o?r.split(o):r)),e.indexOf(".")>-1&&(i=e.split("."),s=t,t=i[1]),this.addNamespaces(t),Xt(this.data,i,s),n.silent||this.emit("added",e,t,r,s)}addResources(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(const n in r)(Bt(r[n])||Array.isArray(r[n]))&&this.addResource(e,t,n,r[n],{silent:!0});s.silent||this.emit("added",e,t,r)}addResourceBundle(e,t,r,s,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1,skipCopy:!1},i=[e,t];e.indexOf(".")>-1&&(i=e.split("."),s=r,r=t,t=i[1]),this.addNamespaces(t);let l=Zt(this.data,i)||{};o.skipCopy||(r=JSON.parse(JSON.stringify(r))),s?er(l,r,n):l=a(a({},l),r),Xt(this.data,i,l),o.silent||this.emit("added",e,t,r)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?a(a({},{}),this.getResource(e,t)):this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var pr={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,r,s,n){return e.forEach(e=>{this.processors[e]&&(t=this.processors[e].process(t,r,s,n))}),t}};const gr={};class mr extends dr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r,s;super(),r=e,s=this,["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"].forEach(e=>{r[e]&&(s[e]=r[e])}),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=ur.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;const r=this.resolve(e,t);return r&&void 0!==r.res}extractFromKey(e,t){let r=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===r&&(r=":");const s=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let n=t.ns||this.options.defaultNS||[];const o=r&&e.indexOf(r)>-1,i=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||((e,t,r)=>{t=t||"",r=r||"";const s=nr.filter(e=>t.indexOf(e)<0&&r.indexOf(e)<0);if(0===s.length)return!0;const n=or.getRegExp(`(${s.map(e=>"?"===e?"\\?":e).join("|")})`);let o=!n.test(e);if(!o){const t=e.indexOf(r);t>0&&!n.test(e.substring(0,t))&&(o=!0)}return o})(e,r,s));if(o&&!i){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:Bt(n)?[n]:n};const o=e.split(r);(r!==s||r===s&&this.options.ns.indexOf(o[0])>-1)&&(n=o.shift()),e=o.join(s)}return{key:e,namespaces:Bt(n)?[n]:n}}translate(e,t,r){if("object"!=typeof t&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof t&&(t=a({},t)),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);const s=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,n=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,{key:o,namespaces:i}=this.extractFromKey(e[e.length-1],t),c=i[i.length-1],u=t.lng||this.language,d=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(u&&"cimode"===u.toLowerCase()){if(d){const e=t.nsSeparator||this.options.nsSeparator;return s?{res:`${c}${e}${o}`,usedKey:o,exactUsedKey:o,usedLng:u,usedNS:c,usedParams:this.getUsedParamsDetails(t)}:`${c}${e}${o}`}return s?{res:o,usedKey:o,exactUsedKey:o,usedLng:u,usedNS:c,usedParams:this.getUsedParamsDetails(t)}:o}const h=this.resolve(e,t);let p=h&&h.res;const g=h&&h.usedKey||o,m=h&&h.exactUsedKey||o,f=Object.prototype.toString.apply(p),y=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,v=!this.i18nFormat||this.i18nFormat.handleAsObject,x=!Bt(p)&&"boolean"!=typeof p&&"number"!=typeof p;if(!(v&&p&&x&&["[object Number]","[object Function]","[object RegExp]"].indexOf(f)<0)||Bt(y)&&Array.isArray(p))if(v&&Bt(y)&&Array.isArray(p))p=p.join(y),p&&(p=this.extendTranslation(p,e,t,r));else{let s=!1,i=!1;const d=void 0!==t.count&&!Bt(t.count),g=mr.hasDefaultValue(t),m=d?this.pluralResolver.getSuffix(u,t.count,t):"",f=t.ordinal&&d?this.pluralResolver.getSuffix(u,t.count,{ordinal:!1}):"",y=d&&!t.ordinal&&0===t.count&&this.pluralResolver.shouldUseIntlApi(),v=y&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${m}`]||t[`defaultValue${f}`]||t.defaultValue;!this.isValidLookup(p)&&g&&(s=!0,p=v),this.isValidLookup(p)||(i=!0,p=o);const x=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&i?void 0:p,b=g&&v!==p&&this.options.updateMissing;if(i||s||b){if(this.logger.log(b?"updateKey":"missingKey",u,c,o,b?v:p),n){const e=this.resolve(o,l(a({},t),{keySeparator:!1}));e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const r=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&r&&r[0])for(let t=0;t<r.length;t++)e.push(r[t]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(t.lng||this.language):e.push(t.lng||this.language);const s=(e,r,s)=>{const n=g&&s!==p?s:x;this.options.missingKeyHandler?this.options.missingKeyHandler(e,c,r,n,b,t):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(e,c,r,n,b,t),this.emit("missingKey",e,c,r,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&d?e.forEach(e=>{const r=this.pluralResolver.getSuffixes(e,t);y&&t[`defaultValue${this.options.pluralSeparator}zero`]&&r.indexOf(`${this.options.pluralSeparator}zero`)<0&&r.push(`${this.options.pluralSeparator}zero`),r.forEach(r=>{s([e],o+r,t[`defaultValue${r}`]||v)})}):s(e,o,v))}p=this.extendTranslation(p,e,t,h,r),i&&p===o&&this.options.appendNamespaceToMissingKey&&(p=`${c}:${o}`),(i||s)&&this.options.parseMissingKeyHandler&&(p="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${c}:${o}`:o,s?p:void 0):this.options.parseMissingKeyHandler(p))}else{if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(g,p,l(a({},t),{ns:i})):`key '${o} (${this.language})' returned an object instead of string.`;return s?(h.res=e,h.usedParams=this.getUsedParamsDetails(t),h):e}if(n){const e=Array.isArray(p),r=e?[]:{},s=e?m:g;for(const o in p)if(Object.prototype.hasOwnProperty.call(p,o)){const e=`${s}${n}${o}`;r[o]=this.translate(e,a(a({},t),{joinArrays:!1,ns:i})),r[o]===e&&(r[o]=p[o])}p=r}}return s?(h.res=p,h.usedParams=this.getUsedParamsDetails(t),h):p}extendTranslation(e,t,r,s,n){var o=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,a(a({},this.options.interpolation.defaultVariables),r),r.lng||this.language||s.usedLng,s.usedNS,s.usedKey,{resolved:s});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init(a(a({},r),{interpolation:a(a({},this.options.interpolation),r.interpolation)}));const i=Bt(e)&&(r&&r.interpolation&&void 0!==r.interpolation.skipOnVariables?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let l;if(i){const t=e.match(this.interpolator.nestingRegexp);l=t&&t.length}let c=r.replace&&!Bt(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(c=a(a({},this.options.interpolation.defaultVariables),c)),e=this.interpolator.interpolate(e,c,r.lng||this.language||s.usedLng,r),i){const t=e.match(this.interpolator.nestingRegexp);l<(t&&t.length)&&(r.nest=!1)}!r.lng&&"v1"!==this.options.compatibilityAPI&&s&&s.res&&(r.lng=this.language||s.usedLng),!1!==r.nest&&(e=this.interpolator.nest(e,function(){for(var e=arguments.length,s=new Array(e),i=0;i<e;i++)s[i]=arguments[i];return n&&n[0]===s[0]&&!r.context?(o.logger.warn(`It seems you are nesting recursively key: ${s[0]} in key: ${t[0]}`),null):o.translate(...s,t)},r)),r.interpolation&&this.interpolator.reset()}const i=r.postProcess||this.options.postProcess,c=Bt(i)?[i]:i;return null!=e&&c&&c.length&&!1!==r.applyPostProcessor&&(e=pr.handle(c,e,t,this.options&&this.options.postProcessPassResolved?a({i18nResolved:l(a({},s),{usedParams:this.getUsedParamsDetails(r)})},r):r,this)),e}resolve(e){let t,r,s,n,o,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Bt(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(t))return;const a=this.extractFromKey(e,i),l=a.key;r=l;let c=a.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const u=void 0!==i.count&&!Bt(i.count),d=u&&!i.ordinal&&0===i.count&&this.pluralResolver.shouldUseIntlApi(),h=void 0!==i.context&&(Bt(i.context)||"number"==typeof i.context)&&""!==i.context,p=i.lngs?i.lngs:this.languageUtils.toResolveHierarchy(i.lng||this.language,i.fallbackLng);c.forEach(e=>{this.isValidLookup(t)||(o=e,!gr[`${p[0]}-${e}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(o)&&(gr[`${p[0]}-${e}`]=!0,this.logger.warn(`key "${r}" for languages "${p.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach(r=>{if(this.isValidLookup(t))return;n=r;const o=[l];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(o,l,r,e,i);else{let e;u&&(e=this.pluralResolver.getSuffix(r,i.count,i));const t=`${this.options.pluralSeparator}zero`,s=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(u&&(o.push(l+e),i.ordinal&&0===e.indexOf(s)&&o.push(l+e.replace(s,this.options.pluralSeparator)),d&&o.push(l+t)),h){const r=`${l}${this.options.contextSeparator}${i.context}`;o.push(r),u&&(o.push(r+e),i.ordinal&&0===e.indexOf(s)&&o.push(r+e.replace(s,this.options.pluralSeparator)),d&&o.push(r+t))}}let a;for(;a=o.pop();)this.isValidLookup(t)||(s=a,t=this.getResource(r,e,a,i))}))})}),{res:t,usedKey:r,exactUsedKey:s,usedLng:n,usedNS:o}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,r,s):this.resourceStore.getResource(e,t,r,s)}getUsedParamsDetails(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&!Bt(e.replace);let s=r?e.replace:e;if(r&&void 0!==e.count&&(s.count=e.count),this.options.interpolation.defaultVariables&&(s=a(a({},this.options.interpolation.defaultVariables),s)),!r){s=a({},s);for(const e of t)delete s[e]}return s}static hasDefaultValue(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&"defaultValue"===t.substring(0,12)&&void 0!==e[t])return!0;return!1}}const fr=e=>e.charAt(0).toUpperCase()+e.slice(1);class yr{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=ur.create("languageUtils")}getScriptPartFromCode(e){if(!(e=ar(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}getLanguagePartFromCode(e){if(!(e=ar(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(Bt(e)&&e.indexOf("-")>-1){if("undefined"!=typeof Intl&&void 0!==Intl.getCanonicalLocales)try{let t=Intl.getCanonicalLocales(e)[0];if(t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t)return t}catch(t){}const r=["hans","hant","latn","cyrl","cans","mong","arab"];let s=e.split("-");return this.options.lowerCaseLng?s=s.map(e=>e.toLowerCase()):2===s.length?(s[0]=s[0].toLowerCase(),s[1]=s[1].toUpperCase(),r.indexOf(s[1].toLowerCase())>-1&&(s[1]=fr(s[1].toLowerCase()))):3===s.length&&(s[0]=s[0].toLowerCase(),2===s[1].length&&(s[1]=s[1].toUpperCase()),"sgn"!==s[0]&&2===s[2].length&&(s[2]=s[2].toUpperCase()),r.indexOf(s[1].toLowerCase())>-1&&(s[1]=fr(s[1].toLowerCase())),r.indexOf(s[2].toLowerCase())>-1&&(s[2]=fr(s[2].toLowerCase()))),s.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(e=>{if(t)return;const r=this.formatLanguageCode(e);this.options.supportedLngs&&!this.isSupportedCode(r)||(t=r)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;const r=this.getLanguagePartFromCode(e);if(this.isSupportedCode(r))return t=r;t=this.options.supportedLngs.find(e=>e===r?e:e.indexOf("-")<0&&r.indexOf("-")<0?void 0:e.indexOf("-")>0&&r.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===r||0===e.indexOf(r)&&r.length>1?e:void 0)}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),Bt(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let r=e[t];return r||(r=e[this.getScriptPartFromCode(t)]),r||(r=e[this.formatLanguageCode(t)]),r||(r=e[this.getLanguagePartFromCode(t)]),r||(r=e.default),r||[]}toResolveHierarchy(e,t){const r=this.getFallbackCodes(t||this.options.fallbackLng||[],e),s=[],n=e=>{e&&(this.isSupportedCode(e)?s.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return Bt(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&n(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&n(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&n(this.getLanguagePartFromCode(e))):Bt(e)&&n(this.formatLanguageCode(e)),r.forEach(e=>{s.indexOf(e)<0&&n(this.formatLanguageCode(e))}),s}}let vr=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],xr={1:e=>Number(e>1),2:e=>Number(1!=e),3:e=>0,4:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2),5:e=>Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5),6:e=>Number(1==e?0:e>=2&&e<=4?1:2),7:e=>Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2),8:e=>Number(1==e?0:2==e?1:8!=e&&11!=e?2:3),9:e=>Number(e>=2),10:e=>Number(1==e?0:2==e?1:e<7?2:e<11?3:4),11:e=>Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3),12:e=>Number(e%10!=1||e%100==11),13:e=>Number(0!==e),14:e=>Number(1==e?0:2==e?1:3==e?2:3),15:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2),16:e=>Number(e%10==1&&e%100!=11?0:0!==e?1:2),17:e=>Number(1==e||e%10==1&&e%100!=11?0:1),18:e=>Number(0==e?0:1==e?1:2),19:e=>Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3),20:e=>Number(1==e?0:0==e||e%100>0&&e%100<20?1:2),21:e=>Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0),22:e=>Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)};const br=["v1","v2","v3"],Sr=["v4"],wr={zero:0,one:1,two:2,few:3,many:4,other:5};class kr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=ur.create("pluralResolver"),this.options.compatibilityJSON&&!Sr.includes(this.options.compatibilityJSON)||"undefined"!=typeof Intl&&Intl.PluralRules||(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=(()=>{const e={};return vr.forEach(t=>{t.lngs.forEach(r=>{e[r]={numbers:t.nr,plurals:xr[t.fc]}})}),e})(),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shouldUseIntlApi()){const s=ar("dev"===e?"en":e),n=t.ordinal?"ordinal":"cardinal",o=JSON.stringify({cleanedCode:s,type:n});if(o in this.pluralRulesCache)return this.pluralRulesCache[o];let i;try{i=new Intl.PluralRules(s,{type:n})}catch(r){if(!e.match(/-|_/))return;const s=this.languageUtils.getLanguagePartFromCode(e);i=this.getRule(s,t)}return this.pluralRulesCache[o]=i,i}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=this.getRule(e,t);return this.shouldUseIntlApi()?r&&r.resolvedOptions().pluralCategories.length>1:r&&r.numbers.length>1}getPluralFormsOfKey(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,r).map(e=>`${t}${e}`)}getSuffixes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=this.getRule(e,t);return r?this.shouldUseIntlApi()?r.resolvedOptions().pluralCategories.sort((e,t)=>wr[e]-wr[t]).map(e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`):r.numbers.map(r=>this.getSuffix(e,r,t)):[]}getSuffix(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=this.getRule(e,r);return s?this.shouldUseIntlApi()?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${s.select(t)}`:this.getSuffixRetroCompatible(s,t):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,t){const r=e.noAbs?e.plurals(t):e.plurals(Math.abs(t));let s=e.numbers[r];this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]&&(2===s?s="plural":1===s&&(s=""));const n=()=>this.options.prepend&&s.toString()?this.options.prepend+s.toString():s.toString();return"v1"===this.options.compatibilityJSON?1===s?"":"number"==typeof s?`_plural_${s.toString()}`:n():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]?n():this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString()}shouldUseIntlApi(){return!br.includes(this.options.compatibilityJSON)}}const _r=function(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=((e,t,r)=>{const s=Zt(e,r);return void 0!==s?s:Zt(t,r)})(e,t,r);return!o&&n&&Bt(r)&&(o=ir(e,r,s),void 0===o&&(o=ir(t,r,s))),o},Nr=e=>e.replace(/\$/g,"$$$$");class Cr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=ur.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(e=>e),this.init(e)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:r,useRawValueToEscape:s,prefix:n,prefixEscaped:o,suffix:i,suffixEscaped:a,formatSeparator:l,unescapeSuffix:c,unescapePrefix:u,nestingPrefix:d,nestingPrefixEscaped:h,nestingSuffix:p,nestingSuffixEscaped:g,nestingOptionsSeparator:m,maxReplaces:f,alwaysFormat:y}=e.interpolation;this.escape=void 0!==t?t:sr,this.escapeValue=void 0===r||r,this.useRawValueToEscape=void 0!==s&&s,this.prefix=n?tr(n):o||"{{",this.suffix=i?tr(i):a||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":u||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=d?tr(d):h||tr("$t("),this.nestingSuffix=p?tr(p):g||tr(")"),this.nestingOptionsSeparator=m||",",this.maxReplaces=f||1e3,this.alwaysFormat=void 0!==y&&y,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>e&&e.source===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,r,s){let n,o,i;const c=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},u=e=>{if(e.indexOf(this.formatSeparator)<0){const n=_r(t,c,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(n,void 0,r,l(a(a({},s),t),{interpolationkey:e})):n}const n=e.split(this.formatSeparator),o=n.shift().trim(),i=n.join(this.formatSeparator).trim();return this.format(_r(t,c,o,this.options.keySeparator,this.options.ignoreJSONStructure),i,r,l(a(a({},s),t),{interpolationkey:o}))};this.resetRegExp();const d=s&&s.missingInterpolationHandler||this.options.missingInterpolationHandler,h=s&&s.interpolation&&void 0!==s.interpolation.skipOnVariables?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>Nr(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?Nr(this.escape(e)):Nr(e)}].forEach(t=>{for(i=0;n=t.regex.exec(e);){const r=n[1].trim();if(o=u(r),void 0===o)if("function"==typeof d){const t=d(e,n,s);o=Bt(t)?t:""}else if(s&&Object.prototype.hasOwnProperty.call(s,r))o="";else{if(h){o=n[0];continue}this.logger.warn(`missed to pass in variable ${r} for interpolating ${e}`),o=""}else Bt(o)||this.useRawValueToEscape||(o=Wt(o));const a=t.safeValue(o);if(e=e.replace(n[0],a),h?(t.regex.lastIndex+=o.length,t.regex.lastIndex-=n[0].length):t.regex.lastIndex=0,i++,i>=this.maxReplaces)break}}),e}nest(e,t){let r,s,n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=(e,t)=>{const r=this.nestingOptionsSeparator;if(e.indexOf(r)<0)return e;const s=e.split(new RegExp(`${r}[ ]*{`));let o=`{${s[1]}`;e=s[0],o=this.interpolate(o,n);const i=o.match(/'/g),l=o.match(/"/g);(i&&i.length%2==0&&!l||l.length%2!=0)&&(o=o.replace(/'/g,'"'));try{n=JSON.parse(o),t&&(n=a(a({},t),n))}catch(c){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,c),`${e}${r}${o}`}return n.defaultValue&&n.defaultValue.indexOf(this.prefix)>-1&&delete n.defaultValue,e};for(;r=this.nestingRegexp.exec(e);){let c=[];n=a({},o),n=n.replace&&!Bt(n.replace)?n.replace:n,n.applyPostProcessor=!1,delete n.defaultValue;let u=!1;if(-1!==r[0].indexOf(this.formatSeparator)&&!/{.*}/.test(r[1])){const e=r[1].split(this.formatSeparator).map(e=>e.trim());r[1]=e.shift(),c=e,u=!0}if(s=t(i.call(this,r[1].trim(),n),n),s&&r[0]===e&&!Bt(s))return s;Bt(s)||(s=Wt(s)),s||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),s=""),u&&(s=c.reduce((e,t)=>this.format(e,t,o.lng,l(a({},o),{interpolationkey:r[1].trim()})),s.trim())),e=e.replace(r[0],s),this.regexp.lastIndex=0}return e}}const jr=e=>{const t={};return(r,s,n)=>{let o=n;n&&n.interpolationkey&&n.formatParams&&n.formatParams[n.interpolationkey]&&n[n.interpolationkey]&&(o=l(a({},o),{[n.interpolationkey]:void 0}));const i=s+JSON.stringify(o);let c=t[i];return c||(c=e(ar(s),n),t[i]=c),c(r)}};class Ir{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=ur.create("formatter"),this.options=e,this.formats={number:jr((e,t)=>{const r=new Intl.NumberFormat(e,a({},t));return e=>r.format(e)}),currency:jr((e,t)=>{const r=new Intl.NumberFormat(e,l(a({},t),{style:"currency"}));return e=>r.format(e)}),datetime:jr((e,t)=>{const r=new Intl.DateTimeFormat(e,a({},t));return e=>r.format(e)}),relativetime:jr((e,t)=>{const r=new Intl.RelativeTimeFormat(e,a({},t));return e=>r.format(e,t.range||"day")}),list:jr((e,t)=>{const r=new Intl.ListFormat(e,a({},t));return e=>r.format(e)})},this.init(e)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=jr(t)}format(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const n=t.split(this.formatSeparator);if(n.length>1&&n[0].indexOf("(")>1&&n[0].indexOf(")")<0&&n.find(e=>e.indexOf(")")>-1)){const e=n.findIndex(e=>e.indexOf(")")>-1);n[0]=[n[0],...n.splice(1,e)].join(this.formatSeparator)}return n.reduce((e,t)=>{const{formatName:n,formatOptions:o}=(e=>{let t=e.toLowerCase().trim();const r={};if(e.indexOf("(")>-1){const s=e.split("(");t=s[0].toLowerCase().trim();const n=s[1].substring(0,s[1].length-1);"currency"===t&&n.indexOf(":")<0?r.currency||(r.currency=n.trim()):"relativetime"===t&&n.indexOf(":")<0?r.range||(r.range=n.trim()):n.split(";").forEach(e=>{if(e){const[t,...s]=e.split(":"),n=s.join(":").trim().replace(/^'+|'+$/g,""),o=t.trim();r[o]||(r[o]=n),"false"===n&&(r[o]=!1),"true"===n&&(r[o]=!0),isNaN(n)||(r[o]=parseInt(n,10))}})}return{formatName:t,formatOptions:r}})(t);if(this.formats[n]){let t=e;try{const i=s&&s.formatParams&&s.formatParams[s.interpolationkey]||{},l=i.locale||i.lng||s.locale||s.lng||r;t=this.formats[n](e,l,a(a(a({},o),s),i))}catch(i){this.logger.warn(i)}return t}return this.logger.warn(`there was no format function for ${n}`),e},e)}}class Ar extends dr{constructor(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=r,this.languageUtils=r.languageUtils,this.options=s,this.logger=ur.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=s.maxParallelReads||10,this.readingCalls=0,this.maxRetries=s.maxRetries>=0?s.maxRetries:5,this.retryTimeout=s.retryTimeout>=1?s.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(r,s.backend,s)}queueLoad(e,t,r,s){const n={},o={},i={},a={};return e.forEach(e=>{let s=!0;t.forEach(t=>{const i=`${e}|${t}`;!r.reload&&this.store.hasResourceBundle(e,t)?this.state[i]=2:this.state[i]<0||(1===this.state[i]?void 0===o[i]&&(o[i]=!0):(this.state[i]=1,s=!1,void 0===o[i]&&(o[i]=!0),void 0===n[i]&&(n[i]=!0),void 0===a[t]&&(a[t]=!0)))}),s||(i[e]=!0)}),(Object.keys(n).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:s}),{toLoad:Object.keys(n),pending:Object.keys(o),toLoadLanguages:Object.keys(i),toLoadNamespaces:Object.keys(a)}}loaded(e,t,r){const s=e.split("|"),n=s[0],o=s[1];t&&this.emit("failedLoading",n,o,t),!t&&r&&this.store.addResourceBundle(n,o,r,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&r&&(this.state[e]=0);const i={};this.queue.forEach(r=>{((e,t,r)=>{const{obj:s,k:n}=Qt(e,t,Object);s[n]=s[n]||[],s[n].push(r)})(r.loaded,[n],o),((e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)})(r,e),t&&r.errors.push(t),0!==r.pendingCount||r.done||(Object.keys(r.loaded).forEach(e=>{i[e]||(i[e]={});const t=r.loaded[e];t.length&&t.forEach(t=>{void 0===i[e][t]&&(i[e][t]=!0)})}),r.done=!0,r.errors.length?r.callback(r.errors):r.callback())}),this.emit("loaded",i),this.queue=this.queue.filter(e=>!e.done)}read(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:r,tried:s,wait:n,callback:o});this.readingCalls++;const i=(i,a)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}i&&a&&s<this.maxRetries?setTimeout(()=>{this.read.call(this,e,t,r,s+1,2*n,o)},n):o(i,a)},a=this.backend[r].bind(this.backend);if(2!==a.length)return a(e,t,i);try{const r=a(e,t);r&&"function"==typeof r.then?r.then(e=>i(null,e)).catch(i):i(null,r)}catch(l){i(l)}}prepareLoading(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),s&&s();Bt(e)&&(e=this.languageUtils.toResolveHierarchy(e)),Bt(t)&&(t=[t]);const n=this.queueLoad(e,t,r,s);if(!n.toLoad.length)return n.pending.length||s(),null;n.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,r){this.prepareLoading(e,t,{},r)}reload(e,t,r){this.prepareLoading(e,t,{reload:!0},r)}loadOne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const r=e.split("|"),s=r[0],n=r[1];this.read(s,n,"read",void 0,void 0,(r,o)=>{r&&this.logger.warn(`${t}loading namespace ${n} for language ${s} failed`,r),!r&&o&&this.logger.log(`${t}loaded namespace ${n} for language ${s}`,o),this.loaded(e,r,o)})}saveMissing(e,t,r,s,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t))this.logger.warn(`did not save key "${r}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");else if(null!=r&&""!==r){if(this.backend&&this.backend.create){const u=l(a({},o),{isUpdate:n}),d=this.backend.create.bind(this.backend);if(d.length<6)try{let n;n=5===d.length?d(e,t,r,s,u):d(e,t,r,s),n&&"function"==typeof n.then?n.then(e=>i(null,e)).catch(i):i(null,n)}catch(c){i(c)}else d(e,t,r,s,i,u)}e&&e[0]&&this.store.addResource(e[0],t,r,s)}}}const Rr=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),Bt(e[1])&&(t.defaultValue=e[1]),Bt(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const r=e[3]||e[2];Object.keys(r).forEach(e=>{t[e]=r[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),Pr=e=>(Bt(e.ns)&&(e.ns=[e.ns]),Bt(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),Bt(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e),Er=()=>{};class Or extends dr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;var r;if(super(),this.options=Pr(e),this.services={},this.logger=ur,this.modules={external:[]},r=this,Object.getOwnPropertyNames(Object.getPrototypeOf(r)).forEach(e=>{"function"==typeof r[e]&&(r[e]=r[e].bind(r))}),t&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,"function"==typeof t&&(r=t,t={}),!t.defaultNS&&!1!==t.defaultNS&&t.ns&&(Bt(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const s=Rr();this.options=a(a(a({},s),this.options),Pr(t)),"v1"!==this.options.compatibilityAPI&&(this.options.interpolation=a(a({},s.interpolation),this.options.interpolation)),void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator);const n=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let t;this.modules.logger?ur.init(n(this.modules.logger),this.options):ur.init(null,this.options),this.modules.formatter?t=this.modules.formatter:"undefined"!=typeof Intl&&(t=Ir);const r=new yr(this.options);this.store=new hr(this.options.resources,this.options);const o=this.services;o.logger=ur,o.resourceStore=this.store,o.languageUtils=r,o.pluralResolver=new kr(r,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!t||this.options.interpolation.format&&this.options.interpolation.format!==s.interpolation.format||(o.formatter=n(t),o.formatter.init(o,this.options),this.options.interpolation.format=o.formatter.format.bind(o.formatter)),o.interpolator=new Cr(this.options),o.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},o.backendConnector=new Ar(n(this.modules.backend),o.resourceStore,o,this.options),o.backendConnector.on("*",function(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),n=1;n<r;n++)s[n-1]=arguments[n];e.emit(t,...s)}),this.modules.languageDetector&&(o.languageDetector=n(this.modules.languageDetector),o.languageDetector.init&&o.languageDetector.init(o,this.options.detection,this.options)),this.modules.i18nFormat&&(o.i18nFormat=n(this.modules.i18nFormat),o.i18nFormat.init&&o.i18nFormat.init(this)),this.translator=new mr(this.services,this.options),this.translator.on("*",function(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),n=1;n<r;n++)s[n-1]=arguments[n];e.emit(t,...s)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,r||(r=Er),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(t=>{this[t]=function(){return e.store[t](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(t=>{this[t]=function(){return e.store[t](...arguments),e}});const o=Jt(),i=()=>{const e=(e,t)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),o.resolve(t),r(e,t)};if(this.languages&&"v1"!==this.options.compatibilityAPI&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initImmediate?i():setTimeout(i,0),o}loadResources(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Er;const r=Bt(e)?e:this.language;if("function"==typeof e&&(t=e),!this.options.resources||this.options.partialBundledLanguages){if(r&&"cimode"===r.toLowerCase()&&(!this.options.preload||0===this.options.preload.length))return t();const e=[],s=t=>{t&&"cimode"!==t&&this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)})};r?s(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>s(e)),this.options.preload&&this.options.preload.forEach(e=>s(e)),this.services.backendConnector.load(e,this.options.ns,e=>{e||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),t(e)})}else t(null)}reloadResources(e,t,r){const s=Jt();return"function"==typeof e&&(r=e,e=void 0),"function"==typeof t&&(r=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),r||(r=Er),this.services.backendConnector.reload(e,t,e=>{s.resolve(),r(e)}),s}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&pr.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const e=this.languages[t];if(!(["cimode","dev"].indexOf(e)>-1)&&this.store.hasLanguageSomeTranslations(e)){this.resolvedLanguage=e;break}}}changeLanguage(e,t){var r=this;this.isLanguageChangingTo=e;const s=Jt();this.emit("languageChanging",e);const n=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},o=(e,o)=>{o?(n(o),this.translator.changeLanguage(o),this.isLanguageChangingTo=void 0,this.emit("languageChanged",o),this.logger.log("languageChanged",o)):this.isLanguageChangingTo=void 0,s.resolve(function(){return r.t(...arguments)}),t&&t(e,function(){return r.t(...arguments)})},i=t=>{e||t||!this.services.languageDetector||(t=[]);const r=Bt(t)?t:this.services.languageUtils.getBestMatchFromCodes(t);r&&(this.language||n(r),this.translator.language||this.translator.changeLanguage(r),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(r)),this.loadResources(r,e=>{o(e,r)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(i):this.services.languageDetector.detect(i):i(e):i(this.services.languageDetector.detect()),s}getFixedT(e,t,r){var s=this;const n=function(e,t){let o;if("object"!=typeof t){for(var i=arguments.length,l=new Array(i>2?i-2:0),c=2;c<i;c++)l[c-2]=arguments[c];o=s.options.overloadTranslationOptionHandler([e,t].concat(l))}else o=a({},t);o.lng=o.lng||n.lng,o.lngs=o.lngs||n.lngs,o.ns=o.ns||n.ns,""!==o.keyPrefix&&(o.keyPrefix=o.keyPrefix||r||n.keyPrefix);const u=s.options.keySeparator||".";let d;return d=o.keyPrefix&&Array.isArray(e)?e.map(e=>`${o.keyPrefix}${u}${e}`):o.keyPrefix?`${o.keyPrefix}${u}${e}`:e,s.t(d,o)};return Bt(e)?n.lng=e:n.lngs=e,n.ns=t,n.keyPrefix=r,n}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=t.lng||this.resolvedLanguage||this.languages[0],s=!!this.options&&this.options.fallbackLng,n=this.languages[this.languages.length-1];if("cimode"===r.toLowerCase())return!0;const o=(e,t)=>{const r=this.services.backendConnector.state[`${e}|${t}`];return-1===r||0===r||2===r};if(t.precheck){const e=t.precheck(this,o);if(void 0!==e)return e}return!(!this.hasResourceBundle(r,e)&&this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages)&&(!o(r,e)||s&&!o(n,e)))}loadNamespaces(e,t){const r=Jt();return this.options.ns?(Bt(e)&&(e=[e]),e.forEach(e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}),this.loadResources(e=>{r.resolve(),t&&t(e)}),r):(t&&t(),Promise.resolve())}loadLanguages(e,t){const r=Jt();Bt(e)&&(e=[e]);const s=this.options.preload||[],n=e.filter(e=>s.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e));return n.length?(this.options.preload=s.concat(n),this.loadResources(e=>{r.resolve(),t&&t(e)}),r):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=this.services&&this.services.languageUtils||new yr(Rr());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){return new Or(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}cloneInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Er;const r=e.forkResourceStore;r&&delete e.forkResourceStore;const s=a(a(a({},this.options),e),{isClone:!0}),n=new Or(s);return void 0===e.debug&&void 0===e.prefix||(n.logger=n.logger.clone(e)),["store","services","language"].forEach(e=>{n[e]=this[e]}),n.services=a({},this.services),n.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},r&&(n.store=new hr(this.store.data,s),n.services.resourceStore=n.store),n.translator=new mr(n.services,s),n.translator.on("*",function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];n.emit(e,...r)}),n.init(s,t),n.translator.options=s,n.translator.backendConnector.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},n}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Tr=Or.createInstance();Tr.createInstance=Or.createInstance,Tr.createInstance,Tr.dir,Tr.init,Tr.loadResources,Tr.reloadResources,Tr.use,Tr.changeLanguage,Tr.getFixedT,Tr.t,Tr.exists,Tr.setDefaultNamespace,Tr.hasLoadedNamespace,Tr.loadNamespaces,Tr.loadLanguages;const Lr=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,Dr={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"¬©","&#169;":"¬©","&reg;":"¬Æ","&#174;":"¬Æ","&hellip;":"‚Ä¶","&#8230;":"‚Ä¶","&#x2F;":"/","&#47;":"/"},$r=e=>Dr[e];let Mr={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:e=>e.replace(Lr,$r)};const qr={type:"3rdParty",init(e){!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Mr=a(a({},Mr),e)}(e.options.react)}};function Fr(e){return(Fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ur(e){var t=function(e){if("object"!=Fr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Fr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Fr(t)?t:t+""}var zr=[],Vr=zr.forEach,Hr=zr.slice,Br=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,Jr={name:"cookie",lookup:function(e){var t;if(e.lookupCookie&&"undefined"!=typeof document){var r=function(e){for(var t="".concat(e,"="),r=document.cookie.split(";"),s=0;s<r.length;s++){for(var n=r[s];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return n.substring(t.length,n.length)}return null}(e.lookupCookie);r&&(t=r)}return t},cacheUserLanguage:function(e,t){t.lookupCookie&&"undefined"!=typeof document&&function(e,t,r,s){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/",sameSite:"strict"};r&&(n.expires=new Date,n.expires.setTime(n.expires.getTime()+60*r*1e3)),s&&(n.domain=s),document.cookie=function(e,t,r){var s=r||{};s.path=s.path||"/";var n=encodeURIComponent(t),o="".concat(e,"=").concat(n);if(s.maxAge>0){var i=s.maxAge-0;if(Number.isNaN(i))throw new Error("maxAge should be a Number");o+="; Max-Age=".concat(Math.floor(i))}if(s.domain){if(!Br.test(s.domain))throw new TypeError("option domain is invalid");o+="; Domain=".concat(s.domain)}if(s.path){if(!Br.test(s.path))throw new TypeError("option path is invalid");o+="; Path=".concat(s.path)}if(s.expires){if("function"!=typeof s.expires.toUTCString)throw new TypeError("option expires is invalid");o+="; Expires=".concat(s.expires.toUTCString())}if(s.httpOnly&&(o+="; HttpOnly"),s.secure&&(o+="; Secure"),s.sameSite)switch("string"==typeof s.sameSite?s.sameSite.toLowerCase():s.sameSite){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return o}(e,encodeURIComponent(t),n)}(t.lookupCookie,e,t.cookieMinutes,t.cookieDomain,t.cookieOptions)}},Wr={name:"querystring",lookup:function(e){var t;if("undefined"!=typeof window){var r=window.location.search;!window.location.search&&window.location.hash&&window.location.hash.indexOf("?")>-1&&(r=window.location.hash.substring(window.location.hash.indexOf("?")));for(var s=r.substring(1).split("&"),n=0;n<s.length;n++){var o=s[n].indexOf("=");o>0&&s[n].substring(0,o)===e.lookupQuerystring&&(t=s[n].substring(o+1))}}return t}},Kr=null,Gr=function(){if(null!==Kr)return Kr;try{Kr="undefined"!==window&&null!==window.localStorage;var e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch(t){Kr=!1}return Kr},Yr={name:"localStorage",lookup:function(e){var t;if(e.lookupLocalStorage&&Gr()){var r=window.localStorage.getItem(e.lookupLocalStorage);r&&(t=r)}return t},cacheUserLanguage:function(e,t){t.lookupLocalStorage&&Gr()&&window.localStorage.setItem(t.lookupLocalStorage,e)}},Qr=null,Xr=function(){if(null!==Qr)return Qr;try{Qr="undefined"!==window&&null!==window.sessionStorage;var e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch(t){Qr=!1}return Qr},Zr={name:"sessionStorage",lookup:function(e){var t;if(e.lookupSessionStorage&&Xr()){var r=window.sessionStorage.getItem(e.lookupSessionStorage);r&&(t=r)}return t},cacheUserLanguage:function(e,t){t.lookupSessionStorage&&Xr()&&window.sessionStorage.setItem(t.lookupSessionStorage,e)}},es={name:"navigator",lookup:function(e){var t=[];if("undefined"!=typeof navigator){if(navigator.languages)for(var r=0;r<navigator.languages.length;r++)t.push(navigator.languages[r]);navigator.userLanguage&&t.push(navigator.userLanguage),navigator.language&&t.push(navigator.language)}return t.length>0?t:void 0}},ts={name:"htmlTag",lookup:function(e){var t,r=e.htmlTag||("undefined"!=typeof document?document.documentElement:null);return r&&"function"==typeof r.getAttribute&&(t=r.getAttribute("lang")),t}},rs={name:"path",lookup:function(e){var t;if("undefined"!=typeof window){var r=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(r instanceof Array)if("number"==typeof e.lookupFromPathIndex){if("string"!=typeof r[e.lookupFromPathIndex])return;t=r[e.lookupFromPathIndex].replace("/","")}else t=r[0].replace("/","")}return t}},ss={name:"subdomain",lookup:function(e){var t="number"==typeof e.lookupFromSubdomainIndex?e.lookupFromSubdomainIndex+1:1,r="undefined"!=typeof window&&window.location&&window.location.hostname&&window.location.hostname.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(r)return r[t]}},ns=!1;try{document.cookie,ns=!0}catch(as){}var os=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];ns||os.splice(1,1);var is=function(){return e=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="languageDetector",this.detectors={},this.init(t,r)},t=[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e||{languageUtils:{}},this.options=function(e){return Vr.call(Hr.call(arguments,1),function(t){if(t)for(var r in t)void 0===e[r]&&(e[r]=t[r])}),e}(t,this.options||{},{order:os,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:function(e){return e}}),"string"==typeof this.options.convertDetectedLanguage&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=function(e){return e.replace("-","_")}),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(Jr),this.addDetector(Wr),this.addDetector(Yr),this.addDetector(Zr),this.addDetector(es),this.addDetector(ts),this.addDetector(rs),this.addDetector(ss)}},{key:"addDetector",value:function(e){return this.detectors[e.name]=e,this}},{key:"detect",value:function(e){var t=this;e||(e=this.options.order);var r=[];return e.forEach(function(e){if(t.detectors[e]){var s=t.detectors[e].lookup(t.options);s&&"string"==typeof s&&(s=[s]),s&&(r=r.concat(s))}}),r=r.map(function(e){return t.options.convertDetectedLanguage(e)}),this.services.languageUtils.getBestMatchFromCodes?r:r.length>0?r[0]:null}},{key:"cacheUserLanguage",value:function(e,t){var r=this;t||(t=this.options.caches),t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(function(t){r.detectors[t]&&r.detectors[t].cacheUserLanguage(e,r.options)}))}}],t&&function(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,Ur(s.key),s)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();is.type="languageDetector";Tr.use(is).use(qr).init({resources:{en:{translation:{cleanerPortal:{title:"Cleaner Portal",welcome:"Welcome, {{name}}",todayAssignments:"Here are your cleaning assignments for today",login:{title:"Please enter your credentials to access your cleaning assignments",name:"Your Name",password:"Password",signIn:"Sign in",invalidPassword:"Invalid password. Please try again."},noCleanings:{title:"No cleanings assigned",description:"You don't have any cleaning assignments for today."},cleaning:{status:{pending:"Pending",not_required:"Not Required",stuck:"Stuck",in_progress:"In Progress",complaint:"Complaint",completed:"Completed"},details:{checkoutTime:"Check Out Time",keyCollection:"Key Collection",bedsToMake:"Beds to Make",towelSets:"Towel Sets",notSpecified:"Not specified"},actions:{startCleaning:"Start Cleaning",markComplete:"Mark as Complete",logout:"Logout",saveAndExit:"Save & Exit"}},steps:{title:"Cleaning Steps",back:"Back to Cleanings",sections:{damage:{title:"Damage Assessment",items:{walls:"Are there any visible damages to the walls or furniture?"}},leakage:{title:"Water Leakage",items:{signs:"Are there any signs of water leakage or stains on the walls or ceilings?"}},missingItems:{title:"Missing Items",header:"Please check if any of the following items are missing:",items:{hairDryer:"Hair dryer",dishes:"Dishes",cutlery:"Cutlery",tv:"TV",vacuum:"Vacuum cleaner",mop:"Mop",airMattress:"Air mattress (1 on top of the wardrobe)"}},bedding:{title:"Bedding and Upholstery",items:{stains:"Are there any stains or damage on the bedding, mattresses, cushions, or duvets?"}},tv:{title:"TV Check",items:{working:"Is the TV functioning properly?"}},hotWater:{title:"Hot Water Check",items:{working:"Is the hot water working?"}},communal:{title:"Communal / Outdoor Area",items:{frontClean:"Is the front of the property clean and rubbish free?",entranceClean:"Is the hallway and communal entrance clean?"}},keys:{title:"Keys Return",items:{guestKey:"Guest Key Returned",cleanerKey:"Cleaner Key Returned"}}},answers:{yes:"Yes",no:"No",present:"Present",missing:"Missing"},completeItems:"Please complete all items in this section",photos:{add:"Add Photo",view:"View Photo",download:"Download",invalidType:"Please upload an image file (JPG, PNG, etc)",sizeLimit:"Image size must be less than 10MB"}}},guestPortal:{upsells:{popular:"Popular",free:"Free",perItem:"per item",oneTimeFee:"one-time fee",addToStay:"Add to Stay",categories:{convenience:"Convenience",upgradeStay:"Stay Upgrades",transportation:"Transportation",comfort:"Comfort & Care",dining:"Dining",wellness:"Wellness",services:"Services",experiences:"Experiences",addOns:"Add-ons",service:"Service"},detail:{title:"Service Details",subtitle:"Learn more about this service",aboutService:"About This Service",showLess:"Show Less",readMore:"Read More",serviceInformation:"Service Information",notesRequired:"Notes Required",noNotesNeeded:"No Additional Notes Needed",additionalDetailsNeeded:"You'll need to provide additional details",readyToAdd:"Ready to add to your stay",schedulingRequired:"Scheduling Required",noScheduling:"No Scheduling Needed",dateTimeNeeded:"Select date and time when booking",availableAnytime:"Available anytime during your stay",approvalRequired:"Approval Required",instantConfirmation:"Instant Confirmation",reviewWithinHours:"We'll review your request within 24 hours",confirmedImmediately:"Confirmed immediately upon booking",noApprovalNeeded:"No approval needed - informational only",requestForApproval:"Request for approval",noPaymentNow:"No payment required now"}}}}},es:{translation:{cleanerPortal:{title:"Portal del Limpiador",welcome:"Bienvenido/a, {{name}}",todayAssignments:"Aqu√≠ est√°n tus asignaciones de limpieza para hoy",login:{title:"Por favor, ingresa tus credenciales para acceder a tus asignaciones de limpieza",name:"Tu Nombre",password:"Contrase√±a",signIn:"Iniciar sesi√≥n",invalidPassword:"Contrase√±a inv√°lida. Por favor, intenta de nuevo."},noCleanings:{title:"Sin limpiezas asignadas",description:"No tienes asignaciones de limpieza para hoy."},cleaning:{status:{pending:"Pendiente",not_required:"No Requerido",stuck:"Atascado",in_progress:"En Progreso",complaint:"Queja",completed:"Completado"},details:{checkoutTime:"Hora de Salida",keyCollection:"Recolecci√≥n de Llaves",bedsToMake:"Camas por Hacer",towelSets:"Juegos de Toallas",notSpecified:"No especificado"},actions:{startCleaning:"Comenzar Limpieza",markComplete:"Marcar como Completado",logout:"Cerrar Sesi√≥n",saveAndExit:"Guardar y Salir"}},steps:{title:"Pasos de Limpieza",back:"Volver a Limpiezas",sections:{damage:{title:"Evaluaci√≥n de Da√±os",items:{walls:"¬øHay da√±os visibles en las paredes o muebles?"}},leakage:{title:"Fugas de Agua",items:{signs:"¬øHay signos de fugas de agua o manchas en las paredes o techos?"}},missingItems:{title:"Art√≠culos Faltantes",header:"Por favor, verifica si falta alguno de los siguientes art√≠culos:",items:{hairDryer:"Secador de pelo",dishes:"Platos",cutlery:"Cubiertos",tv:"Televisi√≥n",vacuum:"Aspiradora",mop:"Trapeador",airMattress:"Colch√≥n de aire (1 sobre el armario)"}},bedding:{title:"Ropa de Cama y Tapicer√≠a",items:{stains:"¬øHay manchas o da√±os en la ropa de cama, colchones, cojines o edredones?"}},tv:{title:"Revisi√≥n de TV",items:{working:"¬øLa televisi√≥n funciona correctamente?"}},hotWater:{title:"Revisi√≥n de Agua Caliente",items:{working:"¬øFunciona el agua caliente?"}},communal:{title:"√Årea Com√∫n / Exterior",items:{frontClean:"¬øEst√° limpio y sin basura el frente de la propiedad?",entranceClean:"¬øEst√°n limpios el pasillo y la entrada com√∫n?"}},keys:{title:"Devoluci√≥n de Llaves",items:{guestKey:"Llave del hu√©sped devuelta",cleanerKey:"Llave del limpiador devuelta"}}},answers:{yes:"S√≠",no:"No",present:"Presente",missing:"Faltante"},completeItems:"Por favor completa todos los elementos en esta secci√≥n",photos:{add:"Agregar Foto",view:"Ver Foto",download:"Descargar",invalidType:"Por favor sube un archivo de imagen (JPG, PNG, etc)",sizeLimit:"El tama√±o de la imagen debe ser menor a 10MB"}}},guestPortal:{upsells:{popular:"Popular",free:"Gratis",perItem:"por art√≠culo",oneTimeFee:"tarifa √∫nica",addToStay:"Agregar a la Estancia",categories:{convenience:"Conveniencia",upgradeStay:"Mejoras de Estancia",transportation:"Transporte",comfort:"Comodidad y Cuidado",dining:"Comida",wellness:"Bienestar",services:"Servicios",experiences:"Experiencias",addOns:"Complementos",service:"Servicio"},detail:{title:"Detalles del Servicio",subtitle:"Aprende m√°s sobre este servicio",aboutService:"Acerca de Este Servicio",showLess:"Mostrar Menos",readMore:"Leer M√°s",serviceInformation:"Informaci√≥n del Servicio",notesRequired:"Notas Requeridas",noNotesNeeded:"No Se Necesitan Notas Adicionales",additionalDetailsNeeded:"Necesitar√°s proporcionar detalles adicionales",readyToAdd:"Listo para agregar a tu estancia",schedulingRequired:"Programaci√≥n Requerida",noScheduling:"No Se Necesita Programaci√≥n",dateTimeNeeded:"Selecciona fecha y hora al reservar",availableAnytime:"Disponible en cualquier momento durante tu estancia",approvalRequired:"Aprobaci√≥n Requerida",instantConfirmation:"Confirmaci√≥n Instant√°nea",reviewWithinHours:"Revisaremos tu solicitud en 24 horas",confirmedImmediately:"Confirmado inmediatamente al reservar",noApprovalNeeded:"No se necesita aprobaci√≥n - solo informativo",requestForApproval:"Solicitar aprobaci√≥n",noPaymentNow:"No se requiere pago ahora"}}}}},fr:{translation:{cleanerPortal:{title:"Portail du Nettoyeur",welcome:"Bienvenue, {{name}}",todayAssignments:"Voici vos t√¢ches de nettoyage pour aujourd'hui",login:{title:"Veuillez entrer vos identifiants pour acc√©der √† vos t√¢ches de nettoyage",name:"Votre Nom",password:"Mot de passe",signIn:"Se connecter",invalidPassword:"Mot de passe invalide. Veuillez r√©essayer."},noCleanings:{title:"Aucun nettoyage assign√©",description:"Vous n'avez pas de t√¢ches de nettoyage pour aujourd'hui."},cleaning:{status:{pending:"En attente",not_required:"Non requis",stuck:"Bloqu√©",in_progress:"En cours",complaint:"Plainte",completed:"Termin√©"},details:{checkoutTime:"Heure de d√©part",keyCollection:"Collecte des cl√©s",bedsToMake:"Lits √† faire",towelSets:"Ensembles de serviettes",notSpecified:"Non sp√©cifi√©"},actions:{startCleaning:"Commencer le nettoyage",markComplete:"Marquer comme termin√©",logout:"D√©connexion",saveAndExit:"Sauvegarder et quitter"}},steps:{title:"√âtapes de nettoyage",back:"Retour aux nettoyages",sections:{damage:{title:"√âvaluation des dommages",items:{walls:"Y a-t-il des dommages visibles aux murs ou aux meubles?"}},leakage:{title:"Fuites d'eau",items:{signs:"Y a-t-il des signes de fuite d'eau ou des taches sur les murs ou les plafonds?"}},missingItems:{title:"Articles manquants",header:"Veuillez v√©rifier si l'un des articles suivants est manquant:",items:{hairDryer:"S√®che-cheveux",dishes:"Vaisselle",cutlery:"Couverts",tv:"T√©l√©vision",vacuum:"Aspirateur",mop:"Balai",airMattress:"Matelas gonflable (1 sur l'armoire)"}},bedding:{title:"Literie et tissus d'ameublement",items:{stains:"Y a-t-il des taches ou des dommages sur la literie, les matelas, les coussins ou les couettes?"}},tv:{title:"V√©rification de la TV",items:{working:"La t√©l√©vision fonctionne-t-elle correctement?"}},hotWater:{title:"V√©rification de l'eau chaude",items:{working:"L'eau chaude fonctionne-t-elle?"}},communal:{title:"Espaces communs / Ext√©rieurs",items:{frontClean:"L'avant de la propri√©t√© est-il propre et sans d√©chets?",entranceClean:"Le couloir et l'entr√©e commune sont-ils propres?"}},keys:{title:"Retour des cl√©s",items:{guestKey:"Cl√© invit√© retourn√©e",cleanerKey:"Cl√© du nettoyeur retourn√©e"}}},answers:{yes:"Oui",no:"Non",present:"Pr√©sent",missing:"Manquant"},completeItems:"Veuillez compl√©ter tous les √©l√©ments de cette section",photos:{add:"Ajouter une photo",view:"Voir la photo",download:"T√©l√©charger",invalidType:"Veuillez t√©l√©charger un fichier image (JPG, PNG, etc)",sizeLimit:"La taille de l'image doit √™tre inf√©rieure √† 10 Mo"}}},guestPortal:{upsells:{popular:"Populaire",free:"Gratuit",perItem:"par article",oneTimeFee:"frais unique",addToStay:"Ajouter au S√©jour",categories:{convenience:"Commodit√©",upgradeStay:"Am√©lioration du S√©jour",transportation:"Transport",comfort:"Confort et Soins",dining:"Restauration",wellness:"Bien-√™tre",services:"Services",experiences:"Exp√©riences",addOns:"Suppl√©ments",service:"Service"},detail:{title:"D√©tails du Service",subtitle:"En savoir plus sur ce service",aboutService:"√Ä Propos de ce Service",showLess:"Afficher Moins",readMore:"Lire Plus",serviceInformation:"Informations sur le Service",notesRequired:"Notes Requises",noNotesNeeded:"Aucune Note Suppl√©mentaire N√©cessaire",additionalDetailsNeeded:"Vous devrez fournir des d√©tails suppl√©mentaires",readyToAdd:"Pr√™t √† ajouter √† votre s√©jour",schedulingRequired:"Planification Requise",noScheduling:"Aucune Planification N√©cessaire",dateTimeNeeded:"Choisir date et heure lors de la r√©servation",availableAnytime:"Disponible √† tout moment pendant votre s√©jour",approvalRequired:"Approbation Requise",instantConfirmation:"Confirmation Instantan√©e",reviewWithinHours:"Nous examinerons votre demande dans les 24 heures",confirmedImmediately:"Confirm√© imm√©diatement lors de la r√©servation",noApprovalNeeded:"Aucune approbation n√©cessaire - informatif seulement",requestForApproval:"Demande d'approbation",noPaymentNow:"Aucun paiement requis maintenant"}}}}},pt:{translation:{cleanerPortal:{title:"Portal do Limpador",welcome:"Bem-vindo(a), {{name}}",todayAssignments:"Aqui est√£o suas tarefas de limpeza para hoje",login:{title:"Por favor, insira suas credenciais para acessar suas tarefas de limpeza",name:"Seu Nome",password:"Senha",signIn:"Entrar",invalidPassword:"Senha inv√°lida. Por favor, tente novamente."},noCleanings:{title:"Sem limpezas atribu√≠das",description:"Voc√™ n√£o tem tarefas de limpeza para hoje."},cleaning:{status:{pending:"Pendente",not_required:"N√£o Necess√°rio",stuck:"Travado",in_progress:"Em Andamento",complaint:"Reclama√ß√£o",completed:"Conclu√≠do"},details:{checkoutTime:"Hor√°rio de Sa√≠da",keyCollection:"Coleta de Chaves",bedsToMake:"Camas para Arrumar",towelSets:"Conjuntos de Toalhas",notSpecified:"N√£o especificado"},actions:{startCleaning:"Iniciar Limpeza",markComplete:"Marcar como Conclu√≠do",logout:"Sair",saveAndExit:"Salvar e Sair"}},steps:{title:"Etapas de Limpeza",back:"Voltar para Limpezas",sections:{damage:{title:"Avalia√ß√£o de Danos",items:{walls:"H√° danos vis√≠veis nas paredes ou m√≥veis?"}},leakage:{title:"Vazamentos de √Ågua",items:{signs:"H√° sinais de vazamento de √°gua ou manchas nas paredes ou tetos?"}},missingItems:{title:"Itens Faltantes",header:"Por favor, verifique se algum dos seguintes itens est√° faltando:",items:{hairDryer:"Secador de cabelo",dishes:"Pratos",cutlery:"Talheres",tv:"Televis√£o",vacuum:"Aspirador",mop:"Esfreg√£o",airMattress:"Colch√£o de ar (1 em cima do guarda-roupa)"}},bedding:{title:"Roupas de Cama e Estofados",items:{stains:"H√° manchas ou danos nas roupas de cama, colch√µes, almofadas ou edredons?"}},tv:{title:"Verifica√ß√£o da TV",items:{working:"A televis√£o est√° funcionando corretamente?"}},hotWater:{title:"Verifica√ß√£o da √Ågua Quente",items:{working:"A √°gua quente est√° funcionando?"}},communal:{title:"√Årea Comum / Externa",items:{frontClean:"A frente da propriedade est√° limpa e sem lixo?",entranceClean:"O corredor e a entrada comum est√£o limpos?"}},keys:{title:"Devolu√ß√£o das Chaves",items:{guestKey:"Chave do h√≥spede devolvida",cleanerKey:"Chave do limpador devolvida"}}},answers:{yes:"Sim",no:"N√£o",present:"Presente",missing:"Faltando"},completeItems:"Por favor, complete todos os itens desta se√ß√£o",photos:{add:"Adicionar Foto",view:"Ver Foto",download:"Baixar",invalidType:"Por favor envie um arquivo de imagem (JPG, PNG, etc)",sizeLimit:"O tamanho da imagem deve ser menor que 10MB"}}},guestPortal:{upsells:{popular:"Popular",free:"Gr√°tis",perItem:"por item",oneTimeFee:"taxa √∫nica",addToStay:"Adicionar √† Estadia",categories:{convenience:"Conveni√™ncia",upgradeStay:"Melhoria da Estadia",transportation:"Transporte",comfort:"Conforto e Cuidado",dining:"Alimenta√ß√£o",wellness:"Bem-estar",services:"Servi√ßos",experiences:"Experi√™ncias",addOns:"Complementos",service:"Servi√ßo"},detail:{title:"Detalhes do Servi√ßo",subtitle:"Saiba mais sobre este servi√ßo",aboutService:"Sobre Este Servi√ßo",showLess:"Mostrar Menos",readMore:"Ler Mais",serviceInformation:"Informa√ß√µes do Servi√ßo",notesRequired:"Notas Necess√°rias",noNotesNeeded:"Nenhuma Nota Adicional Necess√°ria",additionalDetailsNeeded:"Voc√™ precisar√° fornecer detalhes adicionais",readyToAdd:"Pronto para adicionar √† sua estadia",schedulingRequired:"Agendamento Necess√°rio",noScheduling:"Nenhum Agendamento Necess√°rio",dateTimeNeeded:"Selecione data e hora ao reservar",availableAnytime:"Dispon√≠vel a qualquer momento durante sua estadia",approvalRequired:"Aprova√ß√£o Necess√°ria",instantConfirmation:"Confirma√ß√£o Instant√¢nea",reviewWithinHours:"Analisaremos sua solicita√ß√£o em 24 horas",confirmedImmediately:"Confirmado imediatamente ao reservar",noApprovalNeeded:"Nenhuma aprova√ß√£o necess√°ria - apenas informativo",requestForApproval:"Solicitar aprova√ß√£o",noPaymentNow:"Nenhum pagamento necess√°rio agora"}}}}},ar:{translation:{cleanerPortal:{title:"ÿ®Ÿàÿßÿ®ÿ© ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ",welcome:"ŸÖÿ±ÿ≠ÿ®ÿßŸãÿå {{name}}",todayAssignments:"Ÿáÿ∞Ÿá ŸÖŸáÿßŸÖ ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿÆÿßÿµÿ© ÿ®ŸÉ ŸÑŸÑŸäŸàŸÖ",login:{title:"ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßÿπÿ™ŸÖÿßÿØ ŸÑŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ ŸÖŸáÿßŸÖ ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿÆÿßÿµÿ© ÿ®ŸÉ",name:"ÿßÿ≥ŸÖŸÉ",password:"ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±",signIn:"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",invalidPassword:"ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©. ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ."},noCleanings:{title:"ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸáÿßŸÖ ÿ™ŸÜÿ∏ŸäŸÅ",description:"ŸÑŸäÿ≥ ŸÑÿØŸäŸÉ ŸÖŸáÿßŸÖ ÿ™ŸÜÿ∏ŸäŸÅ ŸÑŸÑŸäŸàŸÖ."},cleaning:{status:{pending:"ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±",not_required:"ÿ∫Ÿäÿ± ŸÖÿ∑ŸÑŸàÿ®",stuck:"ŸÖÿ™ŸàŸÇŸÅ",in_progress:"ŸÇŸäÿØ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞",complaint:"ÿ¥ŸÉŸàŸâ",completed:"ŸÖŸÉÿ™ŸÖŸÑ"},details:{checkoutTime:"ŸàŸÇÿ™ ÿßŸÑŸÖÿ∫ÿßÿØÿ±ÿ©",keyCollection:"ÿ¨ŸÖÿπ ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠",bedsToMake:"ÿßŸÑÿ£ÿ≥ÿ±Ÿëÿ© ŸÑŸÑÿ™ÿ±ÿ™Ÿäÿ®",towelSets:"ŸÖÿ¨ŸÖŸàÿπÿßÿ™ ÿßŸÑŸÖŸÜÿßÿ¥ŸÅ",notSpecified:"ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ"},actions:{startCleaning:"ÿ®ÿØÿ° ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ",markComplete:"ÿ™ÿ≠ÿØŸäÿØ ŸÉŸÖŸÉÿ™ŸÖŸÑ",logout:"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨",saveAndExit:"ÿ≠ŸÅÿ∏ ŸàÿÆÿ±Ÿàÿ¨"}},steps:{title:"ÿÆÿ∑Ÿàÿßÿ™ ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ",back:"ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸâ ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ",sections:{damage:{title:"ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ£ÿ∂ÿ±ÿßÿ±",items:{walls:"ŸáŸÑ ŸáŸÜÿßŸÉ ÿ£ÿ∂ÿ±ÿßÿ± ŸÖÿ±ÿ¶Ÿäÿ© ŸÅŸä ÿßŸÑÿ¨ÿØÿ±ÿßŸÜ ÿ£Ÿà ÿßŸÑÿ£ÿ´ÿßÿ´ÿü"}},leakage:{title:"ÿ™ÿ≥ÿ±ÿ® ÿßŸÑŸÖŸäÿßŸá",items:{signs:"ŸáŸÑ ŸáŸÜÿßŸÉ ÿπŸÑÿßŸÖÿßÿ™ ÿ™ÿ≥ÿ±ÿ® ŸÖŸäÿßŸá ÿ£Ÿà ÿ®ŸÇÿπ ÿπŸÑŸâ ÿßŸÑÿ¨ÿØÿ±ÿßŸÜ ÿ£Ÿà ÿßŸÑÿ≥ŸÇŸÅÿü"}},missingItems:{title:"ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑŸÖŸÅŸÇŸàÿØÿ©",header:"Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÖÿß ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿ£Ÿä ŸÖŸÜ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑÿ™ÿßŸÑŸäÿ© ŸÖŸÅŸÇŸàÿØÿ©:",items:{hairDryer:"ŸÖÿ¨ŸÅŸÅ ÿßŸÑÿ¥ÿπÿ±",dishes:"ÿßŸÑÿ£ÿ∑ÿ®ÿßŸÇ",cutlery:"ÿ£ÿØŸàÿßÿ™ ÿßŸÑŸÖÿßÿ¶ÿØÿ©",tv:"ÿßŸÑÿ™ŸÑŸÅÿßÿ≤",vacuum:"ÿßŸÑŸÖŸÉŸÜÿ≥ÿ© ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ©",mop:"ÿßŸÑŸÖŸÖÿ≥ÿ≠ÿ©",airMattress:"ŸÅÿ±ÿßÿ¥ ŸáŸàÿßÿ¶Ÿä (1 ŸÅŸàŸÇ ÿÆÿ≤ÿßŸÜÿ© ÿßŸÑŸÖŸÑÿßÿ®ÿ≥)"}},bedding:{title:"ÿßŸÑŸÅÿ±ÿßÿ¥ ŸàÿßŸÑŸÖŸÅÿ±Ÿàÿ¥ÿßÿ™",items:{stains:"ŸáŸÑ ŸáŸÜÿßŸÉ ÿ®ŸÇÿπ ÿ£Ÿà ÿ£ÿ∂ÿ±ÿßÿ± ÿπŸÑŸâ ÿßŸÑŸÅÿ±ÿßÿ¥ ÿ£Ÿà ÿßŸÑŸÖÿ±ÿßÿ™ÿ® ÿ£Ÿà ÿßŸÑŸàÿ≥ÿßÿ¶ÿØ ÿ£Ÿà ÿßŸÑŸÑÿ≠ŸÅÿü"}},tv:{title:"ŸÅÿ≠ÿµ ÿßŸÑÿ™ŸÑŸÅÿßÿ≤",items:{working:"ŸáŸÑ ŸäÿπŸÖŸÑ ÿßŸÑÿ™ŸÑŸÅÿßÿ≤ ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠ÿü"}},hotWater:{title:"ŸÅÿ≠ÿµ ÿßŸÑŸÖÿßÿ° ÿßŸÑÿ≥ÿßÿÆŸÜ",items:{working:"ŸáŸÑ ÿßŸÑŸÖÿßÿ° ÿßŸÑÿ≥ÿßÿÆŸÜ ŸäÿπŸÖŸÑÿü"}},communal:{title:"ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸÉÿ© / ÿßŸÑÿÆÿßÿ±ÿ¨Ÿäÿ©",items:{frontClean:"ŸáŸÑ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑÿπŸÇÿßÿ± ŸÜÿ∏ŸäŸÅÿ© ŸàÿÆÿßŸÑŸäÿ© ŸÖŸÜ ÿßŸÑŸÜŸÅÿßŸäÿßÿ™ÿü",entranceClean:"ŸáŸÑ ÿßŸÑŸÖŸÖÿ± ŸàÿßŸÑŸÖÿØÿÆŸÑ ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸÉ ŸÜÿ∏ŸäŸÅÿü"}},keys:{title:"ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠",items:{guestKey:"ÿ™ŸÖ ÿ•ÿ±ÿ¨ÿßÿπ ŸÖŸÅÿ™ÿßÿ≠ ÿßŸÑÿ∂ŸäŸÅ",cleanerKey:"ÿ™ŸÖ ÿ•ÿ±ÿ¨ÿßÿπ ŸÖŸÅÿ™ÿßÿ≠ ÿßŸÑŸÖŸÜÿ∏ŸÅ"}}},answers:{yes:"ŸÜÿπŸÖ",no:"ŸÑÿß",present:"ŸÖŸàÿ¨ŸàÿØ",missing:"ŸÖŸÅŸÇŸàÿØ"},completeItems:"Ÿäÿ±ÿ¨Ÿâ ÿ•ŸÉŸÖÿßŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÜÿßÿµÿ± ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑŸÇÿ≥ŸÖ",photos:{add:"ÿ•ÿ∂ÿßŸÅÿ© ÿµŸàÿ±ÿ©",view:"ÿπÿ±ÿ∂ ÿßŸÑÿµŸàÿ±ÿ©",download:"ÿ™ÿ≠ŸÖŸäŸÑ",invalidType:"ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÑŸÅ ÿµŸàÿ±ÿ© (JPG, PNG, ÿßŸÑÿÆ)",sizeLimit:"Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ÿ≠ÿ¨ŸÖ ÿßŸÑÿµŸàÿ±ÿ© ÿ£ŸÇŸÑ ŸÖŸÜ 10 ŸÖŸäÿ¨ÿßÿ®ÿßŸäÿ™"}}},guestPortal:{upsells:{popular:"ÿ¥ÿßÿ¶ÿπ",free:"ŸÖÿ¨ÿßŸÜŸä",perItem:"ŸÑŸÉŸÑ ÿπŸÜÿµÿ±",oneTimeFee:"ÿ±ÿ≥ŸàŸÖ ŸÑŸÖÿ±ÿ© Ÿàÿßÿ≠ÿØÿ©",addToStay:"ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑÿ•ŸÇÿßŸÖÿ©",categories:{convenience:"ÿ±ÿßÿ≠ÿ©",upgradeStay:"ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ•ŸÇÿßŸÖÿ©",transportation:"ŸÜŸÇŸÑ",comfort:"ÿ±ÿßÿ≠ÿ© Ÿàÿ±ÿπÿßŸäÿ©",dining:"ÿ∑ÿπÿßŸÖ",wellness:"ÿµÿ≠ÿ©",services:"ÿÆÿØŸÖÿßÿ™",experiences:"ÿ™ÿ¨ÿßÿ±ÿ®",addOns:"ÿ•ÿ∂ÿßŸÅÿßÿ™",service:"ÿÆÿØŸÖÿ©"},detail:{title:"ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿÆÿØŸÖÿ©",subtitle:"ÿ™ÿπÿ±ŸÅ ÿ£ŸÉÿ´ÿ± ÿπŸÑŸâ Ÿáÿ∞Ÿá ÿßŸÑÿÆÿØŸÖÿ©",aboutService:"ÿ≠ŸàŸÑ Ÿáÿ∞Ÿá ÿßŸÑÿÆÿØŸÖÿ©",showLess:"ÿπÿ±ÿ∂ ÿ£ŸÇŸÑ",readMore:"ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÖÿ≤ŸäÿØ",serviceInformation:"ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿÆÿØŸÖÿ©",notesRequired:"ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ŸÖÿ∑ŸÑŸàÿ®ÿ©",noNotesNeeded:"ŸÑÿß ÿ≠ÿßÿ¨ÿ© ŸÑŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©",additionalDetailsNeeded:"ÿ≥ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÑÿ™ŸÇÿØŸäŸÖ ÿ™ŸÅÿßÿµŸäŸÑ ÿ•ÿ∂ÿßŸÅŸäÿ©",readyToAdd:"ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ•ÿ∂ÿßŸÅÿ© ŸÑÿ•ŸÇÿßŸÖÿ™ŸÉ",schedulingRequired:"ÿ¨ÿØŸàŸÑÿ© ŸÖÿ∑ŸÑŸàÿ®ÿ©",noScheduling:"ŸÑÿß ÿ≠ÿßÿ¨ÿ© ŸÑÿ¨ÿØŸàŸÑÿ©",dateTimeNeeded:"ÿßÿÆÿ™ÿ± ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸàÿßŸÑŸàŸÇÿ™ ÿπŸÜÿØ ÿßŸÑÿ≠ÿ¨ÿ≤",availableAnytime:"ŸÖÿ™ÿßÿ≠ ŸÅŸä ÿ£Ÿä ŸàŸÇÿ™ ÿÆŸÑÿßŸÑ ÿ•ŸÇÿßŸÖÿ™ŸÉ",approvalRequired:"ŸÖŸàÿßŸÅŸÇÿ© ŸÖÿ∑ŸÑŸàÿ®ÿ©",instantConfirmation:"ÿ™ÿ£ŸÉŸäÿØ ŸÅŸàÿ±Ÿä",reviewWithinHours:"ÿ≥ŸÜÿ±ÿßÿ¨ÿπ ÿ∑ŸÑÿ®ŸÉ ÿÆŸÑÿßŸÑ 24 ÿ≥ÿßÿπÿ©",confirmedImmediately:"ÿ™ÿ£ŸÉŸäÿØ ŸÅŸàÿ±Ÿä ÿπŸÜÿØ ÿßŸÑÿ≠ÿ¨ÿ≤",noApprovalNeeded:"ŸÑÿß ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÖŸàÿßŸÅŸÇÿ© - ŸÖÿπŸÑŸàŸÖÿßÿ™ ŸÅŸÇÿ∑",requestForApproval:"ÿ∑ŸÑÿ® ŸÑŸÑŸÖŸàÿßŸÅŸÇÿ©",noPaymentNow:"ŸÑÿß Ÿäÿ™ÿ∑ŸÑÿ® ÿØŸÅÿπ ÿßŸÑÿ¢ŸÜ"}}}}}},fallbackLng:"en",interpolation:{escapeValue:!1},detection:{order:["cookie","localStorage","navigator"],caches:["cookie"]}}),Se.createRoot(document.getElementById("root")).render(d.jsx(v.StrictMode,{children:d.jsx(Ht,{})}));export{ke as s};
